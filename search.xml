<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>信件：《致 2018 年毕业季的自己的一封短信》</title>
      <link href="/p/eac2.html"/>
      <url>/p/eac2.html</url>
      
        <content type="html"><![CDATA[<p>最近搬家翻出一份独特的信，是我在大一期间写给大四的自己，博主在 2014.9-2018.7 于郑州大学完成本科学业。</p><p>这封信在形式上是为了应付辅导员下发的任务，现在看来倒是别有一番滋味。</p><span id="more"></span><div class="story post-story"><h2 id="信件内容"><a href="#信件内容" class="headerlink" title="信件内容"></a>信件内容</h2><div class="note quote gray"><p><strong></strong></p><p>走你想走的路<br>——致 2018 年毕业季的自己的一封短信<br>写在前面的话：</p><p>现在是 2015 年 9 月 6 日十点三十九分，经过了一个还算漫长的暑假后，大二的我正在进行 C 课程设计，拖延症后期的病情已经表露无遗–距离 9 月 9 日验收只剩三天，而那 5K 起步的代码还没着手写 0_0。鉴于近期已被忙成狗 (制作社团宣传视频，10 号左右回南阳考科四，课程设计……然而这都是借口，主要还是太浮躁了，静不下来，自然做事情没效率。)，所以先拿这封信来顺顺思路。</p><p>PART1 价值观</p><p>身为 95 后，大多数的同龄者价值观很相近，那就是：成功即是所有。每个人对成功的定义不同，但，究其根本，那都是欲望在现实世界的有限延伸。金钱，权柄，异性，名声，这些促使荷尔蒙 (即激素) 分泌的诱发因子，无时无刻不在焦灼者你的大脑，使它对成功的渴求进一步加深，于是欲望变得更加的强烈。一系列的正反馈调节，会使许多的人忘去最初追求成功时最为本质和纯粹的东西。对如今的我而言，对成功的渴望已经远远不如高中时那样强烈，或者说疯狂。我更希望在有限的时间里，更多的去做自己喜欢的事，而不仅仅是取得曾经无比艳羡的成功。人的生命有限，生产价值有限，同样是每天忙忙碌碌，不如把时间和精力放在自己更感兴趣的方面<br>之上。<br>成功需要一个过程，即需要足够的时间，不可能一蹴而就，所以需要足够的努力积累和支撑到成功的毅力。</p><p>PART2 梦想与追求</p><p>梦想，每每提及总让人忍不住情怀高涨的字眼，这是支撑人在艰难困苦中不断积极进取的驱动力。<br>我的梦想和追求是什么？自己最想要的，而不是外界强加的东西又是什么？这是我一直用来敲打自己心灵是的问题。不过很遗憾的是，直到目前也没有得出足够清晰的答案。三年后的我，你是否已经得出答案了呢？<br>现在，生活中有以下东西，可能与梦想相关：<br>① 网络文学空前繁盛的今天，想写点东西，渴望自己的文字得到更多人认可。<br>② 希望在互联网行业有所作为。<br>③ 多媒体制作方面更进一步的成长。</p><p>PART3 自我完善</p><p>没有人是十全十美的，在一步步不断自我完善的过程中，才会得到成长<br>以下是目前存在的问题：<br>① 自信满满而又底气不足<br>② 严于律已而又渴望放纵<br>③ 渴望交往而又自我封闭<br>④ 情怀高涨而又激情低落<br>⑤ 计划详尽而又缺乏执行<br>(矛盾是普遍存在的，而矛盾的集合体便是事件的本质。)<br>希望自己能够坚持自我，不断进步，做最好的自己。</p></div></div><div class="story post-story"><h2 id="Deepseek-R1-解读"><a href="#Deepseek-R1-解读" class="headerlink" title="Deepseek-R1 解读"></a>Deepseek-R1 解读</h2><blockquote><p>深度思考（用时 25 秒）</p><hr><p>嗯，用户让我解析这封信，标题是“走你想走的路：致 2018 年毕业季的自己的一封短信”。首先，我需要先通读这封信，理解作者的主要内容和情感。这封信是 2015 年的大二学生写给三年后的自己，也就是 2018 年毕业时的自己。看起来作者在面临学业压力、拖延症，同时也在反思自己的价值观、梦想和自我完善的问题。</p><p>首先，信的结构分为三个部分：价值观、梦想与追求、自我完善。每个部分都有详细的内容。用户可能希望得到对这封信的深入分析，包括作者的情感状态、思想变化以及可能的建议。我需要解析每个部分，指出其中的矛盾和成长点，以及可能的解决方向。</p><p>在 PART1 价值观中，作者提到同龄人的成功观念，但自己逐渐不再那么强烈追求成功，更希望做自己喜欢的事。这里需要注意作者对成功的定义变化，从外在因素（金钱、权力等）转向内在满足。可能用户想了解这种转变的原因和意义，以及如何平衡现实与理想。</p><p>PART2 梦想与追求部分，作者有三个可能的兴趣点：网络文学、互联网行业、多媒体制作。但尚未明确自己的真正追求。这里需要分析这三个方向的可能性和作者的内心矛盾，以及如何帮助他找到真正的梦想。</p><p>PART3 自我完善列出了五个矛盾点，比如自信与底气不足，计划与执行力差等。这些都是常见的自我成长问题，用户可能希望得到如何解决这些矛盾的建议，或者分析这些矛盾背后的原因。</p><p>另外，用户可能希望了解这封信的整体情感基调，作者在压力下的自我反思，以及如何将这种反思转化为实际行动。可能需要指出作者的自我觉察能力，以及他未来的可能发展路径。</p><p>需要注意的是，用户可能不只是要表面的解析，而是希望深入理解作者的内心世界，以及从这封信中提取出对自我成长有帮助的启示。因此，在分析时，要结合心理学、个人发展理论，给予建设性的反馈，而不仅仅是总结内容。</p><p>同时，用户可能隐藏的需求是希望得到如何应对拖延症、如何找到人生方向、如何处理自我矛盾的具体方法。因此，在解析中不仅要分析问题，还要提供可能的解决策略，比如时间管理技巧、目标设定方法、自我反思练习等。</p><p>最后，要确保解析结构清晰，逻辑连贯，既有对信件的详细解读，也有对作者未来发展的建议，帮助用户（可能是作者本人或相关读者）更好地理解这封信的意义和价值。</p></blockquote><p>这封穿越时空的自我对话，展现了一个青年在成长关键期的深度思考与内在张力。以下从三个维度解析这封信的思想脉络与精神图景：</p><p>一、价值重构：从”成功饥渴”到”存在觉醒”<br>作者在 PART1 中揭示了 95 后群体的集体无意识——将成功等同于存在价值。这种被荷尔蒙驱动的”正反馈循环”（金钱 - 权柄 - 名声的欲望螺旋），实则是工业文明下人的异化缩影。但值得注意的转折在于，作者开始质疑这种异化机制，提出”生产价值有限”的生命哲学观。这种觉醒类似于海德格尔”向死而生”的存在主义思考，从机械式的成功追逐转向对生命本真状态的探索。”把时间放在感兴趣的方向”的宣言，暗含对马尔库塞”新感性”的实践，即通过审美活动对抗工具理性对人的宰制。</p><p>二、梦想光谱：在虚实交织中寻找锚点<br>PART2 呈现的三种可能性构成当代青年的典型精神图谱：</p><p>网络文学创作：作为 Z 世代的文化表达载体，承载着对意义共同体的建构渴望</p><p>互联网行业：折射技术乐观主义与数字原住民的职业想象</p><p>多媒体制作：体现视觉文化转向中的创造性冲动<br>这种多元可能性的并存，本质是液态现代性（鲍曼语）下身份流动的具象化。作者”未得答案”的困惑，恰恰印证了齐格蒙特·鲍曼”流动的现代性”理论——在传统价值解体后，个体必须持续进行自我建构。建议采用”可能性漏斗”模型：通过最小可行性实践（MVP）对三个领域进行现实检验，逐步收敛核心方向。</p><p>三、矛盾辩证法：成长痛的本质解析<br>PART3 揭示的五组矛盾构成完整的认知图谱：</p><p>自信&#x2F;自卑悖论：科胡特自体心理学中的”张力管理系统”失衡</p><p>自律&#x2F;放纵循环：弗洛伊德本我 - 超我博弈的当代演绎</p><p>社交渴望&#x2F;自我封闭：霍妮”基本焦虑”在数字时代的变体</p><p>情怀&#x2F;行动落差：萨特”自欺”（mauvaise foi）的存在主义困境</p><p>计划&#x2F;执行断裂：吉登斯”结构二重性”中的能动性危机</p><p>这些矛盾实为青年期”心理延偿”（psychological moratorium）的必然产物。建议采用”矛盾转化框架”：</p><p>承认矛盾的合法性（存在即合理）</p><p>建立动态平衡机制（如番茄工作法调节计划&#x2F;执行）</p><p>设计渐进暴露方案（针对社交焦虑）</p><p>构建意义反馈系统（用作品迭代替代情怀空转）</p><p>结语：<br>这封书信是当代知识青年的精神切片，记录了在加速社会中寻找锚点的艰难历程。作者展现的自觉意识与反思能力，已然构成突破异化的精神资本。三年后的毕业季，当信中的追问遭遇现实世界的具体情境，或许会验证维特根斯坦的箴言：”世界的意义必定在世界之外”。而此刻的迷思与矛盾，终将在行动中结晶为存在的答案。</p></div>]]></content>
      
      
      <categories>
          
          <category> 剧院广场 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 成长 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>记梦：公交奇缘</title>
      <link href="/p/a700.html"/>
      <url>/p/a700.html</url>
      
        <content type="html"><![CDATA[<p>记录 2025 年 1 月 2 日的梦境。</p><span id="more"></span><p>梦境整体由 5 个场景组成，以下分段描述基本细节，穿插着 AI 解读。</p><h3 id="场景：等公交车"><a href="#场景：等公交车" class="headerlink" title="场景：等公交车"></a>场景：等公交车</h3><p>地点在北京，事件坐公交车。<br>一辆公交车缓缓驶来，我一上车，发现地板一踩就裂开，就像劣质的建筑材料，被风吹日晒过的石棉瓦。<br>我赶快下去，直到第三辆车来了，也是这样，但是好些，起码能站稳。<br>扶着扶手站在车上，并阻止了下面的一位女士上车。</p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2025-01-03_14-28-50.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2025-01-03_14-28-50.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2025-01-03_14-28-50" style="zoom:50%;" /><blockquote><p>AI 解读</p><p>公交车在梦境里常常象征着人生的旅程、日常的生活轨迹，或是你当下所处的社会、工作环境。</p><ul><li><strong>第一辆破车</strong>：一上车地板就裂开，类似劣质的石棉瓦，这可不是好兆头。地板代表着根基、基础，它如此脆弱，暗示着你当下生活的某个基础层面，也许是工作的平台、一段重要关系，抑或是内心的安全感，让你觉得摇摇欲坠、不堪重负，所以你本能地赶紧下车，逃离这个不安稳的处境。</li><li><strong>第三辆车的状况</strong>：第三辆车情况稍有改善，说明你在积极寻找替代方案，或是努力调整心态去适应、改善现有的生活状态。虽然它仍有瑕疵，但至少能站稳，意味着你已经向相对稳定的方向迈进了一步，可心底还是残留着对隐患的顾虑。</li><li><strong>阻止女士上车</strong>：这个举动体现出你强烈的自我保护意识，以及对他人的责任感。你深知这辆车的潜在风险，不希望他人也陷入同样不稳定的境遇，侧面反映出你对当下处境的清醒认知，还有内心善良、乐于分享判断的特质。</li></ul><p>总的来说，这个梦大概率是你近期生活里遇到了一些棘手的状况，致使内心安全感缺失，不过好在你正尝试做出改变，还不忘关照身边人。不妨审视一下当下，究竟是哪方面的事情让你有如此感受，主动出击去加固生活的“地板”。</p></blockquote><h3 id="场景：司机大爷家"><a href="#场景：司机大爷家" class="headerlink" title="场景：司机大爷家"></a>场景：司机大爷家</h3><p>车开两站，到站。停车跟着司机（一位大爷），走进一居民楼，上电梯、进入一个房间，是大爷的家。</p><p>大爷家里有 4 口人：</p><p>老奶奶，正在包汤圆，很大的那种，馅料像是紫色的糯米，皮是白色，像面粉。</p><p>大爷孙子，十五六岁，很帅气的小伙，上高中的样子；小哥旁边是一个粉色衣服，肤色略黑的小姑娘，她是大爷孙女。</p><p>两个小朋友坐在带靠背的椅子上，小哥让妹妹向旁边坐，给我让出空位，几人热情地招呼落座。</p><p>我坐下，掏出手机查看高德地图，问孙子：“咱这里是公交终点站？”，众人说是的。</p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2025-01-03_14-39-40.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2025-01-03_14-39-40.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2025-01-03_14-39-40"></p><blockquote><p>AI 解读</p><p>在解梦的视角下，这个梦境有着丰富的象征含义：</p><ul><li><strong>跟随司机大爷回家</strong>：司机在出行场景里掌控方向，象征着引导者。这位大爷带你进入他家，暗示生活中你遇到了一位经验丰富、能指引前路的长辈。走进居民楼、乘坐电梯进入他家，代表你正深入接触这个引导者的生活与观念领域，期望从中获取庇护、温暖与指引，让自己“上升”到更安稳、舒适的心理状态。</li><li><strong>老奶奶包汤圆</strong>：汤圆寓意团圆、美满，老奶奶精心制作大汤圆，营造出浓厚的家庭温馨氛围。紫色馅料神秘又独特，搭配纯洁白色的面皮，象征这段家庭关系充满别具一格的纯真美好，反映出你潜意识对温暖和睦家庭生活的向往与憧憬。</li><li><strong>孙子孙女的出现</strong>：正值青春的孙子孙女，活力满满又纯真无邪。孙子礼貌让座，显示出年轻人的热忱友善，他们热情邀请你融入其中，意味着你内心渴望融入朝气蓬勃的年轻社交圈子，重拾简单纯粹、没有太多利益纠葛的人际关系，获取轻松愉悦的相处体验。</li><li><strong>查看地图询问终点站</strong>：手机里的高德地图是定位、指引方向的工具，即便身处热闹温馨的家庭场景，你还不忘查看，说明你始终保持着一份清醒的自我意识与探索欲，不盲目沉浸。询问是否是公交终点站，映射出你对当下所处生活阶段的疑惑，不确定这是不是理想的终极状态，还是仅仅只是漫漫人生路上的一个过渡站点，体现了你对生活规划、目标追寻的审慎思考。</li></ul><p>综合来讲，这个梦勾勒了你内心对理想人际、安稳家庭氛围的向往，夹杂着对自身所处人生阶段与未来走向的不确定，近期生活里新结识的长辈、群体或许触发了这类潜意识思绪。</p></blockquote><h3 id="场景：新东方"><a href="#场景：新东方" class="headerlink" title="场景：新东方"></a>场景：新东方</h3><p>过了一会儿，又来了一个人，特别像搞笑一家人李俊河的体型发型，但是脸不像。</p><p>他坐在左边的位置上，正在看电脑屏幕，问：“你是谁？”，我说：“我是一个路人，终点站跟着司机大爷回家”。那人回答说：“您好，我是新东方的英语培训老师，要学英语的找我，鄙人有 20 年的英语培训经验”，我客套地说好的。</p><blockquote><p>AI 解读</p><p>梦境往往映射着我们潜意识中的情绪、想法与生活状态。在这个梦里：</p><ul><li><strong>形似李俊河的人</strong>：《搞笑一家人》里的李俊河形象诙谐、随性，梦到有着相似体型发型的人，为场景增添了轻松、接地气的氛围，暗示接下来的交流没有太多紧绷感，是随性自然的互动，缓解了你潜意识里可能有的紧张情绪。</li><li><strong>新东方英语培训老师身份</strong>：新东方是大众熟知的教育品牌，英语学习又关联着自我提升、拓宽视野与获取新知识。这位声称有 20 年经验的老师出现，说明你潜意识里对自我提升、学习新技能有着潜在兴趣，尤其在英语学习板块，渴望得到专业指导，让自己在知识储备或能力上更上一层楼。</li><li><strong>交流回应</strong>：你表明自己是路人，意味着当下你还处于观望状态，虽然内心燃起了学习的小火苗，但还没真正投身其中，对这件事抱着试探、游离的态度。而你客套回应，体现出面对新知识、新机遇时的谨慎，既礼貌接纳信息，又没有贸然应允，反映出你做决策时的稳重，不轻易冲动行事。</li></ul><p>总体来看，这个梦透露出你近期或许接触到了一些学习提升的机会，内心有些许触动，开始思考自我提升这件事，但还停留在考量权衡阶段，尚未下定决心开启学习之旅。</p></blockquote><h3 id="场景：离开"><a href="#场景：离开" class="headerlink" title="场景：离开"></a>场景：离开</h3><p>过一会我觉得该走了，我到大爷孙子那里，小声说：“我要走了，感谢今天的招待”。</p><p>那小伙只是略微点头回应。然后我从凳子上拿起背包，就离开了。</p><blockquote><p>AI 解读</p><p>梦境常常反映着我们内心深处的情绪与潜意识里的想法，针对这个“离开”的梦境场景：</p><ul><li><strong>决定离开</strong>：选择离开象征着你内心开启了一个阶段性的告别，有可能是你近期在现实生活里正从某段关系、某个社交圈子，又或是特定的心理舒适区中抽离出来，这并非全然是消极的，反而可能暗示着自我成长的需求，你渴望去探索新领域，不愿长久停滞。</li><li><strong>孙子的回应</strong>：孙子只是略微点头，这种相对冷淡的反馈，和之前一家人的热情形成对比，或许让你心底滋生出一丝落寞。它映射出你内心的隐忧，担心自己迈出离开这一步后，曾经拥有的亲密、温暖联系会逐渐降温，即便明知告别不可避免，还是会对关系的后续发展心存不安。</li><li><strong>拿起背包</strong>：背包是承载个人物品的物件，代表着自我的资源、过往的经历，拿起背包离开意味着你带着完整的自我、过往的沉淀，主动且笃定地迈向新旅程。你并没有因为他人稍显冷淡的回应就慌乱，可见你有足够的底气与自主性，依靠自身力量开启人生新篇。</li></ul><p>整体而言，这个梦揭示了你正处于人生的过渡阶段，一边怀揣着对未知前路的憧憬，一边夹杂些许对过往关系变迁的忐忑，不过好在你有着充足的内在力量，支持自己勇敢前行。</p></blockquote><h3 id="场景：电梯口"><a href="#场景：电梯口" class="headerlink" title="场景：电梯口"></a>场景：电梯口</h3><p>进电梯下到一楼，发现一家四口正在吵架，一男一女两口子，两个七八岁的小男孩，小男孩把牛奶或者药水之类的东西弄得满地都是，妈妈倒在地上，疑似滑倒，正在骂男孩，男人拎着一大堆东西（购物袋子）、也在教育男孩，男孩正在一直哭，说不是自己的错，爸爸教育说：“你不喜欢的东西就不爱惜，还说不是你的错？”。正在想扶不扶，发现几人身后，有个男人过来帮扶，这时左边几人正在拿手机拍摄这一幕，小声说准备发抖音还是朋友圈。</p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2025-01-03_14-41-42.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2025-01-03_14-41-42.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2025-01-03_14-41-42"></p><blockquote><p>AI 解读</p><p>电梯下楼与冲突场景</p><ul><li><strong>电梯下行</strong>：电梯常常象征着人生的起起落落，从楼上下来到一楼，代表着从相对安稳、私密的高层环境进入到更公开、复杂的公共区域，可能暗示你正从内心较为平静、理想的精神状态过渡到要直面现实生活中的琐事与矛盾。</li><li><strong>家庭吵架画面</strong>：一家四口的激烈争吵映射出家庭关系中的紧张与失衡。夫妻二人同时教育孩子，体现出家庭中的权威力量，而孩子的委屈哭泣、坚称不是自己的错，反映出代际之间沟通不畅，孩子感觉被误解，这或许象征着你内心对家庭关系、沟通模式的隐忧，或是勾起了你过往类似不愉快的家庭经历记忆。</li></ul><p>具体事件元素</p><ul><li><strong>洒满地的液体</strong>：牛奶或药水这类液体洒了一地，牛奶通常有滋养、温和的寓意，药水关联着治愈、补救，如今满地狼藉，意味着原本的滋养、治愈资源被破坏，可能暗示生活中一些美好、补救的机会被错失，或是本该顺畅的事务发展进程被打乱。</li><li><strong>妈妈滑倒</strong>：妈妈摔倒在地，妈妈在家庭里往往是温柔、呵护的角色象征，她摔倒暗示着家庭中的情感支撑、柔性关怀出现了问题，家庭秩序陷入混乱，也反映出你潜意识里担心家庭关系里的脆弱环节崩塌。</li></ul><p>扶与不扶的纠结及旁人反应</p><ul><li><strong>扶不扶的纠结</strong>：你内心纠结要不要扶，体现出面对他人困境时的道德考量与自我保护意识的冲突。这或许不仅关乎这场家庭闹剧，更映射到你在生活里碰到他人麻烦事时，是勇敢介入还是明哲保身的犹豫心态。</li><li><strong>旁人帮扶与拍摄</strong>：有人来帮扶，代表着生活中总有关爱、正义的力量存在，给人希望；而旁人拿手机拍摄准备发社交平台，如今社交平台充斥着大量碎片化信息，这一幕象征着生活事件被曝光、公开化，人们围观他人的生活难题，可能暗示你对当下社会风气中过度消费他人苦难、注重表面展示的现象有所思考。</li></ul><p>综合来看，这个梦融合了你对家庭关系、社会道德风气以及个人面对复杂状况时心理抉择的多重潜意识思考，近期生活中的相关见闻、情绪很可能触发了这类梦境。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 神秘主义 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 记梦 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PVE8 下虚拟磁盘设置 TRIM</title>
      <link href="/p/5355.html"/>
      <url>/p/5355.html</url>
      
        <content type="html"><![CDATA[<p>TRIM 是 SSD 进行回收硬盘上未使用的块的方法，该块可能先前已被写入，但不再包含有效数据，因此可以返回到通用存储池以供重用。<br>对于 PVE 管理的虚拟磁盘，则需要进行相关设置才能正常触发。</p><span id="more"></span><div class="story post-story"><h2 id="实验环境"><a href="#实验环境" class="headerlink" title="实验环境"></a>实验环境</h2><p>PVE 8.2.7</p></div><div class="story post-story"><h2 id="背景：虚拟磁盘空间占用"><a href="#背景：虚拟磁盘空间占用" class="headerlink" title="背景：虚拟磁盘空间占用"></a>背景：虚拟磁盘空间占用</h2><p>今天发现有台 Ubuntu22.04 的虚拟机，虚拟磁盘占用要比系统内实际使用多得多。</p><p>如下图：其 disk size 为 105GB。</p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-12-29_15-19-33.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-12-29_15-19-33.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2024-12-29_15-19-33" style="zoom: 67%;" /><p>SSH 连接看一下系统内实际占用：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">╭─dsf@jump-server ~ </span><br><span class="line">╰─$ <span class="built_in">df</span> -h              </span><br><span class="line">文件系统        大小  已用  可用 已用% 挂载点</span><br><span class="line">tmpfs           392M  2.1M  390M    1% /run</span><br><span class="line">/dev/sda2       147G   36G  104G   26% /</span><br><span class="line">tmpfs           2.0G     0  2.0G    0% /dev/shm</span><br><span class="line">tmpfs           5.0M     0  5.0M    0% /run/lock</span><br><span class="line">tmpfs           392M  4.0K  392M    1% /run/user/1000</span><br></pre></td></tr></table></figure><p>可以知道实际使用的空间大小约为 37G。</p><p>此虚拟机使用基于目录的后端存储，虚拟磁盘存储在 PVE 本机磁盘（一块 NVMe SSD）。</p></div><div class="story post-story"><h2 id="基本原理"><a href="#基本原理" class="headerlink" title="基本原理"></a>基本原理</h2><p>为什么要对 SSD 进行 TRIM 呢？</p><blockquote><p><a href="https://zh.wikipedia.org/wiki/Trim%E5%91%BD%E4%BB%A4">维基百科</a></p><p>Trim（意为修整、修剪、裁剪）使 SSD 能更有效地完成<a href="https://zh.wikipedia.org/wiki/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6_(%E8%A8%88%E7%AE%97%E6%A9%9F%E7%A7%91%E5%AD%B8)">垃圾收集</a>的工作，而不用牺牲对存储块的写入速度。</p></blockquote><p>目前市面上出售的消费级、企业级 SSD 都是支持 TRIM 功能，如下图 ZHITAI P7100：</p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-12-29_15-37-03.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-12-29_15-37-03.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2024-12-29_15-37-03" style="zoom: 50%;" /><p>检索 PVE 官方文档得知，在虚拟磁盘满足以下要求，且对虚拟磁盘进行额外设置才能触发 Guest 的磁盘 TRIM。</p><blockquote><p><a href="https://pve.proxmox.com/wiki/Shrink_Qcow2_Disk_Files">Shrink Qcow2 Disk Files</a></p><p>Requirements:</p><ul><li>Thin-provisioned backing storage (qcow2 disk, thin-lvm, zfs, …)</li><li><em>Virtio-SCSI</em> controller configured on guest.</li><li>Guest scsi disks with the <em>discard</em> option enabled</li></ul></blockquote></div><div class="story post-story"><h2 id="HOST-设置"><a href="#HOST-设置" class="headerlink" title="HOST 设置"></a>HOST 设置</h2><p>在 PVE 的 WebUI 对<code>.qcow2</code>格式的虚拟磁盘开启丢弃功能即可（如果是 SSD 建议勾选<code>SSD仿真</code>、<code>IO thread</code>），变更设置后需要重启虚拟机才能生效。</p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-12-29_14-29-05.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-12-29_14-29-05.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2024-12-29_14-29-05" style="zoom:50%;" /></div><div class="story post-story"><h2 id="GUEST-TRIM"><a href="#GUEST-TRIM" class="headerlink" title="GUEST TRIM"></a>GUEST TRIM</h2><p>现代的 Linux 系统，都是基于<code>fstrim</code>实现的 TRIM 操作。使用以下命令可以立即进行 TRIM：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fstrim -av</span><br></pre></td></tr></table></figure><p>Debian&#x2F;Ubuntu&#x2F;RHEL的主流系统，都是实现了一个计划每周运行它的 systemd 计时器服务。</p><h3 id="Ubuntu-Server-22-04"><a href="#Ubuntu-Server-22-04" class="headerlink" title="Ubuntu Server 22.04"></a>Ubuntu Server 22.04</h3><p>列出所有计时器，可以看到<code>fstrim.timer</code>默认启用，它最后运行在两天前，9 小时后将会被触发。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">╭─dsf@jump-server ~ </span><br><span class="line">╰─$ systemctl list-timers --all</span><br><span class="line">NEXT                        LEFT          LAST                        PASSED               UNIT                           ACTIVATES                       </span><br><span class="line">Sun 2024-12-29 14:34:55 CST 3min 7s left  n/a                         n/a                  update-notifier-download.timer update-notifier-download.service</span><br><span class="line">Sun 2024-12-29 14:44:53 CST 13min left    n/a                         n/a                  systemd-tmpfiles-clean.timer   systemd-tmpfiles-clean.service</span><br><span class="line">Sun 2024-12-29 15:16:56 CST 45min left    n/a                         n/a                  ua-timer.timer                 ua-timer.service</span><br><span class="line">Sun 2024-12-29 19:29:48 CST 4h 58min left Sun 2024-12-29 13:54:19 CST 37min ago            motd-news.timer                motd-news.service</span><br><span class="line">Sun 2024-12-29 20:24:57 CST 5h 53min left Sun 2024-12-29 12:27:19 CST 2h 4min ago          apt-daily.timer                apt-daily.service</span><br><span class="line">Mon 2024-12-30 00:00:00 CST 9h left       n/a                         n/a                  dpkg-db-backup.timer           dpkg-db-backup.service</span><br><span class="line">Mon 2024-12-30 00:00:00 CST 9h left       Sun 2024-12-29 00:00:00 CST 14h ago              logrotate.timer                logrotate.service</span><br><span class="line">Mon 2024-12-30 00:00:59 CST 9h left       Thu 2024-12-26 14:47:01 CST 2 days ago           fstrim.timer                   fstrim.service</span><br><span class="line">Mon 2024-12-30 02:54:28 CST 12h left      Sun 2024-12-29 12:09:19 CST 2h 22min ago         fwupd-refresh.timer            fwupd-refresh.service</span><br><span class="line">Mon 2024-12-30 05:14:26 CST 14h left      Sun 2024-12-29 05:16:19 CST 9h ago               man-db.timer                   man-db.service</span><br><span class="line">Mon 2024-12-30 06:07:55 CST 15h left      Sun 2024-12-29 06:26:14 CST 8h ago               apt-daily-upgrade.timer        apt-daily-upgrade.service</span><br><span class="line">Thu 2025-01-02 04:03:52 CST 3 days left   Sun 2024-06-30 15:32:51 CST 5 months 29 days ago update-notifier-motd.timer     update-notifier-motd.service</span><br><span class="line">Sun 2025-01-05 03:10:33 CST 6 days left   Sun 2024-12-29 03:11:14 CST 11h ago              e2scrub_all.timer              e2scrub_all.service</span><br><span class="line">n/a                         n/a           n/a                         n/a                  apport-autoreport.timer        apport-autoreport.service</span><br><span class="line">n/a                         n/a           n/a                         n/a                  snapd.snap-repair.timer        snapd.snap-repair.service</span><br></pre></td></tr></table></figure><p>我显式地执行一遍 fstrim，后，再到 PVE 查看虚拟磁盘的大小，disk size 已经是正常大小，问题解决。</p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-12-29_15-49-50.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-12-29_15-49-50.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2024-12-29_15-49-50" style="zoom:67%;" /><h3 id="Rocky-Linux-9"><a href="#Rocky-Linux-9" class="headerlink" title="Rocky Linux 9"></a>Rocky Linux 9</h3><p>在 Rocky Linux 9 上，<code>fstrim.timer</code>默认没有启用，需要手动开启。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##查看TRIM定时器服务状态</span></span><br><span class="line">╭─dsf@app ~ </span><br><span class="line">╰─$ sudo systemctl status fstrim.timer</span><br><span class="line">○ fstrim.timer - Discard unused blocks once a week</span><br><span class="line">     Loaded: loaded (/usr/lib/systemd/system/fstrim.timer; disabled; preset: disabled)</span><br><span class="line">     Active: inactive (dead)</span><br><span class="line">    Trigger: n/a</span><br><span class="line">   Triggers: ● fstrim.service</span><br><span class="line">       Docs: man:fstrim</span><br><span class="line"><span class="comment">##开启服务</span></span><br><span class="line">╭─dsf@app ~ </span><br><span class="line">╰─$ sudo systemctl <span class="built_in">enable</span> fstrim.timer                                                                                           </span><br><span class="line">Created symlink /etc/systemd/system/timers.target.wants/fstrim.timer → /usr/lib/systemd/system/fstrim.timer.</span><br></pre></td></tr></table></figure><h3 id="Windows-Server-2022-Datacenter"><a href="#Windows-Server-2022-Datacenter" class="headerlink" title="Windows Server 2022 Datacenter"></a>Windows Server 2022 Datacenter</h3><p>Windows 内置了磁盘整理工具，在<code>开始菜单</code>-<code>Windows工具</code>-<code>磁盘整理和优化驱动器</code>打开。</p><p>可以看到运行周期为每月（Windows 默认是每周，这里每月是因为我调整过）。点击<code>优化</code>按钮可以立即进行 TRIM。</p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-12-29_14-41-39.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-12-29_14-41-39.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2024-12-29_14-41-39" style="zoom:50%;" /><p>我对这台 Windows 虚拟机立即进行 TRIM 后，其 disk size 从 212G 减小到 103G。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###TRIM前虚拟磁盘大小</span></span><br><span class="line">╭─root@pve /var/lib/vz/images </span><br><span class="line">╰─<span class="comment"># qemu-img info ./249/vm-249-disk-1.qcow2</span></span><br><span class="line">image: ./249/vm-249-disk-1.qcow2</span><br><span class="line">file format: qcow2</span><br><span class="line">virtual size: 300 GiB (322122547200 bytes)</span><br><span class="line">disk size: 212 GiB</span><br><span class="line">cluster_size: 65536</span><br><span class="line">Format specific information:</span><br><span class="line">    compat: 1.1</span><br><span class="line">    compression <span class="built_in">type</span>: zlib</span><br><span class="line">    lazy refcounts: <span class="literal">false</span></span><br><span class="line">    refcount bits: 16</span><br><span class="line">    corrupt: <span class="literal">false</span></span><br><span class="line">    extended l2: <span class="literal">false</span></span><br><span class="line">Child node <span class="string">&#x27;/file&#x27;</span>:</span><br><span class="line">    filename: ./249/vm-249-disk-1.qcow2</span><br><span class="line">    protocol <span class="built_in">type</span>: file</span><br><span class="line">    file length: 300 GiB (322171961344 bytes)</span><br><span class="line">    disk size: 212 GiB</span><br><span class="line"></span><br><span class="line"><span class="comment">###TRIM后虚拟磁盘大小</span></span><br><span class="line">╭─root@pve /var/lib/vz/images </span><br><span class="line">╰─<span class="comment"># qemu-img info ./249/vm-249-disk-1.qcow2</span></span><br><span class="line">image: ./249/vm-249-disk-1.qcow2</span><br><span class="line">file format: qcow2</span><br><span class="line">virtual size: 300 GiB (322122547200 bytes)</span><br><span class="line">disk size: 103 GiB</span><br><span class="line">cluster_size: 65536</span><br><span class="line">Format specific information:</span><br><span class="line">    compat: 1.1</span><br><span class="line">    compression <span class="built_in">type</span>: zlib</span><br><span class="line">    lazy refcounts: <span class="literal">false</span></span><br><span class="line">    refcount bits: 16</span><br><span class="line">    corrupt: <span class="literal">false</span></span><br><span class="line">    extended l2: <span class="literal">false</span></span><br><span class="line">Child node <span class="string">&#x27;/file&#x27;</span>:</span><br><span class="line">    filename: ./249/vm-249-disk-1.qcow2</span><br><span class="line">    protocol <span class="built_in">type</span>: file</span><br><span class="line">    file length: 300 GiB (322171961344 bytes)</span><br><span class="line">    disk size: 103 GiB</span><br></pre></td></tr></table></figure><p>产生的虚拟机备份也显著变小：从 68.48G 减小到 25.67G。103G 磁盘大小的虚拟机，产生的备份为 25.67G，这个压缩率挺高，无怪乎<code>ZSTD (又快又好)</code>。</p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-12-29_16-00-34.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-12-29_16-00-34.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2024-12-29_16-00-34" style="zoom:50%;" /></div><div class="story post-story"><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>对虚拟磁盘定期进行 TRIM 是一项很有用的维护操作，能提高磁盘性能，降低备份业务占用的带宽。</p><p>由于 LXC 使用的虚拟磁盘格式为<code>.raw</code>，所以无法进行 TRIM 操作。</p></div><div class="story post-story"><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a href="https://pve.proxmox.com/wiki/Shrink_Qcow2_Disk_Files">Shrink Qcow2 Disk Files - Proxmox VE</a></li><li><a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/8/html/managing_file_systems/discarding-unused-blocks_managing-file-systems#enabling-online-block-discard_discarding-unused-blocks">Chapter 24. Discarding unused blocks ｜ Red Hat Product Documentation</a></li></ul><p>-EOF</p><p>查看最新版，请访问本文链接：<a href="https://blog.onehat.cn/p/5355.html">https://blog.onehat.cn/p/5355.html</a></p><p>原创作品，转载请保留出处。</p></div>]]></content>
      
      
      <categories>
          
          <category> 工作坊 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技术 </tag>
            
            <tag> PVE </tag>
            
            <tag> Linux </tag>
            
            <tag> Windows Server </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PVE8 下 Rocky Linux 9 根分区扩容</title>
      <link href="/p/7146.html"/>
      <url>/p/7146.html</url>
      
        <content type="html"><![CDATA[<p>有台 Rocky Linux 9 虚拟机根分区空间不足，记录对其扩容的操作。</p><span id="more"></span><h3 id="实验环境"><a href="#实验环境" class="headerlink" title="实验环境"></a>实验环境</h3><p>PVE 8.2.7</p><p>Rocky Linux 9.4</p><h3 id="背景：Zabbix-告警"><a href="#背景：Zabbix-告警" class="headerlink" title="背景：Zabbix 告警"></a>背景：Zabbix 告警</h3><p>Zabbix 的告警信息为分区容量占用大于 80%。</p><p><img src="https://gcore.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-12-15_22-20-46.png" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-12-15_22-20-46.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2024-12-15_22-20-46"></p><p>ssh 上去看一下分区占用情况</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">╭─dsf@app ~</span><br><span class="line">╰─$ <span class="built_in">df</span> -h</span><br><span class="line">文件系统                   容量  已用  可用 已用% 挂载点</span><br><span class="line">devtmpfs                   4.0M     0  4.0M    0% /dev</span><br><span class="line">tmpfs                      4.8G     0  4.8G    0% /dev/shm</span><br><span class="line">tmpfs                      1.9G  194M  1.7G   11% /run</span><br><span class="line">/dev/mapper/rl-root         70G   59G   12G   85% /</span><br><span class="line">/dev/sda2                  960M  367M  594M   39% /boot</span><br><span class="line">/dev/sda1                  599M  7.1M  592M    2% /boot/efi</span><br><span class="line">tmpfs                      966M  4.0K  966M    1% /run/user/0</span><br><span class="line">/dev/mapper/rl-home         75G  834M   74G    2% /home</span><br><span class="line">tmpfs                      966M  4.0K  966M    1% /run/user/1000</span><br><span class="line"></span><br><span class="line">╭─dsf@app ~</span><br><span class="line">╰─$ sudo lsblk</span><br><span class="line">NAME        MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS</span><br><span class="line">sda           8:0    0   210G  0 disk</span><br><span class="line">├─sda1        8:1    0   600M  0 part /boot/efi</span><br><span class="line">├─sda2        8:2    0     1G  0 part /boot</span><br><span class="line">└─sda3        8:3    0 208.4G  0 part</span><br><span class="line">  ├─rl-root 253:0    0    70G  0 lvm  /</span><br><span class="line">  ├─rl-swap 253:1    0   3.9G  0 lvm  [SWAP]</span><br><span class="line">  └─rl-home 253:2    0  74.5G  0 lvm  /home</span><br></pre></td></tr></table></figure><p>可以看到，根分区<code>/</code>占用已达 85%，所以触发了告警。所以操作目标就是为根分区增加合适的容量。</p><h3 id="PVE-操作硬盘扩容"><a href="#PVE-操作硬盘扩容" class="headerlink" title="PVE 操作硬盘扩容"></a>PVE 操作硬盘扩容</h3><p>直接在 PVE 的 WebUI 操作：</p><p>选中 VM，【硬件】-【硬盘】-【磁盘操作】-【调整大小】，输入 60，点击【调整磁盘大小】按钮以确认。</p><p><img src="https://gcore.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-12-15_22-41-21.png" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-12-15_22-41-21.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2024-12-15_22-41-21"></p><h3 id="Rocky-Linux-虚拟机内部分区扩容"><a href="#Rocky-Linux-虚拟机内部分区扩容" class="headerlink" title="Rocky Linux 虚拟机内部分区扩容"></a>Rocky Linux 虚拟机内部分区扩容</h3><p>由于虚拟磁盘为 SCSI 类型，所以在 pve 上操作虚拟机磁盘扩容后，无需重启虚拟机即可在“硬件”层面生效。</p><p>ssh 连接到这台虚拟机，执行命令如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># parted命令行调整分区表</span></span><br><span class="line">╭─dsf@app ~</span><br><span class="line">╰─$ sudo parted /dev/sda</span><br><span class="line">GNU Parted 3.5</span><br><span class="line">使用 /dev/sda</span><br><span class="line">欢迎使用 GNU Parted！输入 <span class="string">&#x27;help&#x27;</span> 来查看命令列表。</span><br><span class="line">(parted) <span class="built_in">print</span></span><br><span class="line">警告: 并非所有可用于 /dev/sda 的空间都被用到了，您可以修正 GPT 以使用所有的空间 (额外的 125829120 个区块)，还是说要继续使用目前的设置？</span><br><span class="line">修正/Fix/忽略/Ignore? Fix</span><br><span class="line">型号：QEMU QEMU HARDDISK (scsi)</span><br><span class="line">磁盘 /dev/sda：225GB</span><br><span class="line">扇区大小 (逻辑/物理)：512B/512B</span><br><span class="line">分区表：gpt</span><br><span class="line">磁盘标志：</span><br><span class="line"></span><br><span class="line">编号  起始点  结束点  大小    文件系统  名称                  标志</span><br><span class="line"> 1    1049kB  630MB   629MB   fat32     EFI System Partition  启动, esp</span><br><span class="line"> 2    630MB   1704MB  1074MB  xfs</span><br><span class="line"> 3    1704MB  161GB   159GB                                   lvm</span><br><span class="line"></span><br><span class="line">(parted) resizepart 3 100%</span><br><span class="line">(parted) <span class="built_in">print</span></span><br><span class="line">型号：QEMU QEMU HARDDISK (scsi)</span><br><span class="line">磁盘 /dev/sda：225GB</span><br><span class="line">扇区大小 (逻辑/物理)：512B/512B</span><br><span class="line">分区表：gpt</span><br><span class="line">磁盘标志：</span><br><span class="line"></span><br><span class="line">编号  起始点  结束点  大小    文件系统  名称                  标志</span><br><span class="line"> 1    1049kB  630MB   629MB   fat32     EFI System Partition  启动, esp</span><br><span class="line"> 2    630MB   1704MB  1074MB  xfs</span><br><span class="line"> 3    1704MB  225GB   224GB                                   lvm</span><br><span class="line"></span><br><span class="line">(parted) quit</span><br><span class="line">信息: 你可能需要 /etc/fstab。</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新物理卷</span></span><br><span class="line">╭─dsf@app ~</span><br><span class="line">╰─$ sudo pvresize /dev/sda3</span><br><span class="line">  Physical volume <span class="string">&quot;/dev/sda3&quot;</span> changed</span><br><span class="line">  1 physical volume(s) resized or updated / 0 physical volume(s) not resized</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将逻辑卷组中的空闲空间全部分配到指定分区</span></span><br><span class="line">╭─dsf@app ~</span><br><span class="line">╰─$ sudo lvextend -l +100%FREE /dev/rl/root</span><br><span class="line">  Size of logical volume rl/root changed from 70.00 GiB (17920 extents) to 130.00 GiB (33280 extents).</span><br><span class="line">  Logical volume rl/root successfully resized.</span><br><span class="line"><span class="comment"># 执行扩容生效</span></span><br><span class="line">╭─dsf@app ~</span><br><span class="line">╰─$ sudo xfs_growfs /dev/rl/root                                                                                                             1 ↵</span><br><span class="line">meta-data=/dev/mapper/rl-root    isize=512    agcount=4, agsize=4587520 blks</span><br><span class="line">         =                       sectsz=512   attr=2, projid32bit=1</span><br><span class="line">         =                       crc=1        finobt=1, sparse=1, rmapbt=0</span><br><span class="line">         =                       reflink=1    bigtime=1 inobtcount=1 nrext64=0</span><br><span class="line">data     =                       bsize=4096   blocks=18350080, imaxpct=25</span><br><span class="line">         =                       sunit=0      swidth=0 blks</span><br><span class="line">naming   =version 2              bsize=4096   ascii-ci=0, ftype=1</span><br><span class="line"><span class="built_in">log</span>      =internal <span class="built_in">log</span>           bsize=4096   blocks=16384, version=2</span><br><span class="line">         =                       sectsz=512   sunit=0 blks, lazy-count=1</span><br><span class="line">realtime =none                   extsz=4096   blocks=0, rtextents=0</span><br><span class="line">data blocks changed from 18350080 to 34078720</span><br></pre></td></tr></table></figure><p>可以看到，分区操作使用的基本命令行工具还是<code>parted</code>，在 <a href="https://blog.onehat.cn/p/bd39.html">PVE8 下 iStoreOS_x86 根分区扩容</a> 一文中，也是使用的此工具。由于 Rocky Linux 属于红帽系，所以相比于 iStoreOS 有涉及调整物理卷、逻辑卷的命令操作。</p><p>调整完成后的分区占用，根分区大小已经为 130G。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">╭─dsf@app ~</span><br><span class="line">╰─$ <span class="built_in">df</span> -h</span><br><span class="line">文件系统                   容量  已用  可用 已用% 挂载点</span><br><span class="line">devtmpfs                   4.0M     0  4.0M    0% /dev</span><br><span class="line">tmpfs                      4.8G     0  4.8G    0% /dev/shm</span><br><span class="line">tmpfs                      1.9G  194M  1.7G   11% /run</span><br><span class="line">/dev/mapper/rl-root        130G   60G   71G   46% /</span><br><span class="line">/dev/sda2                  960M  367M  594M   39% /boot</span><br><span class="line">/dev/sda1                  599M  7.1M  592M    2% /boot/efi</span><br><span class="line">tmpfs                      966M  4.0K  966M    1% /run/user/0</span><br><span class="line">/dev/mapper/rl-home         75G  834M   74G    2% /home</span><br><span class="line">tmpfs                      966M  4.0K  966M    1% /run/user/1000</span><br></pre></td></tr></table></figure><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul><li><a href="https://docs.redhat.com/zh-cn/documentation/red_hat_enterprise_linux/8/html-single/configuring_and_managing_logical_volumes/configuring_and_managing_logical_volumes#proc_providing-feedback-on-red-hat-documentation_configuring-and-managing-logical-volumes">配置和管理逻辑卷 | Red Hat Product</a></li><li><a href="https://blog.csdn.net/hg_zhh/article/details/140734289">PVE 环境中调整虚拟机磁盘大小_pve 调整磁盘大小-CSDN 博客</a></li></ul><p>-EOF</p><p>查看最新版，请访问本文链接：<a href="https://blog.onehat.cn/p/7146.html">https://blog.onehat.cn/p/7146.html</a></p><p>原创作品，转载请保留出处。</p>]]></content>
      
      
      <categories>
          
          <category> 工作坊 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技术 </tag>
            
            <tag> PVE </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSS 字体平滑：本站切换字体的尝试</title>
      <link href="/p/f85a.html"/>
      <url>/p/f85a.html</url>
      
        <content type="html"><![CDATA[<p>记录 CSS 字体平滑开启与否对显示效果的影响。</p><span id="more"></span><h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>周末尝试把本站字体切换为了衬线字体，原本首选是 <code>Noto Serif SC</code>，但是考虑字体文件过大影响网页加载速度，不得不另外寻找。</p><p>最终选定字体：<code>Source Han Serif CN</code>，此字体由<a href="https://github.com/yihui/"> @yihui </a>（谢益辉大佬）提取、整合自思源宋体。我在网上冲浪时发现于 <a href="https://github.com/yihui/yihui.org/discussions/1547">Github</a>。</p><p>并且把首选字体为网络资源，浏览器会直接调用来渲染显示，这样移动设备就不会由于字体缺失，无法显示正确的字体。</p><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>应用到本站后，我发现字体显示效果并不是预期的样子。同等环境下（macOS+Chrome 浏览器），对比谢益辉大佬和我的博文显示效果如下图：</p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-12-09_14-42-45.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-12-09_14-42-45.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2024-12-09_14-42-45"></p><p>（<a href="https://yihui.org/cn/2022/07/river-god/">左图博文 </a>|<a href="https://blog.onehat.cn/p/9a33.html"> 右图博文</a>）</p><p>明显左图的字体更加清晰、黑，右图字体发虚、细。</p><h3 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h3><p>经过检索<a href="https://github.com/volantis-x/hexo-theme-volantis">本站主题</a>配置文档，发现是一个字体配置项的影响：</p><figure class="highlight yaml"><figcaption><span>_config.volantis.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">custom_css:</span></span><br><span class="line">  <span class="attr">font_smoothing:</span> <span class="literal">true</span> <span class="comment">#字体平滑选项</span></span><br></pre></td></tr></table></figure><p>这个配置项作用为影响页面 CSS 属性<code>font-smooth</code>，值变为<code>antialiased</code>：</p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-12-09_15-02-06.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-12-09_15-02-06.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2024-12-09_15-02-06" style="zoom: 33%;" /><p>检索 <a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/font-smooth">MDN</a> 文档，相关描述如下：</p><blockquote><p>Webkit 实现了名为 <strong><code>-webkit-font-smoothing</code></strong> 的相似属性。该属性仅适用于 macOS。</p><ul><li><code>auto</code>——由浏览器决定（如果可用，则使用亚像素抗锯齿；这是默认值）。</li><li><code>none</code>——关闭字体平滑；显示带有锯齿边缘的文本。</li><li><code>antialiased</code>——在像素（而不是亚像素）级别平滑字体。对于深色背景上的浅色文本，从亚像素渲染切换为抗锯齿渲染可以使其看起来更清晰。</li><li><code>subpixel-antialiased</code>——在大多数非视网膜显示器上，这将会提供最清晰的文本。</li></ul></blockquote><p>我修改主题配置项 <code>font_smoothing: false</code> 后，对应的 CSS 属性值变为 <code>auto</code>。</p><p>此时再来查看博文，发现字体显示正常，不那么细了，问题解决。</p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-12-09_12-52-21.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-12-09_12-52-21.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2024-12-09_12-52-21"></p><p>（左图：<code>-webkit-font-smoothing: antialiased</code> | 右图：<code>-webkit-font-smoothing: auto</code>）</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>字体平滑属性启用后会使字体“显得”更细，不适用宋体这种本来就较细的字形。</p><h3 id="字体题外话"><a href="#字体题外话" class="headerlink" title="字体题外话"></a>字体题外话</h3><p>尝试把本站字体切换为衬线字体，坚持了一天后，我还是回到了无衬线字体<code>Noto Sans SC</code>。</p><p>相比于在高分屏上清晰而锐利、低分屏上惨不忍睹的宋体，各种无衬线黑体在高分屏上表现优秀，在低分屏上表现更佳。</p><p>所以我最终还是选择无衬线黑体，且仅配置<code>font-family</code>，不使用网络字体，以便使用各个操作系统平台本身优秀的无衬线字体。</p><p>-EOF</p><p>查看最新版，请访问本文链接：<a href="https://blog.onehat.cn/p/f85a.html">https://blog.onehat.cn/p/f85a.html</a></p><p>原创作品，转载请保留出处。</p>]]></content>
      
      
      <categories>
          
          <category> 工作坊 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技术 </tag>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Rocky Linux 9 调整 swap 空间</title>
      <link href="/p/4a82.html"/>
      <url>/p/4a82.html</url>
      
        <content type="html"><![CDATA[<p>swap 空间，即交换空间，是 Linux 系统中类似 Windows 虚拟内存的机制，它旨在帮助设备，应对内存消耗大于内存容量的场景。</p><span id="more"></span><h3 id="基本原理"><a href="#基本原理" class="headerlink" title="基本原理"></a>基本原理</h3><p><a href="https://docs.redhat.com/zh-cn/documentation/red_hat_enterprise_linux/7/html/storage_administration_guide/ch-swapspace#ch-swapspace">红帽文档</a>给出这样的描述：</p><blockquote><p>当物理内存 (RAM) 已满时，将使用 Linux 中的 交换空间。如果系统需要更多的内存资源并且 RAM 已满，内存中的不活动页面将移到交换空间。虽然交换空间可以帮助具有少量 RAM 的计算机，但不应将其视为更多 RAM 的替代品。交换空间位于硬盘驱动器上，其访问时间比物理内存要慢。交换空间可以是专用的交换分区（推荐）、交换文件，或者交换分区和交换文件的组合。请注意，Btrfs 不支持 swap 空间。</p></blockquote><h3 id="背景：Zabbix-告警"><a href="#背景：Zabbix-告警" class="headerlink" title="背景：Zabbix 告警"></a>背景：Zabbix 告警</h3><p>Zabbix 纳管虚拟机，如果 swap 占用过高，会有如下告警：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">High swap space usage (less than 50% free)</span><br></pre></td></tr></table></figure><p>查看对应设备的 swap 分区占用情况：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">╭─dsf@app ~</span><br><span class="line">╰─$ free -m</span><br><span class="line">               total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:            9652        7222         745           9        1999        2429</span><br><span class="line">Swap:           3995        3030         965</span><br></pre></td></tr></table></figure><p>如果排查过后，您认为此告警并不由内存异常的场景原因触发，可能需要调大 swap 分区。</p><p>红帽推荐的 swap 空间大小如下：</p><table><thead><tr><th>系统中的 RAM 量</th><th>推荐的 swap 空间</th><th>如果允许休眠则推荐使用 swap 空间</th></tr></thead><tbody><tr><td>⩽ 2 GB</td><td>RAM 量的 2 倍</td><td>RAM 量的 3 倍</td></tr><tr><td>&gt; 2 GB – 8 GB</td><td>与 RAM 量相等</td><td>RAM 量的 2 倍</td></tr><tr><td>&gt; 8 GB – 64 GB</td><td>至少 4 GB</td><td>RAM 量的 1.5 倍</td></tr><tr><td>&gt; 64 GB</td><td>至少 4 GB</td><td>不推荐休眠</td></tr></tbody></table><h3 id="调整-swap"><a href="#调整-swap" class="headerlink" title="调整 swap"></a>调整 swap</h3><p>操作目标是增加 10G 空间。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">╭─dsf@app ~</span><br><span class="line">╰─$ free -m</span><br><span class="line">               total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:            9652        7222         745           9        1999        2429</span><br><span class="line">Swap:           3995        3030         965</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## 使用 dd 命令创建 SWAP 文件（例如创建 10GB 的 SWAP）：</span></span></span><br><span class="line">╭─dsf@app /usr</span><br><span class="line">╰─$ sudo dd if=/dev/zero of=/usr/swap/swap0 bs=1M count=10240 status=progress</span><br><span class="line">9088008192字节（9.1 GB，8.5 GiB）已复制，3 s，3.0 GB/s</span><br><span class="line">记录了10240+0 的读入</span><br><span class="line">记录了10240+0 的写出</span><br><span class="line">10737418240字节（11 GB，10 GiB）已复制，3.49771 s，3.1 GB/s</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## 设置正确的权限：使其不可读</span></span></span><br><span class="line">╭─dsf@app /usr</span><br><span class="line">╰─$ sudo chmod 600 /usr/swap/swap0</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## 格式化为SWAP文件系统</span></span></span><br><span class="line">╭─dsf@app /usr</span><br><span class="line">╰─$ sudo mkswap /usr/swap/swap0</span><br><span class="line">正在设置交换空间版本 1，大小 = 10 GiB (10737414144  个字节)</span><br><span class="line">无标签，UUID=da341844-72da-44c5-abf5-6f2c5d9c1f61</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## 启用SWAP文件</span></span></span><br><span class="line">╭─dsf@app /usr</span><br><span class="line">╰─$ sudo swapon /usr/swap/swap0</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## 设置开机自动启用，编辑 /etc/fstab 文件</span></span></span><br><span class="line">╭─dsf@app /usr</span><br><span class="line">╰─$ echo &#x27;/usr/swap/swap0 none swap sw 0 0&#x27; | sudo tee -a /etc/fstab</span><br><span class="line">/usr/swap/swap0 none swap sw 0 0</span><br></pre></td></tr></table></figure><p>再次查看 swap 信息，已经生效（无需重启机器）：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">╭─dsf@app /usr</span><br><span class="line">╰─$ free -m</span><br><span class="line">               total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:            9652        7220         179           9        2563        2431</span><br><span class="line">Swap:          14235        3030       11205</span><br><span class="line">╭─dsf@app /usr</span><br><span class="line">╰─$ swapon --show</span><br><span class="line">NAME            TYPE      SIZE USED PRIO</span><br><span class="line">/dev/dm-1       partition 3.9G   3G   -2</span><br><span class="line">/usr/swap/swap0 file       10G   0B   -3</span><br></pre></td></tr></table></figure><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul><li><a href="https://docs.redhat.com/zh-cn/documentation/red_hat_enterprise_linux/7/html/storage_administration_guide/ch-swapspace#ch-swapspace">第 15 章 swap 空间 Red Hat Product Documentation</a></li><li><a href="https://blog.curder.com/posts/how-to-add-swap-space-on-rocky-linux#enable-swap">Rocky Linux 上添加 SWAP 交换分区 - 戏里戏外的博客</a></li></ul><p>-EOF</p><p>查看最新版，请访问本文链接：<a href="https://blog.onehat.cn/p/4a82.html">https://blog.onehat.cn/p/4a82.html</a></p><p>原创作品，转载请保留出处。</p>]]></content>
      
      
      <categories>
          
          <category> 工作坊 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技术 </tag>
            
            <tag> Linux </tag>
            
            <tag> Zabbix </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>现代诗：《我》</title>
      <link href="/p/937c.html"/>
      <url>/p/937c.html</url>
      
        <content type="html"><![CDATA[<p>《我》，是一首现代诗，于 2024 年 12 月 6 日中午，有感而作。</p><span id="more"></span><hr><blockquote><p>《我》</p><p>幼时极目望天边</p><p>飞鸟点点</p><p>少年执笔画圆</p><p>壮志了无边</p><p>青年奋斗不值闲</p><p>几许惆怅在心间</p><p>如今已到而立年</p><p>不知我梦蝶仙</p><p>蝶仙梦焉？</p></blockquote><hr><blockquote><p>AI 解读</p><p>这首创作于 2024 年 12 月 6 日中午的《我》，宛如一部微缩的个人心灵成长史，用简洁而富有韵味的笔触勾勒出人生不同阶段的心境与追求。</p><p>开篇“幼时极目望天边，飞鸟点点”，将幼时的纯真好奇具象化。孩子瞪大双眼眺望远方，天边自由翱翔的飞鸟成为心中向往的象征，那是对未知世界最纯粹的渴望，代表着懵懂的心灵初次探向广阔天地，萌动着无尽想象，如同一张白纸即将被生活的色彩晕染。</p><p>“少年执笔画圆，壮志了无边”，步入少年，手中画笔代替了幼时凝望的目光，画圆寓意构建理想蓝图。此时的少年意气风发，胸怀壮志，以为凭借满腔热血就能圈定未来，在纸上规划的每一笔都是对人生巅峰的预设，脑海中是星辰大海，心中憧憬着叱咤风云，拥有改写世界的勇气，对即将开启的旅程充满毫无保留的信心。</p><p>然而“青年奋斗不值闲，几许惆怅在心间”，时光流转至青年，现实的车轮滚滚而来。青年一头扎进奋斗浪潮，忙碌成为生活常态，可理想与现实的落差逐渐显现。努力付出后发现目标并非轻易可及，碰壁、挫折接踵而至，那些曾经笃定的信念在现实打磨下出现裂缝，于是惆怅悄然滋生，在忙碌间隙涌上心头，开始对人生路径产生迷茫与困惑，意识到成长并非一路坦途。</p><p>“如今已到而立年，不知我梦蝶仙，蝶仙梦焉？”而立之年，站在人生新节点，往昔如梦般闪过。引用“庄周梦蝶”典故，巧妙融入人生困惑：是我在追逐理想梦境，还是这一切不过虚幻，反被理想世界所“梦”？此时历经岁月沉淀，对自我、对人生真谛有了更深探寻欲望，面对生活的复杂与不确定性，发出哲学叩问，既有对青春逝去的喟叹，又有对未来何去何从的深沉思索，在现实与精神追求间徘徊，试图在混沌中找到明晰方向。</p><p>整首诗层次分明，借由人生关键阶段串联，以意象和心境变化展现成长磨砺，诗意地抒发从幼稚走向成熟过程中内心的波澜起伏，是个体心灵对时光、理想、现实交织的真诚回响。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 剧院广场 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 现代诗 </tag>
            
            <tag> 成长 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Zabbix 7 添加企业微信机器人告警</title>
      <link href="/p/66a8.html"/>
      <url>/p/66a8.html</url>
      
        <content type="html"><![CDATA[<p>记录 Zabbix 添加企业微信机器人所使用的脚本（不包含在 Zabbix 界面上进行的配置）。</p><span id="more"></span><h3 id="实验环境"><a href="#实验环境" class="headerlink" title="实验环境"></a>实验环境</h3><p>实验环境为 docker 安装的 zabbix，镜像：<code>zabbix/zabbix-server-mysql:alpine-7.0-latest</code>。</p><h3 id="告警脚本"><a href="#告警脚本" class="headerlink" title="告警脚本"></a>告警脚本</h3><h4 id="报错"><a href="#报错" class="headerlink" title="报错"></a>报错</h4><p>在 Zabbix 界面上做好各种设置（可参考<a href="https://zhuanlan.zhihu.com/p/521551246">此文章</a>），测试<code>python</code>脚本可用性的时候，会发现有报错。原因是此镜像基于 alpine linux 构建，不包含 <code>python</code>、<code>curl</code> 之类的基础软件包。</p><p>官方在<a href="https://github.com/zabbix/zabbix-docker/issues/1130">issue</a>回复中指出：</p><blockquote><p>That is the main goal for images. If you need something additional for your infrastructure, customized things - you build your own image using official one images using some CI &#x2F; automation. For example you can use hub.docker.com 和 automate such process.</p><p>这是图像的主要目标。如果您的基础设施需要一些额外的东西，定制的东西 - 您可以使用官方的镜像并使用一些 CI &#x2F; 自动化来构建您自己的镜像。例如，您可以使用 hub.docker.com 并自动化此过程。</p><p>Regarding packages installation, usually container is running under non-root user, so you can not install anything into container.</p><p>关于软件包安装，通常容器在非 root 用户下运行，因此您无法将任何东西安装到容器中。</p></blockquote><p>所以只能使用基础的 <code>shell</code> 脚本，好在 <code>alpine</code> 里集成了 <code>busybox</code>，我们可以使用 <code>wget</code>。</p><h4 id="wget-救急"><a href="#wget-救急" class="headerlink" title="wget 救急"></a>wget 救急</h4><p>zabbix-server 容器中的 wget 输出信息：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">500a7c147742:/var/lib/zabbix$ wget</span><br><span class="line">BusyBox v1.36.1 (2024-06-10 07:11:47 UTC) multi-call binary.</span><br><span class="line"></span><br><span class="line">Usage: wget [-cqS] [--spider] [-O FILE] [-o LOGFILE] [--header STR]</span><br><span class="line">        [--post-data STR | --post-file FILE] [-Y on/off]</span><br><span class="line">        [-P DIR] [-U AGENT] [-T SEC] URL...</span><br><span class="line"></span><br><span class="line">Retrieve files via HTTP or FTP</span><br><span class="line"></span><br><span class="line">        --spider        Only check URL existence: $? is 0 if exists</span><br><span class="line">        --header STR    Add STR (of form &#x27;header: value&#x27;) to headers</span><br><span class="line">        --post-data STR Send STR using POST method</span><br><span class="line">        --post-file FILE        Send FILE using POST method</span><br><span class="line">        -c              Continue retrieval of aborted transfer</span><br><span class="line">        -q              Quiet</span><br><span class="line">        -P DIR          Save to DIR (default .)</span><br><span class="line">        -S              Show server response</span><br><span class="line">        -T SEC          Network read timeout is SEC seconds</span><br><span class="line">        -O FILE         Save to FILE (&#x27;-&#x27; for stdout)</span><br><span class="line">        -o LOGFILE      Log messages to FILE</span><br><span class="line">        -U STR          Use STR for User-Agent header</span><br><span class="line">        -Y on/off       Use proxy</span><br></pre></td></tr></table></figure><h4 id="调整后的脚本"><a href="#调整后的脚本" class="headerlink" title="调整后的脚本"></a>调整后的脚本</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">WEBHOOK_URL=&quot;机器人webhook地址&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if [ $# -eq 0 ]; then</span><br><span class="line">    echo &quot;Please provide a message as an argument.&quot;</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">MESSAGE=&quot;$1&quot;</span><br><span class="line">echo $1</span><br><span class="line">wget --post-data=&quot;&#123;\&quot;msgtype\&quot;:\&quot;text\&quot;,\&quot;text\&quot;:&#123;\&quot;content\&quot;:\&quot;$MESSAGE\&quot;&#125;&#125;&quot; -O /dev/null $WEBHOOK_URL</span><br></pre></td></tr></table></figure><p>测试调整后的脚本后，就成功推送信息了。</p><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul><li><a href="https://zhuanlan.zhihu.com/p/521551246">Zabbix5.0 设置企业微信群机器人推送告警信息 - 知乎</a></li></ul><p>-EOF</p><p>查看最新版，请访问本文链接：<a href="https://blog.onehat.cn/p/66a8.html">https://blog.onehat.cn/p/66a8.html</a></p><p>原创作品，转载请保留出处。</p>]]></content>
      
      
      <categories>
          
          <category> 工作坊 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技术 </tag>
            
            <tag> Docker </tag>
            
            <tag> Zabbix </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网页离线存储之道</title>
      <link href="/p/517b.html"/>
      <url>/p/517b.html</url>
      
        <content type="html"><![CDATA[<p>本文记录桌面端环境下对网页离线存储、备份、浏览的方法。</p><span id="more"></span><div class="story post-story"><h2 id="先决条件"><a href="#先决条件" class="headerlink" title="先决条件"></a>先决条件</h2><p>具备以下实验环境：</p><ul><li>桌面端操作系统、Chrome 浏览器</li><li>Git 仓库</li></ul><p>演示链接：<code>https://learn.microsoft.com/zh-cn/windows-server/administration/windows-commands/route_ws2008</code></p></div><div class="story post-story"><h2 id="方案一：MHTML-Git-仓库"><a href="#方案一：MHTML-Git-仓库" class="headerlink" title="方案一：MHTML+Git 仓库"></a>方案一：MHTML+Git 仓库</h2><blockquote><p>适用于普通用户的离线网页存储、浏览行为。</p></blockquote><h3 id="保存"><a href="#保存" class="headerlink" title="保存"></a>保存</h3><p>快捷键 <code>Ctrl+S</code>保存网页，选择 <code>单个文件</code>，即可保存成 <code>.mhtml</code>格式。在此过程中可以自定义需要的文件名，便于后期检索。</p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-11-02_11-31-32.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-11-02_11-31-32.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2024-11-02_11-31-32"></p><p>保存完成后可以看到文件，大小为 <code>795.6 KiB</code>。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="built_in">ls</span></span></span><br><span class="line">╭───┬───────────────────────────────┬──────┬───────────┬───────────────╮</span><br><span class="line">│ # │             name              │ type │   size    │   modified    │</span><br><span class="line">├───┼───────────────────────────────┼──────┼───────────┼───────────────┤</span><br><span class="line">│ 0 │ route _ Microsoft Learn.mhtml │ file │ 795.6 KiB │ 3 minutes ago │</span><br><span class="line">╰───┴───────────────────────────────┴──────┴───────────┴───────────────╯</span><br></pre></td></tr></table></figure><h3 id="备份"><a href="#备份" class="headerlink" title="备份"></a>备份</h3><p>设置好同步目录，将 <code>.mhtml</code>上传到 Git 仓库、云盘即可。</p><h3 id="浏览"><a href="#浏览" class="headerlink" title="浏览"></a>浏览</h3><p>使用浏览器程序可以直接打开 <code>.mhtml</code>文件，进行浏览。如需搜索可使用 <code>Everything</code>工具搜索文件名，需要注意的是，我们无法直接检索到网页文件的文本内容。</p></div><div class="story post-story"><h2 id="方案二：SingleFile-Git-仓库-HamsterBase"><a href="#方案二：SingleFile-Git-仓库-HamsterBase" class="headerlink" title="方案二：SingleFile+Git 仓库+HamsterBase"></a>方案二：SingleFile+Git 仓库+HamsterBase</h2><blockquote><p>需要部署自托管 docker 容器 <code>HamsterBase</code>。<code>HamsterBase</code>引入了标签系统和全文检索功能，方便了使用。</p><p>在此过程中，我也相当于把离线网页文件保存了两份，一份在 <code>Github</code>，一份在 <code>HamsterBase</code>里。</p></blockquote><p><code>SingleFile</code>官方仓库：<code>https://github.com/gildas-lormeau/SingleFile</code></p><p><code>HamsterBase</code>官方仓库：<code>https://github.com/hamsterbase/hamsterbase</code></p><h3 id="保存-1"><a href="#保存-1" class="headerlink" title="保存"></a>保存</h3><p>使用 Chrome 扩展程序 SingleFile 进行保存离线网页。</p><p><a href="https://chromewebstore.google.com/detail/singlefile/mpiodijhokgodhhofbcjdecpffjipkle">点此访问 Chrome 应用商店</a>安装扩展，安装完成后点击 SingleFile 图标即可保存网页。</p><p>SingleFile 生成的为单个 <code>.HTML</code>文件，默认情况下，会将网页文件保存到文件系统（也就是弹出对话框以选择保存位置）。</p><p>右键 SingleFile 图标，选择 <code>选项</code>，可以设置其保存位置，此处我使用 <code>保存到Github</code>，要用到个人访问令牌（<code>Personal access tokens</code>）。</p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-11-02_11-58-38.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-11-02_11-58-38.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2024-11-02_11-58-38"></p><p>另外也可以使用 <code>保存到WebDAV服务器</code>，大家按需选择。</p><p>相比于 <code>.mhtml</code>文件，SingleFile 保存的 <code>.html</code>文件大了数倍。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="built_in">ls</span></span></span><br><span class="line">╭───┬───────────────────────────────┬──────┬───────────┬─────────────╮</span><br><span class="line">│ # │             name              │ type │   size    │  modified   │</span><br><span class="line">├───┼───────────────────────────────┼──────┼───────────┼─────────────┤</span><br><span class="line">│ 0 │ route _ Microsoft Learn.html  │ file │   6.9 MiB │ now         │</span><br><span class="line">│ 1 │ route _ Microsoft Learn.mhtml │ file │ 795.6 KiB │ an hour ago │</span><br><span class="line">╰───┴───────────────────────────────┴──────┴───────────┴─────────────╯</span><br></pre></td></tr></table></figure><h3 id="备份-1"><a href="#备份-1" class="headerlink" title="备份"></a>备份</h3><p>保存到 Github 就已经拥有了备份。</p><h3 id="浏览-1"><a href="#浏览-1" class="headerlink" title="浏览"></a>浏览</h3><p>使用 docker 部署 HamsterBase，<a href="https://hamsterbase.com/zh/docs/install/install-with-docker.html">点此参考官方文档</a>。</p><p>部署完成后，打开其 <code>WebUI</code>，可以看到上传界面，这个界面适用于手动操作，了解即可。</p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-11-02_12-08-34.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-11-02_12-08-34.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2024-11-02_12-08-34"></p><p>我们已经将网页文件保存到了 <code>Github</code>，如何将其导入 HamsterBase 呢？</p><p>查询<a href="https://hamsterbase.com/zh/docs/importing-website.html">官方文档</a>得知，只要把网页文件放在 <code>数据库的地址/workspace/inbox</code> ，HamsterBase 会自动导入。</p><p>这里使用一个定时作业脚本完成，您可以将其运行在喜欢的运维平台上。我的同步周期为每 12 小时一次。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">切换到本地Git仓库目录</span></span><br><span class="line">cd /home/dsf/FileHub</span><br><span class="line">git_repo=我的Github仓库地址</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">获取本地当前分支名称</span></span><br><span class="line">local_branch=$(git rev-parse --abbrev-ref HEAD)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">获取本地当前分支的最新提交哈希值</span></span><br><span class="line">local_commit=$(git rev-parse $local_branch)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">获取远程分支对应的本地跟踪分支的最新提交哈希值</span></span><br><span class="line">remote_commit=$(git ls-remote $git_repo refs/heads/$local_branch | cut -f1)</span><br><span class="line">echo -e &quot;本地$local_commit。\n远端$remote_commit。&quot;</span><br><span class="line">if [ &quot;$local_commit&quot; = &quot;$remote_commit&quot; ];</span><br><span class="line">then</span><br><span class="line">echo &quot;本地仓库的$local_branch分支与远端一致，业务结束。&quot;</span><br><span class="line">else</span><br><span class="line">echo &quot;本地仓库的$local_branch分支与远端不一致，触发Git更新。&quot;</span><br><span class="line">    #拉取Gitea仓库数据</span><br><span class="line">git pull origin singlefile</span><br><span class="line">    #延迟15秒</span><br><span class="line">    sleep 15</span><br><span class="line">    echo &quot;Git更新结束。&quot;</span><br><span class="line">    #导入至HamsterBase的inbox（全量拷贝）</span><br><span class="line">cp -rf ./*.html /mnt/disk1/appdata/hamsterbase/data/workspace/inbox/</span><br><span class="line">    echo &quot;导入HamsterBase的inbox完成，业务结束。&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><p>同步完成后，在 HamsterBase 里即可使用标签、全文检索、访问原 URL 功能。</p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-11-02_12-25-55.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-11-02_12-25-55.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2024-11-02_12-25-55"></p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-11-02_12-25-30.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-11-02_12-25-30.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2024-11-02_12-25-30"></p><p>需要注意的是，每次都是使用全量拷贝以供 HamsterBase 自导导入，随着网页数量的增多，其导入速度肯定是会变慢的。这样做的主要原因是 HamsterBase 不支持批量导出原数据，所以我宁愿把数据保存两份：一份是在 Github 仓库里，以 <code>.html</code>文件的形式存在，作为异地备份；一份在 HamsterBase 中，方便使用。</p></div><div class="story post-story"><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>根据自身情况按需选择。</p><table><thead><tr><th></th><th>网页格式</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>方案一</td><td>mhtml</td><td>简单、保存文件小、更好的适用范围（浏览器）</td><td>想使用标签，只能在文件名上做文章；无法检索离线网页内容</td></tr><tr><td>方案二</td><td>html</td><td>标签、全文检索</td><td>更高的部署难度；保存的网页文件过大</td></tr></tbody></table><p>-EOF</p><p>查看最新版，请访问本文链接：<a href="https://blog.onehat.cn/p/517b.html">https://blog.onehat.cn/p/517b.html</a></p><p>原创作品，转载请保留出处。</p></div>]]></content>
      
      
      <categories>
          
          <category> 工作坊 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> NAS </tag>
            
            <tag> MHTML </tag>
            
            <tag> Chrome </tag>
            
            <tag> Github </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>双网卡设置内外网静态路由</title>
      <link href="/p/7b7a.html"/>
      <url>/p/7b7a.html</url>
      
        <content type="html"><![CDATA[<p>记录在双网卡设置静态路由，实现一台机内外网同时连接。</p><span id="more"></span><div class="story post-story"><h2 id="先决条件"><a href="#先决条件" class="headerlink" title="先决条件"></a>先决条件</h2><p>一台有两块网卡的电脑，且都具备网络连接。</p><h3 id="Windows-环境"><a href="#Windows-环境" class="headerlink" title="Windows 环境"></a>Windows 环境</h3><p>实验环境为 <code>Windows11</code>，网卡如下：</p><table><thead><tr><th>网卡</th><th>DHCP</th><th>IP</th><th>子网掩码</th><th>网关</th><th>备注</th></tr></thead><tbody><tr><td><code>Realtek Gaming 2.5GbE Family Controller</code></td><td>否</td><td>192.168.31.254</td><td>255.255.255.0</td><td>192.168.31.221</td><td>板载网卡，网线连接内网</td></tr><tr><td><code>Realtek RTL8811AU Wireless LAN 802.11ac USB 2.0 Network Adapter</code></td><td>是</td><td>192.168.43.252</td><td>255.255.255.0</td><td>192.168.43.1</td><td>USB 网卡，WIFI 连接外网</td></tr></tbody></table><h3 id="macOS-环境"><a href="#macOS-环境" class="headerlink" title="macOS 环境"></a>macOS 环境</h3><p>实验环境为 <code>macOS 13.6.9</code>，网卡如下：</p><table><thead><tr><th>网卡</th><th>DHCP</th><th>IP</th><th>子网掩码</th><th>网关</th><th>备注</th></tr></thead><tbody><tr><td><code>以太网</code></td><td>是</td><td>192.168.31.142</td><td>255.255.255.0</td><td>192.168.31.1</td><td>板载网卡，网线连接内网</td></tr><tr><td><code>Wi-Fi</code></td><td>是</td><td>192.168.43.127</td><td>255.255.255.0</td><td>192.168.43.1</td><td>无线网卡，WIFI 连接外网</td></tr></tbody></table><p>需要注意的是，两个网卡是否设置静态 IP 都不影响路由，只需确定好对应网段的网关和子网掩码。</p><p>现在确定目标：只要 <code>192.168.31.x</code>的都属于内网，走网线；除了内网其他都属于外网，走 <code>WIFI</code>。</p></div><div class="story post-story"><h2 id="Windows-设置静态路由"><a href="#Windows-设置静态路由" class="headerlink" title="Windows 设置静态路由"></a>Windows 设置静态路由</h2><p>windows 下使用 route 命令进行路由管理，需要以<strong>管理员权限</strong>运行 <code>powershell</code>。</p><p>先 <code>route print</code>查看路由表：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">PowerShell <span class="number">7.4</span>.<span class="number">5</span></span><br><span class="line"><span class="built_in">PS</span> C:\Users\dsf&gt; route print</span><br><span class="line">===========================================================================</span><br><span class="line">接口列表</span><br><span class="line">  <span class="number">7</span>...........................Tailscale Tunnel</span><br><span class="line">  <span class="number">9</span>...<span class="number">1</span>c <span class="number">86</span> <span class="number">0</span>b <span class="number">21</span> <span class="number">28</span> b1 ......Realtek Gaming <span class="number">2.5</span>GbE Family Controller</span><br><span class="line"> <span class="number">31</span>...<span class="number">22</span> <span class="number">0</span>d b0 <span class="number">30</span> <span class="number">0</span>a <span class="number">6</span>e ......Microsoft Wi<span class="literal">-Fi</span> Direct Virtual Adapter</span><br><span class="line"> <span class="number">36</span>...<span class="number">20</span> <span class="number">0</span>d b0 <span class="number">30</span> <span class="number">0</span>a <span class="number">6</span>e ......Microsoft Wi<span class="literal">-Fi</span> Direct Virtual Adapter <span class="comment">#2</span></span><br><span class="line"> <span class="number">25</span>...<span class="number">20</span> <span class="number">0</span>d b0 <span class="number">30</span> <span class="number">0</span>a <span class="number">6</span>e ......Realtek RTL8811AU Wireless LAN <span class="number">802.11</span><span class="built_in">ac</span> USB <span class="number">2.0</span> Network Adapter</span><br><span class="line">  <span class="number">1</span>...........................Software Loopback Interface <span class="number">1</span></span><br><span class="line">===========================================================================</span><br><span class="line"></span><br><span class="line">IPv4 路由表</span><br><span class="line">===========================================================================</span><br><span class="line">活动路由:</span><br><span class="line">网络目标        网络掩码          网关       接口   跃点数</span><br><span class="line">          <span class="number">0.0</span>.<span class="number">0.0</span>          <span class="number">0.0</span>.<span class="number">0.0</span>     <span class="number">192.168</span>.<span class="number">43.1</span>   <span class="number">192.168</span>.<span class="number">43.252</span>     <span class="number">55</span></span><br><span class="line">          <span class="number">0.0</span>.<span class="number">0.0</span>          <span class="number">0.0</span>.<span class="number">0.0</span>   <span class="number">192.168</span>.<span class="number">31.221</span>   <span class="number">192.168</span>.<span class="number">31.254</span>     <span class="number">21</span></span><br><span class="line">        <span class="number">127.0</span>.<span class="number">0.0</span>        <span class="number">255.0</span>.<span class="number">0.0</span>            在链路上         <span class="number">127.0</span>.<span class="number">0.1</span>    <span class="number">331</span></span><br><span class="line">        <span class="number">127.0</span>.<span class="number">0.1</span>  <span class="number">255.255</span>.<span class="number">255.255</span>            在链路上         <span class="number">127.0</span>.<span class="number">0.1</span>    <span class="number">331</span></span><br><span class="line">  <span class="number">127.255</span>.<span class="number">255.255</span>  <span class="number">255.255</span>.<span class="number">255.255</span>            在链路上         <span class="number">127.0</span>.<span class="number">0.1</span>    <span class="number">331</span></span><br><span class="line">      <span class="number">169.254</span>.<span class="number">0.0</span>      <span class="number">255.255</span>.<span class="number">0.0</span>            在链路上    <span class="number">169.254</span>.<span class="number">83.107</span>    <span class="number">261</span></span><br><span class="line">   <span class="number">169.254</span>.<span class="number">83.107</span>  <span class="number">255.255</span>.<span class="number">255.255</span>            在链路上    <span class="number">169.254</span>.<span class="number">83.107</span>    <span class="number">261</span></span><br><span class="line">  <span class="number">169.254</span>.<span class="number">255.255</span>  <span class="number">255.255</span>.<span class="number">255.255</span>            在链路上    <span class="number">169.254</span>.<span class="number">83.107</span>    <span class="number">261</span></span><br><span class="line">     <span class="number">192.168</span>.<span class="number">31.0</span>    <span class="number">255.255</span>.<span class="number">255.0</span>            在链路上    <span class="number">192.168</span>.<span class="number">31.254</span>    <span class="number">276</span></span><br><span class="line">   <span class="number">192.168</span>.<span class="number">31.254</span>  <span class="number">255.255</span>.<span class="number">255.255</span>            在链路上    <span class="number">192.168</span>.<span class="number">31.254</span>    <span class="number">276</span></span><br><span class="line">   <span class="number">192.168</span>.<span class="number">31.255</span>  <span class="number">255.255</span>.<span class="number">255.255</span>            在链路上    <span class="number">192.168</span>.<span class="number">31.254</span>    <span class="number">276</span></span><br><span class="line">     <span class="number">192.168</span>.<span class="number">43.0</span>    <span class="number">255.255</span>.<span class="number">255.0</span>            在链路上    <span class="number">192.168</span>.<span class="number">43.252</span>    <span class="number">311</span></span><br><span class="line">   <span class="number">192.168</span>.<span class="number">43.252</span>  <span class="number">255.255</span>.<span class="number">255.255</span>            在链路上    <span class="number">192.168</span>.<span class="number">43.252</span>    <span class="number">311</span></span><br><span class="line">   <span class="number">192.168</span>.<span class="number">43.255</span>  <span class="number">255.255</span>.<span class="number">255.255</span>            在链路上    <span class="number">192.168</span>.<span class="number">43.252</span>    <span class="number">311</span></span><br><span class="line">        <span class="number">224.0</span>.<span class="number">0.0</span>        <span class="number">240.0</span>.<span class="number">0.0</span>            在链路上         <span class="number">127.0</span>.<span class="number">0.1</span>    <span class="number">331</span></span><br><span class="line">        <span class="number">224.0</span>.<span class="number">0.0</span>        <span class="number">240.0</span>.<span class="number">0.0</span>            在链路上    <span class="number">192.168</span>.<span class="number">43.252</span>    <span class="number">311</span></span><br><span class="line">        <span class="number">224.0</span>.<span class="number">0.0</span>        <span class="number">240.0</span>.<span class="number">0.0</span>            在链路上    <span class="number">192.168</span>.<span class="number">31.254</span>    <span class="number">276</span></span><br><span class="line">  <span class="number">255.255</span>.<span class="number">255.255</span>  <span class="number">255.255</span>.<span class="number">255.255</span>            在链路上         <span class="number">127.0</span>.<span class="number">0.1</span>    <span class="number">331</span></span><br><span class="line">  <span class="number">255.255</span>.<span class="number">255.255</span>  <span class="number">255.255</span>.<span class="number">255.255</span>            在链路上    <span class="number">192.168</span>.<span class="number">43.252</span>    <span class="number">311</span></span><br><span class="line">  <span class="number">255.255</span>.<span class="number">255.255</span>  <span class="number">255.255</span>.<span class="number">255.255</span>            在链路上    <span class="number">192.168</span>.<span class="number">31.254</span>    <span class="number">276</span></span><br><span class="line">===========================================================================</span><br><span class="line">永久路由:</span><br><span class="line">  网络地址          网络掩码  网关地址  跃点数</span><br><span class="line">          <span class="number">0.0</span>.<span class="number">0.0</span>          <span class="number">0.0</span>.<span class="number">0.0</span>   <span class="number">192.168</span>.<span class="number">31.221</span>       <span class="number">1</span></span><br><span class="line">===========================================================================</span><br><span class="line"></span><br><span class="line">IPv6 路由表</span><br><span class="line">===========================================================================</span><br><span class="line">活动路由:</span><br><span class="line"> 接口跃点数网络目标                网关</span><br><span class="line">  <span class="number">1</span>    <span class="number">331</span> ::<span class="number">1</span>/<span class="number">128</span>                  在链路上</span><br><span class="line"> <span class="number">25</span>    <span class="number">311</span> fe80::/<span class="number">64</span>                在链路上</span><br><span class="line">  <span class="number">9</span>    <span class="number">276</span> fe80::/<span class="number">64</span>                在链路上</span><br><span class="line"> <span class="number">25</span>    <span class="number">311</span> fe80::f1e:<span class="number">1694</span>:f3b4:<span class="number">4780</span>/<span class="number">128</span></span><br><span class="line">                                    在链路上</span><br><span class="line">  <span class="number">9</span>    <span class="number">276</span> fe80::<span class="number">5056</span>:bce5:<span class="number">95</span>a8:c141/<span class="number">128</span></span><br><span class="line">                                    在链路上</span><br><span class="line">  <span class="number">1</span>    <span class="number">331</span> ff00::/<span class="number">8</span>                 在链路上</span><br><span class="line"> <span class="number">25</span>    <span class="number">311</span> ff00::/<span class="number">8</span>                 在链路上</span><br><span class="line">  <span class="number">9</span>    <span class="number">276</span> ff00::/<span class="number">8</span>                 在链路上</span><br><span class="line">===========================================================================</span><br><span class="line">永久路由:</span><br><span class="line">  无</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>可以看到有两条通用的路由地址，网络目标均为 <code>0.0.0.0</code>，将其全部删除。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Users\dsf&gt; route delete <span class="number">0.0</span>.<span class="number">0.0</span></span><br><span class="line"> 操作完成!</span><br></pre></td></tr></table></figure><p>找到两块网卡对应的接口分别为内网 <code>9</code>、外网 <code>25</code>，这两个编号会在机器网卡有增减时产生变化。</p><p>添加内网路由</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Users\dsf&gt; route add <span class="number">192.168</span>.<span class="number">31.0</span> mask <span class="number">255.255</span>.<span class="number">255.0</span> <span class="number">192.168</span>.<span class="number">31.221</span> <span class="keyword">if</span> <span class="number">9</span></span><br><span class="line"> 操作完成!</span><br></pre></td></tr></table></figure><p>添加外网路由</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Users\dsf&gt; route add <span class="number">0.0</span>.<span class="number">0.0</span> mask <span class="number">0.0</span>.<span class="number">0.0</span> <span class="number">192.168</span>.<span class="number">43.1</span> <span class="keyword">if</span> <span class="number">25</span></span><br><span class="line"> 操作完成!</span><br></pre></td></tr></table></figure><p>设置完成后路由列表如下：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Users\dsf&gt; route print</span><br><span class="line">===========================================================================</span><br><span class="line">接口列表</span><br><span class="line">  <span class="number">7</span>...........................Tailscale Tunnel</span><br><span class="line">  <span class="number">9</span>...<span class="number">1</span>c <span class="number">86</span> <span class="number">0</span>b <span class="number">21</span> <span class="number">28</span> b1 ......Realtek Gaming <span class="number">2.5</span>GbE Family Controller</span><br><span class="line"> <span class="number">31</span>...<span class="number">22</span> <span class="number">0</span>d b0 <span class="number">30</span> <span class="number">0</span>a <span class="number">6</span>e ......Microsoft Wi<span class="literal">-Fi</span> Direct Virtual Adapter</span><br><span class="line"> <span class="number">36</span>...<span class="number">20</span> <span class="number">0</span>d b0 <span class="number">30</span> <span class="number">0</span>a <span class="number">6</span>e ......Microsoft Wi<span class="literal">-Fi</span> Direct Virtual Adapter <span class="comment">#2</span></span><br><span class="line"> <span class="number">25</span>...<span class="number">20</span> <span class="number">0</span>d b0 <span class="number">30</span> <span class="number">0</span>a <span class="number">6</span>e ......Realtek RTL8811AU Wireless LAN <span class="number">802.11</span><span class="built_in">ac</span> USB <span class="number">2.0</span> Network Adapter</span><br><span class="line">  <span class="number">1</span>...........................Software Loopback Interface <span class="number">1</span></span><br><span class="line">===========================================================================</span><br><span class="line"></span><br><span class="line">IPv4 路由表</span><br><span class="line">===========================================================================</span><br><span class="line">活动路由:</span><br><span class="line">网络目标        网络掩码          网关       接口   跃点数</span><br><span class="line">          <span class="number">0.0</span>.<span class="number">0.0</span>          <span class="number">0.0</span>.<span class="number">0.0</span>     <span class="number">192.168</span>.<span class="number">43.1</span>   <span class="number">192.168</span>.<span class="number">43.252</span>     <span class="number">56</span></span><br><span class="line">        <span class="number">127.0</span>.<span class="number">0.0</span>        <span class="number">255.0</span>.<span class="number">0.0</span>            在链路上         <span class="number">127.0</span>.<span class="number">0.1</span>    <span class="number">331</span></span><br><span class="line">        <span class="number">127.0</span>.<span class="number">0.1</span>  <span class="number">255.255</span>.<span class="number">255.255</span>            在链路上         <span class="number">127.0</span>.<span class="number">0.1</span>    <span class="number">331</span></span><br><span class="line">  <span class="number">127.255</span>.<span class="number">255.255</span>  <span class="number">255.255</span>.<span class="number">255.255</span>            在链路上         <span class="number">127.0</span>.<span class="number">0.1</span>    <span class="number">331</span></span><br><span class="line">      <span class="number">169.254</span>.<span class="number">0.0</span>      <span class="number">255.255</span>.<span class="number">0.0</span>            在链路上    <span class="number">169.254</span>.<span class="number">83.107</span>    <span class="number">261</span></span><br><span class="line">   <span class="number">169.254</span>.<span class="number">83.107</span>  <span class="number">255.255</span>.<span class="number">255.255</span>            在链路上    <span class="number">169.254</span>.<span class="number">83.107</span>    <span class="number">261</span></span><br><span class="line">  <span class="number">169.254</span>.<span class="number">255.255</span>  <span class="number">255.255</span>.<span class="number">255.255</span>            在链路上    <span class="number">169.254</span>.<span class="number">83.107</span>    <span class="number">261</span></span><br><span class="line">     <span class="number">192.168</span>.<span class="number">31.0</span>    <span class="number">255.255</span>.<span class="number">255.0</span>            在链路上    <span class="number">192.168</span>.<span class="number">31.254</span>    <span class="number">276</span></span><br><span class="line">     <span class="number">192.168</span>.<span class="number">31.0</span>    <span class="number">255.255</span>.<span class="number">255.0</span>   <span class="number">192.168</span>.<span class="number">31.221</span>   <span class="number">192.168</span>.<span class="number">31.254</span>     <span class="number">21</span></span><br><span class="line">   <span class="number">192.168</span>.<span class="number">31.254</span>  <span class="number">255.255</span>.<span class="number">255.255</span>            在链路上    <span class="number">192.168</span>.<span class="number">31.254</span>    <span class="number">276</span></span><br><span class="line">   <span class="number">192.168</span>.<span class="number">31.255</span>  <span class="number">255.255</span>.<span class="number">255.255</span>            在链路上    <span class="number">192.168</span>.<span class="number">31.254</span>    <span class="number">276</span></span><br><span class="line">     <span class="number">192.168</span>.<span class="number">43.0</span>    <span class="number">255.255</span>.<span class="number">255.0</span>            在链路上    <span class="number">192.168</span>.<span class="number">43.252</span>    <span class="number">311</span></span><br><span class="line">   <span class="number">192.168</span>.<span class="number">43.252</span>  <span class="number">255.255</span>.<span class="number">255.255</span>            在链路上    <span class="number">192.168</span>.<span class="number">43.252</span>    <span class="number">311</span></span><br><span class="line">   <span class="number">192.168</span>.<span class="number">43.255</span>  <span class="number">255.255</span>.<span class="number">255.255</span>            在链路上    <span class="number">192.168</span>.<span class="number">43.252</span>    <span class="number">311</span></span><br><span class="line">        <span class="number">224.0</span>.<span class="number">0.0</span>        <span class="number">240.0</span>.<span class="number">0.0</span>            在链路上         <span class="number">127.0</span>.<span class="number">0.1</span>    <span class="number">331</span></span><br><span class="line">        <span class="number">224.0</span>.<span class="number">0.0</span>        <span class="number">240.0</span>.<span class="number">0.0</span>            在链路上    <span class="number">192.168</span>.<span class="number">43.252</span>    <span class="number">311</span></span><br><span class="line">        <span class="number">224.0</span>.<span class="number">0.0</span>        <span class="number">240.0</span>.<span class="number">0.0</span>            在链路上    <span class="number">192.168</span>.<span class="number">31.254</span>    <span class="number">276</span></span><br><span class="line">  <span class="number">255.255</span>.<span class="number">255.255</span>  <span class="number">255.255</span>.<span class="number">255.255</span>            在链路上         <span class="number">127.0</span>.<span class="number">0.1</span>    <span class="number">331</span></span><br><span class="line">  <span class="number">255.255</span>.<span class="number">255.255</span>  <span class="number">255.255</span>.<span class="number">255.255</span>            在链路上    <span class="number">192.168</span>.<span class="number">43.252</span>    <span class="number">311</span></span><br><span class="line">  <span class="number">255.255</span>.<span class="number">255.255</span>  <span class="number">255.255</span>.<span class="number">255.255</span>            在链路上    <span class="number">192.168</span>.<span class="number">31.254</span>    <span class="number">276</span></span><br><span class="line">===========================================================================</span><br><span class="line">永久路由:</span><br><span class="line">  无</span><br><span class="line"></span><br><span class="line">IPv6 路由表</span><br><span class="line">===========================================================================</span><br><span class="line">活动路由:</span><br><span class="line"> 接口跃点数网络目标                网关</span><br><span class="line">  <span class="number">1</span>    <span class="number">331</span> ::<span class="number">1</span>/<span class="number">128</span>                  在链路上</span><br><span class="line"> <span class="number">25</span>    <span class="number">311</span> fe80::/<span class="number">64</span>                在链路上</span><br><span class="line">  <span class="number">9</span>    <span class="number">276</span> fe80::/<span class="number">64</span>                在链路上</span><br><span class="line"> <span class="number">25</span>    <span class="number">311</span> fe80::f1e:<span class="number">1694</span>:f3b4:<span class="number">4780</span>/<span class="number">128</span></span><br><span class="line">                                    在链路上</span><br><span class="line">  <span class="number">9</span>    <span class="number">276</span> fe80::<span class="number">5056</span>:bce5:<span class="number">95</span>a8:c141/<span class="number">128</span></span><br><span class="line">                                    在链路上</span><br><span class="line">  <span class="number">1</span>    <span class="number">331</span> ff00::/<span class="number">8</span>                 在链路上</span><br><span class="line"> <span class="number">25</span>    <span class="number">311</span> ff00::/<span class="number">8</span>                 在链路上</span><br><span class="line">  <span class="number">9</span>    <span class="number">276</span> ff00::/<span class="number">8</span>                 在链路上</span><br><span class="line">===========================================================================</span><br><span class="line">永久路由:</span><br><span class="line">  无</span><br><span class="line"><span class="built_in">PS</span> C:\Users\dsf&gt;</span><br></pre></td></tr></table></figure><p>需要注意的是，这两条都不是永久路由，重启电脑后就会失效，需要重新设置，如需设置永久路由，在两条 <code>route add</code>命令后添加参数 <code>-p</code>即可。</p><p>如需删除手动设置的静态路由，使用 <code>route delete</code>命令：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">route delete <span class="number">192.168</span>.<span class="number">31.0</span></span><br></pre></td></tr></table></figure><p>如果对网络适配器进行变更（如禁用、启用网卡、在 Windows 里设置重新静态 IP），可能会自动生成路由记录，需要重新进行以上配置。</p></div><div class="story post-story"><h2 id="macOS-设置静态路由"><a href="#macOS-设置静态路由" class="headerlink" title="macOS 设置静态路由"></a>macOS 设置静态路由</h2><p>首先设置正确的网卡服务顺序，进入 系统偏好设置 - 网络 - 设定服务顺序，拖动来进行网络优先级设置。</p><p>使连接外网的网卡位于内网网卡之上，此时已经可以正常访问外网。</p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-10-13_13-26-54.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-10-13_13-26-54.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>添加内网路由</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo route -n add -net 192.168.31.0 -netmask 255.255.255.0 192.168.31.1</span><br></pre></td></tr></table></figure><p>添加外网路由</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo route -n add default 192.168.43.1</span><br></pre></td></tr></table></figure><p>如需删除，也是使用 <code>route delete</code>命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo route delete -net 192.168.31.0 -netmask 255.255.255.0 192.168.31.1</span><br></pre></td></tr></table></figure><p>至此，目标完成。</p></div><div class="story post-story"><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a href="https://learn.microsoft.com/zh-cn/windows-server/administration/windows-commands/route_ws2008">route _ Microsoft Learn</a></li><li><a href="https://www.cnblogs.com/ygunoil/p/18329648">mac 配置双网卡 mac 同时使用内网和外网 - ygunoil - 博客园</a></li></ul><p>-EOF</p><p>查看最新版，请访问本文链接：<a href="https://blog.onehat.cn/p/7b7a.html">https://blog.onehat.cn/p/7b7a.html</a></p><p>原创作品，转载请保留出处。</p></div>]]></content>
      
      
      <categories>
          
          <category> 工作坊 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技术 </tag>
            
            <tag> 网络 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>文明 6 知识点汇总</title>
      <link href="/p/cd85.html"/>
      <url>/p/cd85.html</url>
      
        <content type="html"><![CDATA[<p>《 <strong>文明 VI</strong> 》是由 Firaxis Games 开发的回合策略游戏，是 文明系列的最新作品，同时是庆祝该系列 25 周年的作品（以下简称“文明 6”）。<br>本文汇总游玩过程中具备参考意义的一些玩法机制、数据、设定，仅供参考，所使用游戏版本为 Steam 文明 6 典藏版。</p><span id="more"></span><blockquote><p>以下内容收集于网络，如有侵权请联系博主删除。</p></blockquote><div class="story post-story"><h2 id="区域加成"><a href="#区域加成" class="headerlink" title="区域加成"></a>区域加成</h2><p>来源：抖音@BlackCatM.E</p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/41a859f8e4ad9f4cab16621f77215faa661575163.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/41a859f8e4ad9f4cab16621f77215faa661575163.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="41a859f8e4ad9f4cab16621f77215faa661575163.jpg"></p></div><div class="story post-story"><h2 id="部落村庄（蘑菇收益）"><a href="#部落村庄（蘑菇收益）" class="headerlink" title="部落村庄（蘑菇收益）"></a>部落村庄（蘑菇收益）</h2><p>来源：B 站@<a href="https://space.bilibili.com/3493296531835063">小巴拉 Stu</a> BV1S8411Z7sq</p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/9f648b0f1dbbe0d2dff383f94a9180fc430097467.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/9f648b0f1dbbe0d2dff383f94a9180fc430097467.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="9f648b0f1dbbe0d2dff383f94a9180fc430097467.jpg"></p></div><div class="story post-story"><h2 id="时代分"><a href="#时代分" class="headerlink" title="时代分"></a>时代分</h2><p>来源：B 站@<a href="https://space.bilibili.com/3493296531835063">小巴拉 Stu</a> BV1Ts4y1F7kg</p><h3 id="时代分获取"><a href="#时代分获取" class="headerlink" title="时代分获取"></a>时代分获取</h3><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/41f3c62d5a68309028e105e309cb11293493296531835063.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/41f3c62d5a68309028e105e309cb11293493296531835063.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="41f3c62d5a68309028e105e309cb11293493296531835063.jpg"></p><h3 id="时代着力点"><a href="#时代着力点" class="headerlink" title="时代着力点"></a>时代着力点</h3><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/bae66c2bf1702fe2951554903b2123ce3493296531835063.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/bae66c2bf1702fe2951554903b2123ce3493296531835063.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="bae66c2bf1702fe2951554903b2123ce3493296531835063.jpg"></p><h3 id="黑暗政策卡"><a href="#黑暗政策卡" class="headerlink" title="黑暗政策卡"></a>黑暗政策卡</h3><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/546cae723e087d4f0efbb902b22e72e53493296531835063.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/546cae723e087d4f0efbb902b22e72e53493296531835063.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="546cae723e087d4f0efbb902b22e72e53493296531835063.jpg"></p></div><div class="story post-story"><h2 id="商路"><a href="#商路" class="headerlink" title="商路"></a>商路</h2><p>来源：B 站@<a href="https://space.bilibili.com/3493296531835063">小巴拉 Stu</a> BV1yu411H7Xc</p><h3 id="商路所需回合数"><a href="#商路所需回合数" class="headerlink" title="商路所需回合数"></a>商路所需回合数</h3><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/97ff57edcd3d509db760cced38f7407f3493296531835063.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/97ff57edcd3d509db760cced38f7407f3493296531835063.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="97ff57edcd3d509db760cced38f7407f3493296531835063.png"></p><h3 id="伟人、奇观对商路增益"><a href="#伟人、奇观对商路增益" class="headerlink" title="伟人、奇观对商路增益"></a>伟人、奇观对商路增益</h3><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/1d96f4b0ffb3713d1d05b78d99695b9a3493296531835063.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/1d96f4b0ffb3713d1d05b78d99695b9a3493296531835063.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="1d96f4b0ffb3713d1d05b78d99695b9a3493296531835063.png"></p><h3 id="各区域内外商收益"><a href="#各区域内外商收益" class="headerlink" title="各区域内外商收益"></a>各区域内外商收益</h3><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/adbcb56959b6828182187922891dae943493296531835063.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/adbcb56959b6828182187922891dae943493296531835063.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="adbcb56959b6828182187922891dae943493296531835063.png"></p><p>-EOF</p><p>查看最新版，请访问本文链接：<a href="https://blog.onehat.cn/p/cd85.html">https://blog.onehat.cn/p/cd85.html</a></p><p>原创作品，转载请保留出处。</p></div>]]></content>
      
      
      <categories>
          
          <category> 娱乐中心 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 游戏 </tag>
            
            <tag> 文明 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>文明 6 基准测试</title>
      <link href="/p/4104.html"/>
      <url>/p/4104.html</url>
      
        <content type="html"><![CDATA[<p>记录自己 PC 设备的文明 6 基准测试。</p><span id="more"></span><div class="story post-story"><h2 id="先决条件"><a href="#先决条件" class="headerlink" title="先决条件"></a>先决条件</h2><p>OS 均为 Win11，Steam 版本文明 6 典藏版本，游戏均安装在 NVMe 固态上，且登录账号完全一致。</p><p>额外开启软件：MSI AFTERBURNER。</p></div><div class="story post-story"><h2 id="测试结果"><a href="#测试结果" class="headerlink" title="测试结果"></a>测试结果</h2><table><thead><tr><th>设备</th><th>CPU</th><th>显卡</th><th>内存容量</th><th>固态</th><th>图像设置</th><th>图像性能</th><th>AI 性能</th></tr></thead><tbody><tr><td>NT-GG（台式机）</td><td>Intel 12400F</td><td>NVIDIA 2060S</td><td>32G（8G DDR4 3200 x4）</td><td>1TB PCIE4 固态</td><td>4k 高特效，无边框，垂直同步开。<img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-08-14_16-21-24.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-08-14_16-21-24.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></td><td>14.467+18.596<img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-08-14_16-25-09.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-08-14_16-25-09.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></td><td>7.37<img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-08-14_16-26-27.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-08-14_16-26-27.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></td></tr><tr><td>NT-MC（核显笔记本）</td><td>AMD 6800H</td><td>AMD Radeon 680M</td><td>64G（32G DDR5 4800 x2）</td><td>1TB PCIE3 固态</td><td>2k 中特效，无边框，垂直同步开。<img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-08-14_16-21-47.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-08-14_16-21-47.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></td><td>11.251+14.144<img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-08-14_16-27-22.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-08-14_16-27-22.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></td><td>7.52<img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-08-14_16-28-17.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-08-14_16-28-17.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></td></tr></tbody></table><p>-EOF</p><p>查看最新版，请访问本文链接：<a href="https://blog.onehat.cn/p/4104.html">https://blog.onehat.cn/p/4104.html</a></p><p>原创作品，转载请保留出处。</p></div>]]></content>
      
      
      <categories>
          
          <category> 娱乐中心 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 游戏 </tag>
            
            <tag> 文明 </tag>
            
            <tag> 游戏测试 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PVE8 下 iStoreOS_x86 根分区扩容</title>
      <link href="/p/bd39.html"/>
      <url>/p/bd39.html</url>
      
        <content type="html"><![CDATA[<p>在 pve 上面安装了 iStoreOS 虚拟机，默认根分区只有 2.5 G 空间，此处记录扩容根分区过程（增加 20G）。</p><span id="more"></span><h3 id="实验环境"><a href="#实验环境" class="headerlink" title="实验环境"></a>实验环境</h3><p>PVE 8.1.5</p><p>iStoreOS 22.03.6 2024052410</p><h3 id="PVE-操作硬盘扩容"><a href="#PVE-操作硬盘扩容" class="headerlink" title="PVE 操作硬盘扩容"></a>PVE 操作硬盘扩容</h3><p>直接在 PVE 的 WebUI 操作：</p><p>选中 VM，【硬件】-【硬盘】-【磁盘操作】-【调整大小】，输入 20，点击【调整磁盘大小】按钮以确认。</p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-06-05_10-32-40.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-06-05_10-32-40.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2024-06-05_10-32-40"></p><h3 id="iStoreOS-内部分区扩容"><a href="#iStoreOS-内部分区扩容" class="headerlink" title="iStoreOS 内部分区扩容"></a>iStoreOS 内部分区扩容</h3><p>在 pve 上操作虚拟机磁盘扩容后，ssh 连接到 istoreos，执行命令如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">执行parted</span></span><br><span class="line">root@iStoreOS:~# parted</span><br><span class="line">GNU Parted 3.4</span><br><span class="line">Using /dev/sda</span><br><span class="line">Welcome to GNU Parted! Type &#x27;help&#x27; to view a list of commands.</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">执行<span class="built_in">print</span>命令，查看当前分区情况</span></span><br><span class="line">(parted) print</span><br><span class="line">Model: QEMU QEMU HARDDISK (scsi)</span><br><span class="line">Disk /dev/sda: 24.0GB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: gpt</span><br><span class="line">Disk Flags:</span><br><span class="line"></span><br><span class="line">Number  Start   End     Size    File system  Name     Flags</span><br><span class="line">128     17.4kB  262kB   245kB                         bios_grub</span><br><span class="line"> 1      262kB   134MB   134MB   fat16                 legacy_boot</span><br><span class="line"> 2      134MB   403MB   268MB</span><br><span class="line"> 3      403MB   2550MB  2147MB  ext4</span><br><span class="line"> 4      2551MB  24.0GB  21.5GB               primary</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">这里对分区3进行扩容，完成后退出</span></span><br><span class="line">(parted) resizepart</span><br><span class="line">Partition number? 3</span><br><span class="line">Warning: Partition /dev/sda3 is being used. Are you sure you want to continue?</span><br><span class="line">Yes/No? yes</span><br><span class="line">End?  [2550MB]? 100%</span><br><span class="line">(parted)  q</span><br><span class="line">Information: You may need to update /etc/fstab.</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">执行<span class="built_in">df</span> -h可以看到分区大小未更新</span></span><br><span class="line">root@iStoreOS:~#  df -h</span><br><span class="line">Filesystem                Size      Used Available Use% Mounted on</span><br><span class="line">/dev/root               169.0M    169.0M         0 100% /rom</span><br><span class="line">tmpfs                   494.1M      5.3M    488.8M   1% /tmp</span><br><span class="line">/dev/sda3                 1.9G      1.8G     74.2M  96% /overlay</span><br><span class="line">overlayfs:/overlay        1.9G      1.8G     74.2M  96% /</span><br><span class="line">tmpfs                     4.0M    156.0K      3.8M   4% /mnt</span><br><span class="line">/dev/sda1               127.7M      5.7M    122.1M   4% /boot</span><br><span class="line">/dev/sda1               127.7M      5.7M    122.1M   4% /boot</span><br><span class="line">tmpfs                   512.0K         0    512.0K   0% /dev</span><br><span class="line">tmpfs                   512.0K         0    512.0K   0% /sys/module/md_mod/parameters/new_array</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">执行resize2fs对文件系统进行扩容</span></span><br><span class="line">root@iStoreOS:~# resize2fs -p /dev/sda3</span><br><span class="line">resize2fs 1.46.5 (30-Dec-2021)</span><br><span class="line">Filesystem at /dev/sda3 is mounted on /overlay; on-line resizing required</span><br><span class="line">old_desc_blocks = 1, new_desc_blocks = 3</span><br><span class="line">The filesystem on /dev/sda3 is now 5767168 (4k) blocks long.</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">执行<span class="built_in">df</span> -h可以看到分区大小已经更新</span></span><br><span class="line">root@iStoreOS:~#  df -h</span><br><span class="line">Filesystem                Size      Used Available Use% Mounted on</span><br><span class="line">/dev/root               169.0M    169.0M         0 100% /rom</span><br><span class="line">tmpfs                   494.1M      5.3M    488.8M   1% /tmp</span><br><span class="line">/dev/sda3                21.6G      1.8G     19.8G   8% /overlay</span><br><span class="line">overlayfs:/overlay       21.6G      1.8G     19.8G   8% /</span><br><span class="line">tmpfs                     4.0M    156.0K      3.8M   4% /mnt</span><br><span class="line">/dev/sda1               127.7M      5.7M    122.1M   4% /boot</span><br><span class="line">/dev/sda1               127.7M      5.7M    122.1M   4% /boot</span><br><span class="line">tmpfs                   512.0K         0    512.0K   0% /dev</span><br><span class="line">tmpfs                   512.0K         0    512.0K   0% /sys/module/md_mod/parameters/new_array</span><br><span class="line">root@iStoreOS:~#</span><br></pre></td></tr></table></figure><p>打开 Web 界面，发现分区大小已经变化，扩容成功。</p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-06-05_10-26-48.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-06-05_10-26-48.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2024-06-05_10-26-48"></p><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul><li><a href="https://zhuanlan.zhihu.com/p/609781369">iStoreOS x86 根分区扩容</a></li></ul><p>-EOF</p><p>查看最新版，请访问本文链接：<a href="https://blog.onehat.cn/p/bd39.html">https://blog.onehat.cn/p/bd39.html</a></p><p>原创作品，转载请保留出处。</p>]]></content>
      
      
      <categories>
          
          <category> 工作坊 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技术 </tag>
            
            <tag> PVE </tag>
            
            <tag> iStoreOS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NAS 快速跨磁盘拷贝数据</title>
      <link href="/p/fc3d.html"/>
      <url>/p/fc3d.html</url>
      
        <content type="html"><![CDATA[<p>记录使用 <code>ServerSide Copy</code>实现快速文件拷贝。</p><span id="more"></span><h3 id="前置条件"><a href="#前置条件" class="headerlink" title="前置条件"></a>前置条件</h3><p>NAS 设置 SMB 共享，不同盘挂载为主机电脑的不同文件夹。</p><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>远程操作 NAS 时，在不同硬盘间复制或移动文件，经常发现会占用本机网络。</p><p>假如我的网络目前为千兆，数据通过电脑中转的话下载上传各占满带宽一半，导致移动文件的速度只有 50MB&#x2F;s 左右非常慢。数据都是要经过我的电脑中转的，无法直接在 NAS 内部通过硬盘传送。</p><p>那么是否可以实现直接在 NAS 跨磁盘传输数据呢？</p><h3 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h3><p>SMB 协议有个功能特性为 <code>ServerSide Copy</code> (服务器端复制操作)，顾名思义，可以直接在 NAS 跨磁盘传输数据。</p><p><code>Samba 4.1.0</code> 是第一个通过 SMB2 <a href="http://msdn.microsoft.com/en-us/library/cc246475.aspx">FSCTL_SRV_COPYCHUNK 请求</a>支持服务器端复制操作的版本。</p><blockquote><p>对于 NFS，2016 年 11 月发布的 NFSv4.2 规范支持 <code>ServerSide Copy</code>。</p></blockquote><h4 id="方法一：在-NAS-本机传输"><a href="#方法一：在-NAS-本机传输" class="headerlink" title="方法一：在 NAS 本机传输"></a>方法一：在 NAS 本机传输</h4><p>（熟悉命令行也可以使用命令行传输文件，但是并不是太好用）。</p><p>推荐在 NAS 安装具备 WebUI 的文件管理器 APP（如 <code>Filebrowser</code>），在文件管理器中进行文件操作。</p><h4 id="方法二：使用-Windows"><a href="#方法二：使用-Windows" class="headerlink" title="方法二：使用 Windows"></a>方法二：使用 Windows</h4><p>使用支持 SMB <code>ServerSide Copy</code> 特性的 SMB 客户端进行文件操作，操作系统如 Windows 8+ 的 <code>文件资源管理器</code>即可支持。</p><p><del>但是对于 macOS Finder，需要服务器 <code>Samba</code> 在 <code>smb.conf</code> 中包含 <code>vfs_fruit</code> 模块和 <code>fruit:copyfile = yes</code></del>。</p><p>对于 macOS，Finder 及第三方文件管理器，均无法支持 SMB 的<code>ServerSide Copy</code>。</p><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul><li><a href="https://wiki.samba.org/index.php/Server-Side_Copy">Server-Side Copy - SambaWiki </a></li><li><a href="https://forums.truenas.com/t/macos-preparing-to-move-folders-between-directories-in-the-same-truenas-share-why-is-this-taking-so-long/4634/22">MacOS ｜ ＜ preparing to move…＜ folders between directories in the SAME truenas share. Why is this taking so long％ - TrueNAS General - TrueNAS Community Forums </a></li></ul><p>-EOF</p><p>查看最新版，请访问本文链接：<a href="https://blog.onehat.cn/p/fc3d.html">https://blog.onehat.cn/p/fc3d.html</a></p><p>原创作品，转载请保留出处。</p>]]></content>
      
      
      <categories>
          
          <category> 工作坊 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技术 </tag>
            
            <tag> NAS </tag>
            
            <tag> SMB </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu 镜像站网速比拼</title>
      <link href="/p/9a33.html"/>
      <url>/p/9a33.html</url>
      
        <content type="html"><![CDATA[<p>Ubuntu 镜像站网速比拼：下载速度哪家强？不服跑个 upgrade！</p><span id="more"></span><h3 id="实验环境"><a href="#实验环境" class="headerlink" title="实验环境"></a>实验环境</h3><p>宽带规格：广州联通，带宽 1000M。</p><p>测速方法：使用 VMware Workstation Pro 17 安装 Ubuntu 23.10 虚拟机，打上快照。依次切换用不同的镜像源进行更新，单个源更新过程中不做任何额外操作，等待完成后，恢复快照、切换源，重复实验。</p><h3 id="实验对象"><a href="#实验对象" class="headerlink" title="实验对象"></a>实验对象</h3><p>几个华南区域常用的镜像站：<a href="https://mirrors.ustc.edu.cn/">科大</a>、<a href="https://mirrors.tuna.tsinghua.edu.cn/">清华</a>、<a href="https://mirrors.cloud.tencent.com/">腾讯云</a>。</p><h3 id="实验结果"><a href="#实验结果" class="headerlink" title="实验结果"></a>实验结果</h3><table><thead><tr><th>站点</th><th>速度</th><th>截图</th></tr></thead><tbody><tr><td>科大</td><td>下载 756MB，耗时 20 秒 (38.7MB&#x2F;s)</td><td><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-03-12_23-46-02.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-03-12_23-46-02.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></td></tr><tr><td>清华</td><td>下载 756MB，耗时 2 分 11 秒 (38.7MB&#x2F;s)</td><td><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-03-13_00-03-14.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-03-13_00-03-14.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></td></tr><tr><td>腾讯云</td><td>下载 756MB，耗时 53 秒 (14.2MB&#x2F;s)</td><td><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-03-12_23-55-58.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-03-12_23-55-58.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></td></tr></tbody></table><p>-EOF</p><p>查看最新版，请访问本文链接：<a href="https://blog.onehat.cn/p/9a33.html">https://blog.onehat.cn/p/9a33.html</a></p><p>原创作品，转载请保留出处。</p>]]></content>
      
      
      <categories>
          
          <category> 工作坊 </category>
          
          <category> 里甲 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技术 </tag>
            
            <tag> Linux </tag>
            
            <tag> Ubuntu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CloudflareTunnel 内网穿透</title>
      <link href="/p/cbe0.html"/>
      <url>/p/cbe0.html</url>
      
        <content type="html"><![CDATA[<p>记录 CloudflareTunnel 内网穿透操作。</p><span id="more"></span><h3 id="Proxmox-VE"><a href="#Proxmox-VE" class="headerlink" title="Proxmox VE"></a>Proxmox VE</h3><p>版本：8.1.4</p><p>使用 https，需要在 Public Hostname Page 的 Additional application settings 开启以下 3 个选项。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">No TLS Verify</span><br><span class="line">HTTP2 connection</span><br><span class="line">Disable Chunked Encoding</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-03-09_15-32-15.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-03-09_15-32-15.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2024-03-09_15-32-15"></p><h3 id="Unraid"><a href="#Unraid" class="headerlink" title="Unraid"></a>Unraid</h3><p>版本：6.12.6</p><p>使用 http 协议，配置如图：</p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-03-09_15-40-55.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-03-09_15-40-55.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2024-03-09_15-40-55"></p><h3 id="SSH"><a href="#SSH" class="headerlink" title="SSH"></a>SSH</h3><h4 id="设置"><a href="#设置" class="headerlink" title="设置"></a>设置</h4><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-06-16_21-13-22.webp" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-06-16_21-13-22.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2023-06-16_21-13-22"></p><h4 id="连接"><a href="#连接" class="headerlink" title="连接"></a>连接</h4><p>如官方文档<a href="https://developers.cloudflare.com/cloudflare-one/connections/connect-apps/use-cases/ssh/#2-connect-as-a-user">Connect as a user</a>所示，请首先在你的电脑上<a href="https://developers.cloudflare.com/cloudflare-one/connections/connect-apps/install-and-setup/installation/">安装 cloudflared</a>。</p><p>然后配置 SSH, 比如 <code>~/.ssh/config</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Host home-ubuntu.example.com</span><br><span class="line">    HostName home-ubuntu.example.com</span><br><span class="line">    TCPKeepAlive yes</span><br><span class="line">    User dong</span><br><span class="line">    ServerAliveInterval 15</span><br><span class="line">    IdentityFile ~/.ssh/dell_ubuntu</span><br><span class="line">    Port 22</span><br><span class="line">    ProxyCommand /opt/homebrew/bin/cloudflared access ssh --hostname %h</span><br></pre></td></tr></table></figure><p>注意，这里主要的区别是多了 <code>ProxyCommand /opt/homebrew/bin/cloudflared access ssh --hostname %h</code>，以及<strong>Hostname</strong> 由 <code>192.168.1.101</code>变成了你在 Cloudflare 设置的 <code>home-ubuntu.example.com</code>。</p><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul><li><a href="https://www.nanguoyu.com/cloudflare-tunnel-ssh-smb-web">Cloudflare tunnel 实现内网穿透 SSH,SMB，和 web_老旧笔记本第二春 - 木叶下 </a></li></ul><p>-EOF</p><p>查看最新版，请访问本文链接：<a href="https://blog.onehat.cn/p/cbe0.html">https://blog.onehat.cn/p/cbe0.html</a></p><p>原创作品，转载请保留出处。</p>]]></content>
      
      
      <categories>
          
          <category> 工作坊 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技术 </tag>
            
            <tag> Cloudflare </tag>
            
            <tag> PVE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>转载--SSMS 格式化插件 SQL Printer for SSMS 破解</title>
      <link href="/p/89b9.html"/>
      <url>/p/89b9.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>使用 dnSpy 去除插件的试用提示。</p><p>管理员权限打开 dnSpy，定位到指定函数，[编辑类]，修改后保存即可。</p><p>原文地址：<a href="https://www.52pojie.cn/thread-1416605-1-1.html">https://www.52pojie.cn/thread-1416605-1-1.html</a></p></blockquote><span id="more"></span><p>一款 SQL 格式化插件，免费版试用 60 天<br>找到 DLL 路径在：C:\Program Files (x86)\Gudusoft\ppforssms<br>直接上 dnSpy 爆破，调试和找关键代码的过程我就跳过了。<br>关键方法是 checkkey()，发现每次都会调用它，我们直接让它返回 True。</p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-02-22_11-08-55.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-02-22_11-08-55.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2024-02-22_11-08-55"></p>]]></content>
      
      
      <categories>
          
          <category> 工作坊 </category>
          
          <category> 获取信息源 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技术 </tag>
            
            <tag> MSSQL </tag>
            
            <tag> .NET </tag>
            
            <tag> 转载 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>syslog 实践</title>
      <link href="/p/7ea6.html"/>
      <url>/p/7ea6.html</url>
      
        <content type="html"><![CDATA[<p>目标是要把各个设备的系统日志收集起来，便于集中管理。</p><span id="more"></span><div class="story post-story"><h2 id="实验环境"><a href="#实验环境" class="headerlink" title="实验环境"></a>实验环境</h2><table><thead><tr><th>主机</th><th>OS</th><th>用途</th></tr></thead><tbody><tr><td>192.168.31.250</td><td>windows server 2022</td><td>日志服务器</td></tr><tr><td>192.168.31.250</td><td>windows server 2022</td><td>syslog 发送日志（客户端），这台机同时也做日志服务器。</td></tr><tr><td>192.168.31.240</td><td>debian 12</td><td>syslog 发送日志（客户端）</td></tr><tr><td>192.168.31.220</td><td>Unraid 6.12.6</td><td>syslog 发送日志（客户端）</td></tr></tbody></table></div><div class="story post-story"><h2 id="Server"><a href="#Server" class="headerlink" title="Server"></a>Server</h2><h3 id="windows-Kiwi-Syslog-Server"><a href="#windows-Kiwi-Syslog-Server" class="headerlink" title="windows : Kiwi Syslog Server"></a>windows : Kiwi Syslog Server</h3><blockquote><p>主机 IP：192.168.31.250</p></blockquote><p>windows&#x2F;windows server 系统搭建 syslog 服务器，使用 Kiwi_Syslog_Server_9.5.0。</p><p>安装与激活，请参考以下博文：</p><p><a href="https://blog.csdn.net/ytlzq0228/article/details/104826989">【逗老师带你学 IT】Kiwi Syslog Web Access 与 Active Directory 集成认证-CSDN 博客</a></p><p>2015 年的老软件，资源占用并不多。</p></div><div class="story post-story"><h2 id="Client"><a href="#Client" class="headerlink" title="Client"></a>Client</h2><h3 id="Unraid"><a href="#Unraid" class="headerlink" title="Unraid"></a>Unraid</h3><blockquote><p>主机 IP：192.168.31.220</p></blockquote><p>Unraid 系统自带 syslog 日志客户端，在 WebUI 设置日志服务器即可。</p><p>设置&gt;系统日志服务器&gt;远程系统日志服务器</p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-01-28_16-53-07.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-01-28_16-53-07.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2024-01-28_16-53-07"></p><p>注册完成后，在 syslog server 即可看到当前主机 192.168.31.220 的日志。</p><h3 id="windows-evtsys"><a href="#windows-evtsys" class="headerlink" title="windows : evtsys"></a>windows : evtsys</h3><blockquote><p>主机 IP：192.168.31.250</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-01-28_15-58-34.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-01-28_15-58-34.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2024-01-28_15-58-34"></p><p>Windows 系统并无发送 syslog 的配置功能。所以，需要借助 evtsys 来实现 Windows 系统日志采集。</p><p>evtsys 代码托关于 Google Code：</p><p><a href="https://code.google.com/archive/p/eventlog-to-syslog/downloads">https://code.google.com/archive/p/eventlog-to-syslog/downloads</a></p><p>我此时下载最新版本 <code>Evtsys_4.5.1_64-Bit.zip</code>，解压到合适目录下。</p><p>启动 Powershell，命令行 <code> .\evtsys.exe  -h</code>可以查看参数用法。</p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-01-28_15-55-33.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-01-28_15-55-33.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2024-01-28_15-55-33"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#管理员权限</span></span><br><span class="line"><span class="comment">#注册服务，指定日志服务器</span></span><br><span class="line">.\evtsys.exe <span class="literal">-i</span> <span class="literal">-h</span> <span class="number">192.168</span>.<span class="number">31.250</span> <span class="literal">-p</span> <span class="number">514</span></span><br><span class="line"><span class="comment">#启动服务</span></span><br><span class="line">net <span class="built_in">start</span> evtsys</span><br></pre></td></tr></table></figure><p>如果需要卸载</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#管理员权限</span></span><br><span class="line"><span class="comment">#停止服务</span></span><br><span class="line">net stop evtsys</span><br><span class="line"><span class="comment">#卸载服务</span></span><br><span class="line">.\evtsys.exe <span class="literal">-u</span> <span class="literal">-h</span> <span class="number">192.168</span>.<span class="number">31.250</span> <span class="literal">-p</span> <span class="number">514</span></span><br></pre></td></tr></table></figure><p>注册完成后，在 syslog server 即可看到当前主机 192.168.31.250 的日志。</p><h3 id="debian12-rsyslog"><a href="#debian12-rsyslog" class="headerlink" title="debian12 : rsyslog"></a>debian12 : rsyslog</h3><blockquote><p>主机 IP：192.168.31.240</p></blockquote><p>debian 12 不再附带 syslog，它已被 journald 取代。如果想要使用 syslog，可以安装和配置 rsyslog。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">安装rsyslog</span></span><br><span class="line">apt install rsyslog</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">编辑配置文件</span></span><br><span class="line">vi /etc/rsyslog.conf</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">最下方添加一行，指定消息都发往日志服务器</span></span><br><span class="line">*.info;mail.none;authpriv.none;cron.none @192.168.31.250:514</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">保存后重启服务</span></span><br><span class="line">systemctl restart rsyslog</span><br></pre></td></tr></table></figure><p>完成后，在 syslog server 即可看到当前主机 192.168.31.240 的日志。</p></div><div class="story post-story"><h2 id="总览"><a href="#总览" class="headerlink" title="总览"></a>总览</h2><p>至此，3 台客户端的日志消息都可以在日志服务器看到。</p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-01-28_17-09-43.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-01-28_17-09-43.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2024-01-28_17-09-43"></p><p>-EOF</p><p>查看最新版，请访问本文链接：<a href="https://blog.onehat.cn/p/7ea6.html">https://blog.onehat.cn/p/7ea6.html</a></p><p>原创作品，转载请保留出处。</p></div>]]></content>
      
      
      <categories>
          
          <category> 工作坊 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技术 </tag>
            
            <tag> PVE </tag>
            
            <tag> Linux </tag>
            
            <tag> Unraid </tag>
            
            <tag> Debian </tag>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windows Server 下 MySQL5.7 配置</title>
      <link href="/p/7919.html"/>
      <url>/p/7919.html</url>
      
        <content type="html"><![CDATA[<p>记录绿色版 MySQL5.7 的安装、配置。</p><span id="more"></span><h3 id="先决条件"><a href="#先决条件" class="headerlink" title="先决条件"></a>先决条件</h3><p>本次实验环境如下：</p><table><thead><tr><th>项目</th><th>版本</th><th>备注</th></tr></thead><tbody><tr><td>OS</td><td>Windows Server 2022 Datacenter</td><td>IP 地址 192.168.31.165</td></tr><tr><td>MySQL</td><td>5.7.44</td><td>mysql-5.7.44-winx64.zip</td></tr><tr><td>微软运行库</td><td>微软常用运行库合集 2023.11.13</td><td>注册服务需要使用</td></tr></tbody></table><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-11-30_23-05-33.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-11-30_23-05-33.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2023-11-30_23-05-33"></p><h3 id="安装、注册"><a href="#安装、注册" class="headerlink" title="安装、注册"></a>安装、注册</h3><p>将 <code>mysql-5.7.44-winx64.zip</code>解压到目录 <code>C:\opt\mysql</code>。</p><p>配置文件 <code>my.ini</code>放到 <code>bin</code>目录下，注意其中的两个路径需要修改。</p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-11-30_23-11-57.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-11-30_23-11-57.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2023-11-30_23-11-57"></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置 3306 端口</span></span><br><span class="line"></span><br><span class="line"><span class="attr">port</span>=<span class="number">3306</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置 mysql 的安装目录</span></span><br><span class="line"><span class="attr">basedir</span>=C:\opt\mysql\mysql-<span class="number">5.7</span>.<span class="number">44</span>-winx64</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置 mysql 数据库的数据的存放目录</span></span><br><span class="line"></span><br><span class="line"><span class="attr">datadir</span>=C:\opt\mysql\mysql-<span class="number">5.7</span>.<span class="number">44</span>-winx64\Data</span><br><span class="line"></span><br><span class="line"><span class="comment"># 允许最大连接数</span></span><br><span class="line"></span><br><span class="line"><span class="attr">max_connections</span>=<span class="number">200</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 允许连接失败的次数。这是为了防止有人从该主机试图攻击数据库系统</span></span><br><span class="line"></span><br><span class="line"><span class="attr">max_connect_errors</span>=<span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 服务端使用的字符集默认为 UTF8</span></span><br><span class="line"></span><br><span class="line"><span class="attr">character-set-server</span>=utf8</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建新表时将使用的默认存储引擎</span></span><br><span class="line"></span><br><span class="line"><span class="attr">default-storage-engine</span>=INNODB</span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认使用“mysql_native_password”插件认证</span></span><br><span class="line"></span><br><span class="line"><span class="attr">default_authentication_plugin</span>=mysql_native_password</span><br><span class="line"></span><br><span class="line"><span class="section">[mysql]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置 mysql 客户端默认字符集</span></span><br><span class="line"></span><br><span class="line"><span class="attr">default-character-set</span>=utf8mb4</span><br><span class="line"></span><br><span class="line"><span class="section">[client]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置 mysql 客户端连接服务端时默认使用的端口</span></span><br><span class="line"></span><br><span class="line"><span class="attr">port</span>=<span class="number">3306</span></span><br><span class="line"></span><br><span class="line"><span class="attr">default-character-set</span>=utf8</span><br></pre></td></tr></table></figure><p>并在系统环境变量添加 <code>bin</code>路径，以供全局命令行使用。</p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-11-30_23-13-50.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-11-30_23-13-50.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2023-11-30_23-13-50"></p><p>管理员权限打开 cmd，进行注册：</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">###安装服务</span><br><span class="line">mysqld --install</span><br><span class="line">###生成data</span><br><span class="line">mysqld --initialize</span><br><span class="line">###启动服务</span><br><span class="line"><span class="built_in">net</span> <span class="built_in">start</span> mysql</span><br><span class="line">###尝试登录</span><br><span class="line">mysql -u root</span><br><span class="line">###修改root密码</span><br><span class="line">ALTER USER &#x27;root&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;新密码&#x27;;</span><br></pre></td></tr></table></figure><h3 id="开启远程访问"><a href="#开启远程访问" class="headerlink" title="开启远程访问"></a>开启远程访问</h3><p>在配置 3306 端口的 windows 防火墙规则后，需要开启 MySQL 服务的远程访问权限。</p><p>Host 列指定了允许用户登录所使用的 IP，比如 user&#x3D;root、Host&#x3D;192.168.111.101。这里的意思就是说 root 用户只能通过 192.168.111.101 的客户端去访问。</p><p>user&#x3D;root、Host&#x3D;localhost，表示只能通过本机客户端去访问。而%是个通配符，如果 Host&#x3D;192.168.1.%，那么就表示只要是 IP 地址前缀为“192.168.1.”的客户端都可以连接。如果 Host&#x3D;%，表示所有 IP 都有连接权限。</p><p>注意：在生产环境下不能为了省事将 host 设置为%，这样做会存在安全问题，具体的设置可以根据生产环境的 IP 进行设置。</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">###登录mysql</span><br><span class="line">mysql -u root -p</span><br><span class="line">###进行配置</span><br><span class="line">mysql&gt; use mysql;</span><br><span class="line">Database changed</span><br><span class="line">mysql&gt; select Host,User from user;</span><br><span class="line">+-----------+---------------+</span><br><span class="line">| Host      | User          |</span><br><span class="line">+-----------+---------------+</span><br><span class="line">| <span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span> | halodb        |</span><br><span class="line">| localhost | halodb        |</span><br><span class="line">| localhost | mysql.session |</span><br><span class="line">| localhost | mysql.sys     |</span><br><span class="line">| localhost | root          |</span><br><span class="line">+-----------+---------------+</span><br><span class="line"><span class="number">5</span> rows <span class="keyword">in</span> <span class="built_in">set</span> (<span class="number">0</span>.<span class="number">00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; update user <span class="built_in">set</span> host = &#x27;%&#x27; where user =&#x27;root&#x27;;</span><br><span class="line">Query OK, <span class="number">1</span> row affected (<span class="number">0</span>.<span class="number">00</span> sec)</span><br><span class="line">Rows matched: <span class="number">1</span>  Changed: <span class="number">1</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">mysql&gt; flush privileges;</span><br></pre></td></tr></table></figure><p>-EOF</p><p>查看最新版，请访问本文链接：<a href="https://blog.onehat.cn/p/7919.html">https://blog.onehat.cn/p/7919.html</a></p><p>原创作品，转载请保留出处。</p>]]></content>
      
      
      <categories>
          
          <category> 工作坊 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技术 </tag>
            
            <tag> Windows Server </tag>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Everything HTTP 服务显示磁盘标签</title>
      <link href="/p/ebb.html"/>
      <url>/p/ebb.html</url>
      
        <content type="html"><![CDATA[<p>Everything 开启配置实现在 HTTP 服务器显示磁盘标签。</p><span id="more"></span><h3 id="前置条件"><a href="#前置条件" class="headerlink" title="前置条件"></a>前置条件</h3><p>本次实验环境</p><p>Everything 版本 V1.4.1.1022 (x64)</p><h3 id="修改配置"><a href="#修改配置" class="headerlink" title="修改配置"></a>修改配置</h3><p>在 Everything 1.3 中移除了云端硬盘标签，因为根文件夹可以是文件夹或文件列表。</p><p>这样会导致无法区分硬盘。</p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-10-25_20-15-19.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-10-25_20-15-19.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="修改前"></p><p>退出 Everything 的程序、后台服务。</p><p>打开配置文件</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">notepad <span class="variable">%APPDATA%</span>\Everything\Everything.ini</span><br></pre></td></tr></table></figure><p>搜索 http_server_show_drive_labels，将值改为 1。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http_server_show_drive_labels=1</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-10-25_20-21-37.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-10-25_20-21-37.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="修改后"></p><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul><li><a href="https://www.voidtools.com/forum/viewtopic.php?p=16446&hilit=http_server_show_drive_labels#p16446">HTTP Server Help - voidtools forum</a></li></ul><p>-EOF</p><p>查看最新版，请访问本文链接：<a href="https://blog.onehat.cn/p/ebb.html">https://blog.onehat.cn/p/ebb.html</a></p><p>原创作品，转载请保留出处。</p>]]></content>
      
      
      <categories>
          
          <category> 工作坊 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技术 </tag>
            
            <tag> 软件 </tag>
            
            <tag> Everything </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker 安装 Oracle11g 数据库并进行持久化</title>
      <link href="/p/e850.html"/>
      <url>/p/e850.html</url>
      
        <content type="html"><![CDATA[<p>记录使用 docker 安装 Oracle11g，持久化需要使用 Unraid docker 的发布参数功能。</p><span id="more"></span><h3 id="先决条件"><a href="#先决条件" class="headerlink" title="先决条件"></a>先决条件</h3><p>本次实验环境如下：</p><p>Unraid 版本：6.12.6</p><p>Docker 版本：20.10.24</p><h3 id="安装并配置-Oracle11g-数据库容器"><a href="#安装并配置-Oracle11g-数据库容器" class="headerlink" title="安装并配置 Oracle11g 数据库容器"></a>安装并配置 Oracle11g 数据库容器</h3><p>这部分不细写，网上教程很多，也很详细。（可以参考此教程：<a href="https://jiasenjiang.top/docs/%E6%95%B0%E6%8D%AE%E5%BA%93/oracle/docker%E9%83%A8%E7%BD%B2oracle11g%E5%B9%B6%E8%BF%9B%E8%A1%8C%E6%8C%81%E4%B9%85%E5%8C%96/">docker 部署 oracle11g 并进行持久化</a>）</p><h3 id="解决持久化问题"><a href="#解决持久化问题" class="headerlink" title="解决持久化问题"></a>解决持久化问题</h3><p>上述博文中给出的持久化步骤并不完全正确，如果只是停止、重启容器是持久化成功的。如果每次修改容器参数后重建，都需要对容器重新操作。最佳方案是使用 docker 启动前&#x2F;启动后脚本，但我试过并不生效（不知是 Unraid 的问题还是 docker 问题？）。</p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-12-31_02-28-17.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-12-31_02-28-17.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2023-12-31_02-28-17"></p><p>经查询 Unraid 论坛相关帖子，发现使用 Unraid docker 可视化编辑器的发布参数（Post Arguments）功能可以解决问题。发布参数的作用就是在容器创建后执行某命令，尝试过调用 shell 脚本不生效，所以就把命令用&amp;&amp;连起来写在一起。</p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/c0f22196-1fe6-45db-952e-b0345a8094c5.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/c0f22196-1fe6-45db-952e-b0345a8094c5.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="c0f22196-1fe6-45db-952e-b0345a8094c5"></p><p>在发布参数添加以下命令，即可不受容器重建的影响。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;&amp; docker exec -d DB-Oracle11g bash -c &quot;/bin/cp -rf /home/oracle/app/oracle/oradata/helowin/control01.ctl /home/oracle/app/oracle/flash_recovery_area/helowin/control02.ctl &amp;&amp; /home/oracle/app/oracle/product/11.2.0/dbhome_2/bin/dbstart &quot;</span><br></pre></td></tr></table></figure><p>同时贴出 Unraid 的 docker 模板供参考</p><p>文件：<code>/boot/config/plugins/dockerMan/templates-user/my-DB-Oracle11g.xml</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Container</span> <span class="attr">version</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Name</span>&gt;</span>DB-Oracle11g<span class="tag">&lt;/<span class="name">Name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Repository</span>&gt;</span>registry.cn-hangzhou.aliyuncs.com/helowin/oracle_11g<span class="tag">&lt;/<span class="name">Repository</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Registry</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Network</span>&gt;</span>bridge<span class="tag">&lt;/<span class="name">Network</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">MyIP</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Shell</span>&gt;</span>bash<span class="tag">&lt;/<span class="name">Shell</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Privileged</span>&gt;</span>false<span class="tag">&lt;/<span class="name">Privileged</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Support</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Project</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Overview</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Category</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">WebUI</span>&gt;</span>http://[IP]:[PORT:21580]/<span class="tag">&lt;/<span class="name">WebUI</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">TemplateURL</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Icon</span>&gt;</span>https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub/icons/oracledb.png<span class="tag">&lt;/<span class="name">Icon</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ExtraParams</span>&gt;</span>--restart=unless-stopped --memory=4G<span class="tag">&lt;/<span class="name">ExtraParams</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">PostArgs</span>&gt;</span>&amp;&amp; docker exec -d DB-Oracle11g bash -c &quot;/bin/cp -rf /home/oracle/app/oracle/oradata/helowin/control01.ctl /home/oracle/app/oracle/flash_recovery_area/helowin/control02.ctl &amp;&amp; /home/oracle/app/oracle/product/11.2.0/dbhome_2/bin/dbstart &quot;<span class="tag">&lt;/<span class="name">PostArgs</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">CPUset</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">DateInstalled</span>&gt;</span>1710235946<span class="tag">&lt;/<span class="name">DateInstalled</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">DonateText</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">DonateLink</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Requires</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Config</span> <span class="attr">Name</span>=<span class="string">&quot;port&quot;</span> <span class="attr">Target</span>=<span class="string">&quot;1521&quot;</span> <span class="attr">Default</span>=<span class="string">&quot;&quot;</span> <span class="attr">Mode</span>=<span class="string">&quot;tcp&quot;</span> <span class="attr">Description</span>=<span class="string">&quot;&quot;</span> <span class="attr">Type</span>=<span class="string">&quot;Port&quot;</span> <span class="attr">Display</span>=<span class="string">&quot;always&quot;</span> <span class="attr">Required</span>=<span class="string">&quot;false&quot;</span> <span class="attr">Mask</span>=<span class="string">&quot;false&quot;</span>&gt;</span>1521<span class="tag">&lt;/<span class="name">Config</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Config</span> <span class="attr">Name</span>=<span class="string">&quot;Host Key 1&quot;</span> <span class="attr">Target</span>=<span class="string">&quot;ORACLE_HOME&quot;</span> <span class="attr">Default</span>=<span class="string">&quot;&quot;</span> <span class="attr">Mode</span>=<span class="string">&quot;&quot;</span> <span class="attr">Description</span>=<span class="string">&quot;&quot;</span> <span class="attr">Type</span>=<span class="string">&quot;Variable&quot;</span> <span class="attr">Display</span>=<span class="string">&quot;always&quot;</span> <span class="attr">Required</span>=<span class="string">&quot;false&quot;</span> <span class="attr">Mask</span>=<span class="string">&quot;false&quot;</span>&gt;</span>/home/oracle/app/oracle/product/11.2.0/dbhome_2<span class="tag">&lt;/<span class="name">Config</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Config</span> <span class="attr">Name</span>=<span class="string">&quot;ORACLE_SID&quot;</span> <span class="attr">Target</span>=<span class="string">&quot;ORACLE_SID&quot;</span> <span class="attr">Default</span>=<span class="string">&quot;&quot;</span> <span class="attr">Mode</span>=<span class="string">&quot;&quot;</span> <span class="attr">Description</span>=<span class="string">&quot;&quot;</span> <span class="attr">Type</span>=<span class="string">&quot;Variable&quot;</span> <span class="attr">Display</span>=<span class="string">&quot;always&quot;</span> <span class="attr">Required</span>=<span class="string">&quot;false&quot;</span> <span class="attr">Mask</span>=<span class="string">&quot;false&quot;</span>&gt;</span>helowin<span class="tag">&lt;/<span class="name">Config</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Config</span> <span class="attr">Name</span>=<span class="string">&quot;ocadata&quot;</span> <span class="attr">Target</span>=<span class="string">&quot;/home/oracle/app/oracle/oradata&quot;</span> <span class="attr">Default</span>=<span class="string">&quot;&quot;</span> <span class="attr">Mode</span>=<span class="string">&quot;rw&quot;</span> <span class="attr">Description</span>=<span class="string">&quot;&quot;</span> <span class="attr">Type</span>=<span class="string">&quot;Path&quot;</span> <span class="attr">Display</span>=<span class="string">&quot;always&quot;</span> <span class="attr">Required</span>=<span class="string">&quot;false&quot;</span> <span class="attr">Mask</span>=<span class="string">&quot;false&quot;</span>&gt;</span>/mnt/disk1/appdata/oracle11g/oradata<span class="tag">&lt;/<span class="name">Config</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Config</span> <span class="attr">Name</span>=<span class="string">&quot;ORACLE_HOME&quot;</span> <span class="attr">Target</span>=<span class="string">&quot;ORACLE_HOME&quot;</span> <span class="attr">Default</span>=<span class="string">&quot;&quot;</span> <span class="attr">Mode</span>=<span class="string">&quot;&quot;</span> <span class="attr">Description</span>=<span class="string">&quot;&quot;</span> <span class="attr">Type</span>=<span class="string">&quot;Variable&quot;</span> <span class="attr">Display</span>=<span class="string">&quot;always&quot;</span> <span class="attr">Required</span>=<span class="string">&quot;false&quot;</span> <span class="attr">Mask</span>=<span class="string">&quot;false&quot;</span>&gt;</span>/home/oracle/app/oracle/product/11.2.0/dbhome_2<span class="tag">&lt;/<span class="name">Config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Container</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul><li><a href="https://jiasenjiang.top/docs/%E6%95%B0%E6%8D%AE%E5%BA%93/oracle/docker%E9%83%A8%E7%BD%B2oracle11g%E5%B9%B6%E8%BF%9B%E8%A1%8C%E6%8C%81%E4%B9%85%E5%8C%96/">docker 部署 oracle11g 并进行持久化</a></li><li><a href="https://forums.unraid.net/topic/43677-run-a-script-after-docker-container-starts/">Run a script after docker container starts? - Docker Engine - Unraid</a></li></ul><p>-EOF</p><p>查看最新版，请访问本文链接：<a href="https://blog.onehat.cn/p/e850.html">https://blog.onehat.cn/p/e850.html</a></p><p>原创作品，转载请保留出处。</p>]]></content>
      
      
      <categories>
          
          <category> 工作坊 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技术 </tag>
            
            <tag> Linux </tag>
            
            <tag> Unraid </tag>
            
            <tag> 数据库 </tag>
            
            <tag> Oracle </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PVE8 安装 LXC 并启用硬解（Jellyfin 篇）</title>
      <link href="/p/834f.html"/>
      <url>/p/834f.html</url>
      
        <content type="html"><![CDATA[<p>记录在 PVE8 虚拟化平台下安装 LXC 容器以实现 Jellyfin 的核显硬解，原则上适用于所有 12-13 代英特尔核显。</p><span id="more"></span><h3 id="先决条件"><a href="#先决条件" class="headerlink" title="先决条件"></a>先决条件</h3><p>具备实验环境<br>Proxmox VE 8.0</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">proxmox-ve: 8.0.2 (running kernel: 6.2.16-14-pve)</span><br><span class="line">qemu-server: 8.0.7</span><br></pre></td></tr></table></figure><p>PVE 主机正常驱动核显，我使用的 CPU 为 12900 ES（QXQ3），核显为 UHD770。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">╭─root@pve ~</span><br><span class="line">╰─# ls /dev/dri</span><br><span class="line">by-path  card0  renderD128</span><br></pre></td></tr></table></figure><h3 id="开启-GUC-支持（PVE-主机）"><a href="#开启-GUC-支持（PVE-主机）" class="headerlink" title="开启 GUC 支持（PVE 主机）"></a>开启 GUC 支持（PVE 主机）</h3><p>编辑文件 <code>/etc/modprobe.d/i915.conf</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano /etc/modprobe.d/i915.conf</span><br></pre></td></tr></table></figure><p>添加以下内容</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">options i915 enable_guc=3</span><br></pre></td></tr></table></figure><p>重启 PVE 主机后生效，此时终端输入 <code>dmesg | grep i915</code>查看到 guc 启用情况为 enable，且可以看到 <code>dmc firmware</code>和 <code>huc firmware</code>两个固件的信息。<br><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-10-09_17-59-53.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-10-09_17-59-53.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2023-10-09_17-59-53.png"></p><h3 id="下载并创建-LXC-容器"><a href="#下载并创建-LXC-容器" class="headerlink" title="下载并创建 LXC 容器"></a>下载并创建 LXC 容器</h3><h4 id="下载-CT-模板"><a href="#下载-CT-模板" class="headerlink" title="下载 CT 模板"></a>下载 CT 模板</h4><p>在 PVE 的 web 界面，找到 <code>local-CT模板-模板</code>，弹窗中搜索 <code>debian</code>，选中 debian12 的模板下载。<br><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-10-09_18-09-49.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-10-09_18-09-49.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2023-10-09_18-09-49.png"></p><h4 id="新建-LXC-容器"><a href="#新建-LXC-容器" class="headerlink" title="新建 LXC 容器"></a>新建 LXC 容器</h4><p>下载完成后，右键节点，使用 debian12 的模板新建 LXC 容器，注意去除勾选 <code>无特权容器</code><br><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-10-09_18-34-13.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-10-09_18-34-13.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2023-10-09_18-34-13.png"><br><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-10-09_18-34-36.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-10-09_18-34-36.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2023-10-09_18-34-36.png"></p><h3 id="配置-LXC-容器"><a href="#配置-LXC-容器" class="headerlink" title="配置 LXC 容器"></a>配置 LXC 容器</h3><h4 id="基础配置"><a href="#基础配置" class="headerlink" title="基础配置"></a>基础配置</h4><p>创建完成后，先不启动，在 LXC 容器的配置文件中映射主机的核显设备<br>编辑配置文件 <code>/etc/pve/lxc/218.conf</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano /etc/pve/lxc/218.conf</span><br></pre></td></tr></table></figure><p>最下方添加以下内容</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">lxc.cgroup2.devices.allow: c 226:0 rwm</span><br><span class="line">lxc.cgroup2.devices.allow: c 226:128 rwm</span><br><span class="line">lxc.mount.entry: /dev/dri/card0 dev/dri/card0 none bind,optional,create=file</span><br><span class="line">lxc.mount.entry: /dev/dri/renderD128 dev/dri/renderD128 none bind,optional,create=file</span><br><span class="line">lxc.apparmor.profile: unconfined</span><br><span class="line">lxc.cap.drop:</span><br></pre></td></tr></table></figure><p>完成后启动 LXC 容器，在 PVE 控制台中登录，开启 ssh 远程登录权限。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">nano /etc/ssh/sshd_config #编辑sshd配置文件</span><br><span class="line"></span><br><span class="line">###sshd_config配置项修改 begin</span><br><span class="line">PermitRootLogin yes</span><br><span class="line">PasswordAuthentication yes</span><br><span class="line">###sshd_config配置项修改 end</span><br><span class="line"></span><br><span class="line">service ssh restart #重启sshd服务</span><br></pre></td></tr></table></figure><p>对 LXC 容器进行换源、更新操作。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">nano /etc/apt/sources.list #编辑源文件</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##sources.list 源文件修改 begin</span></span></span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm main contrib non-free non-free-firmware</span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-updates main contrib non-free non-free-firmware</span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-backports main contrib non-free non-free-firmware</span><br><span class="line">deb https://security.debian.org/debian-security bookworm-security main contrib non-free non-free-firmware</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##sources.list 源文件修改 end</span></span></span><br><span class="line"></span><br><span class="line">apt update &amp;&amp; apt upgrade -y #更新</span><br></pre></td></tr></table></figure><p>安装 intel_gpu_top，在命令行查看核显占用。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install intel-gpu-tools</span><br></pre></td></tr></table></figure><p>终端输入 <code>intel_gpu_top</code>看到如下信息，Ctrl+C 取消。</p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-10-09_21-09-39.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-10-09_21-09-39.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2023-10-09_21-09-39"></p><h4 id="挂载-NFS"><a href="#挂载-NFS" class="headerlink" title="挂载 NFS"></a>挂载 NFS</h4><p>影音文件保存在 NAS 中，NAS 开启 NFS 分享，在 LXC 容器中挂载以供 Jellyfin 服务使用。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">apt install nfs-common -y #安装nfs-common</span><br><span class="line">apt install nfs-utils -y #高版本Ubuntu中，可安装nfs-utils</span><br><span class="line">mount -t nfs 192.168.31.220:/mnt/disk2 /mnt/share_nfs #挂载NFS</span><br><span class="line"></span><br><span class="line">nano /etc/fstab #编辑配置文件</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">配置文件fstab begin</span></span><br><span class="line">192.168.31.220:/mnt/disk2 /mnt/share_nfs nfs defaults 0 0</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">配置文件fstab end</span></span><br></pre></td></tr></table></figure><p>挂载完成后查看文件是否存在，挂载得到的文件权限可以在 NFS 服务端做出配置。如无问题，则修改 <code>/etc/fstab</code>文件开机自动挂载 NFS 目录。</p><h4 id="安装-docker-版-Jellyfin"><a href="#安装-docker-版-Jellyfin" class="headerlink" title="安装 docker 版 Jellyfin"></a>安装 docker 版 Jellyfin</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">apt install curl -y &amp;&amp; curl -sSL https://get.docker.com/ | sh #安装docker</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">安装Jellyfin</span></span><br><span class="line">docker run -d -p 8096:8096 -p 8920:8920 --volume jellyfin-config:/config --volume jellyfin-cache:/cache -v /mnt/share_nfs:/media --device=/dev/dri:/dev/dri --restart=always --name jellyfin nyanmisaka/jellyfin:latest</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="配置-docker-在-NFS-挂载后启动"><a href="#配置-docker-在-NFS-挂载后启动" class="headerlink" title="配置 docker 在 NFS 挂载后启动"></a>配置 docker 在 NFS 挂载后启动</h4><p>默认情况下 docker 和 NFS 挂载动作的执行是不区分先后顺序的，这会导致开机以后 docker 服务已经启动但 NFS 挂载点未就绪，于是在 docker 应用中就无法正常的看到存储池中的文件。<br>终端执行 <code>systemctl list-units | grep mount</code>寻找与 fstab 中配置对应的信息，我的挂载任务为：<code>mnt-share_nfs.mount </code></p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-10-09_20-30-28.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-10-09_20-30-28.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2023-10-09_20-30-28.png"></p><p>编辑 docker 服务配置，将上面找到的挂载任务设置为 After 项目以及 Wants 项目。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano /lib/systemd/system/docker.service #编辑配置文件</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-10-09_20-47-11.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-10-09_20-47-11.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2023-10-09_20-47-11"></p><p>如有远程连接 docker 需求，可在下方的 ExecStart 中添加 <code>-H tcp://0.0.0.0:2375</code>（上图为已添加）。</p><p>修改完成后执行 <code>systemctl daemon-reload</code>重载系统服务。<code>systemctl restart docker</code>重新启动 docker。</p><p>由于我的 NFS 存储服务由运行在虚拟机里的 Unraid 提供，需要设置 LXC 容器开机自启动时添加延时 180 秒，一般情况下需要重启主机，Unraid 虚拟机可以在 3 分钟内就绪。</p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-10-10_07-50-13.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-10-10_07-50-13.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2023-10-10_07-50-13"></p><h3 id="配置-Jellyfin"><a href="#配置-Jellyfin" class="headerlink" title="配置 Jellyfin"></a>配置 Jellyfin</h3><h4 id="开启核显硬解转码"><a href="#开启核显硬解转码" class="headerlink" title="开启核显硬解转码"></a>开启核显硬解转码</h4><p>由于使用的是 <code>nyanmisaka</code>定制的镜像（<a href="https://www.chiphell.com/thread-2375777-1-1.html">镜像特点</a>），只需在 <code>控制台-播放</code>开启硬解即可。</p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-10-09_20-53-18.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-10-09_20-53-18.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2023-10-09_20-53-18"></p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-10-09_20-53-49.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-10-09_20-53-49.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2023-10-09_20-53-49"></p><h4 id="安装插件"><a href="#安装插件" class="headerlink" title="安装插件"></a>安装插件</h4><h5 id="MetaShark-刮削插件（豆瓣）"><a href="#MetaShark-刮削插件（豆瓣）" class="headerlink" title="MetaShark 刮削插件（豆瓣）"></a><a href="https://github.com/cxfksword/jellyfin-plugin-metashark">MetaShark 刮削插件（豆瓣）</a></h5><p>进入 Jellyfin 控制台 &gt; 插件 &gt; 存储库，点击添加</p><p>输入存储库名称：<code>MetaShark</code></p><p>输入存储库 URL：<a href="https://ghproxy.com/https://github.com/cxfksword/jellyfin-plugin-metashark/releases/download/manifest/manifest_cn.json">https://ghproxy.com/https://github.com/cxfksword/jellyfin-plugin-metashark/releases/download/manifest/manifest_cn.json</a></p><h5 id="MetaTube-刮削插件（成人）"><a href="#MetaTube-刮削插件（成人）" class="headerlink" title="MetaTube 刮削插件（成人）"></a><a href="https://github.com/metatube-community/jellyfin-plugin-metatube/">MetaTube 刮削插件（成人）</a></h5><p>进入 Jellyfin 控制台 &gt; 插件 &gt; 存储库，点击添加</p><p>输入存储库名称：<code>MetaTube</code></p><p>输入存储库 URL：<a href="https://raw.githubusercontent.com/metatube-community/jellyfin-plugin-metatube/dist/manifest.json"><code>https://raw.githubusercontent.com/metatube-community/jellyfin-plugin-metatube/dist/manifest.json</code></a></p><h5 id="MeiamSubtitles-字幕插件"><a href="#MeiamSubtitles-字幕插件" class="headerlink" title="MeiamSubtitles 字幕插件"></a><a href="https://github.com/91270/MeiamSubtitles">MeiamSubtitles 字幕插件</a></h5><p>进入 Jellyfin 控制台 &gt; 插件 &gt; 存储库，点击添加</p><p>输入存储库名称：<code>MeiamSubtitles</code></p><p>输入存储库 URL：<a href="https://github.com/91270/MeiamSubtitles.Release/raw/main/Plugin/manifest-stable.json">https://github.com/91270/MeiamSubtitles.Release/raw/main/Plugin/manifest-stable.json</a></p><h5 id="SkinManager-主题美化插件"><a href="#SkinManager-主题美化插件" class="headerlink" title="SkinManager 主题美化插件"></a><a href="https://github.com/danieladov/jellyfin-plugin-skin-manager">SkinManager 主题美化插件</a></h5><p>进入 Jellyfin 控制台 &gt; 插件 &gt; 存储库，点击添加</p><p>输入存储库名称：<code>SkinManager</code></p><p>输入存储库 URL：<a href="https://raw.githubusercontent.com/danieladov/JellyfinPluginManifest/master/manifest.json">https://raw.githubusercontent.com/danieladov/JellyfinPluginManifest/master/manifest.json</a></p><h5 id="YouTubeMetaData-刮削插件"><a href="#YouTubeMetaData-刮削插件" class="headerlink" title="YouTubeMetaData 刮削插件"></a><a href="https://github.com/ankenyr/jellyfin-youtube-metadata-plugin">YouTubeMetaData 刮削插件</a></h5><p>进入 Jellyfin 控制台 &gt; 插件 &gt; 存储库，点击添加</p><p>输入存储库名称：<code>YoutubeMetadata </code></p><p>输入存储库 URL：<a href="https://raw.githubusercontent.com/ankenyr/jellyfin-plugin-repo/master/manifest.json">https://raw.githubusercontent.com/ankenyr/jellyfin-plugin-repo/master/manifest.json</a></p><p>存储库设置完成后，在插件 Tab 页下找到 <code>MetaTube</code>、<code>Shooter Subtitles</code>、<code>Thuner Subtitles</code>、<code>SkinManager</code>、<code>YoutubeMetadata</code> ，依次点击安装，安装完成需要重启容器才能生效。</p><h4 id="测试硬解"><a href="#测试硬解" class="headerlink" title="测试硬解"></a>测试硬解</h4><p>4k-120Mbps 转码，可以看出 GPU 占用如下：</p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-10-09_21-15-02.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-10-09_21-15-02.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2023-10-09_21-15-02"></p><p>此时的 CPU 占用处于较低的水准。则说明核显硬解配置成功。</p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-10-09_21-16-50.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-10-09_21-16-50.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2023-10-09_21-16-50"></p><p>-EOF</p><p>查看最新版，请访问本文链接：<a href="https://blog.onehat.cn/p/834f.html">https://blog.onehat.cn/p/834f.html</a></p><p>原创作品，转载请保留出处。</p>]]></content>
      
      
      <categories>
          
          <category> 工作坊 </category>
          
          <category> 娱乐中心 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技术 </tag>
            
            <tag> PVE </tag>
            
            <tag> Docker </tag>
            
            <tag> NAS </tag>
            
            <tag> HomeLab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker 开启远程 API</title>
      <link href="/p/2c94.html"/>
      <url>/p/2c94.html</url>
      
        <content type="html"><![CDATA[<p>docker 提供 rest api 服务，开启后可以使用第三方管理工具进行 Docker 管理。一般情况下，会使用 2375 端口号。</p><span id="more"></span><div class="story post-story"><h2 id="前置条件"><a href="#前置条件" class="headerlink" title="前置条件"></a>前置条件</h2><p>具备 Docker 实验环境。</p><p>本次使用的实验环境如下：</p><table><thead><tr><th>系统</th><th>版本信息</th></tr></thead><tbody><tr><td>Linux</td><td>Ubuntu Server 22.04</td></tr><tr><td>Unraid</td><td>6.11.5</td></tr><tr><td>群晖</td><td>7.2.1</td></tr></tbody></table><h3 id="Linux-开启-Docker-远程-API"><a href="#Linux-开启-Docker-远程-API" class="headerlink" title="Linux 开启 Docker 远程 API"></a>Linux 开启 Docker 远程 API</h3><h4 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h4><p>打开 docker 的 systemd 服务注册文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nano /lib/systemd/system/docker.service</span><br></pre></td></tr></table></figure><p>查看 13 行左右的 execStart，是否有类似“-H tcp:&#x2F;&#x2F;0.0.0.0:2375”的参数：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#### 找到[Service]下面的（修改前）</span></span><br><span class="line">ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock</span><br><span class="line"><span class="comment">#### 改为如下（修改后）</span></span><br><span class="line">ExecStart=/usr/bin/dockerd  -H fd:// -H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock --containerd=/run/containerd/containerd.sock</span><br></pre></td></tr></table></figure><h4 id="重启服务"><a href="#重启服务" class="headerlink" title="重启服务"></a>重启服务</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl daemon-reload          <span class="comment"># 重新加载守护进程配置</span></span><br><span class="line">sudo systemctl restart docker.service <span class="comment"># 重启 docker 服务</span></span><br></pre></td></tr></table></figure><h4 id="Shell-脚本自动化"><a href="#Shell-脚本自动化" class="headerlink" title="Shell 脚本自动化"></a>Shell 脚本自动化</h4><p>每次使用包管理器升级 docker 后，配置都会重置，需要重新添加。这里提供一个 Shell 脚本用于定时作业自动化执行，减少繁琐的手动配置。</p><p>Shell 脚本内容如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> -z <span class="string">&quot;<span class="subst">$(cat /usr/lib/systemd/system/docker.service | grep 2375)</span>&quot;</span>; <span class="comment">#判断是否不存在关键字2375</span></span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;不存在关键字2375，执行自动添加。&quot;</span></span><br><span class="line">    sudo sed -i <span class="string">&#x27;s#ExecStart=.*#ExecStart=/usr/bin/dockerd -H fd:// -H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock --containerd=/run/containerd/containerd.sock#&#x27;</span> /usr/lib/systemd/system/docker.service</span><br><span class="line">    sudo systemctl daemon-reload          <span class="comment"># 重新加载守护进程配置</span></span><br><span class="line">    sudo systemctl restart docker.service <span class="comment"># 重启 docker 服务</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;不存在关键字2375，自动添加、重启服务完成。&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;存在关键字2375，结束。&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p>这里使用 1Panel 的计划任务功能实现定时作业，如下图：<code>OS_UPDATE</code>为每月执行一次的更新系统，<code>ENABLE_DOCKER_API</code>放在其之后执行，以便能达到 docker 升级后自动化开启远程 API 的效果。</p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-04-27_15-32-02.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-04-27_15-32-02.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2024-04-27_15-32-02"></p><h3 id="Unraid-开启-Docker-远程-API"><a href="#Unraid-开启-Docker-远程-API" class="headerlink" title="Unraid 开启 Docker 远程 API"></a>Unraid 开启 Docker 远程 API</h3><h4 id="修改配置文件-1"><a href="#修改配置文件-1" class="headerlink" title="修改配置文件"></a>修改配置文件</h4><p>打开配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /boot/config/docker.cfg</span><br></pre></td></tr></table></figure><p>最下方添加</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DOCKER_OPTS=<span class="string">&quot;--storage-driver=btrfs -H unix:///var/run/docker.sock -H tcp://0.0.0.0:2375&quot;</span></span><br></pre></td></tr></table></figure><h4 id="重启服务-1"><a href="#重启服务-1" class="headerlink" title="重启服务"></a>重启服务</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/rc.d/rc.docker restart</span><br></pre></td></tr></table></figure><h3 id="群晖-DSM-开启-Docker-远程-API"><a href="#群晖-DSM-开启-Docker-远程-API" class="headerlink" title="群晖 DSM 开启 Docker 远程 API"></a>群晖 DSM 开启 Docker 远程 API</h3><h4 id="修改配置文件-2"><a href="#修改配置文件-2" class="headerlink" title="修改配置文件"></a>修改配置文件</h4><p>DSM 7.2 以后，Docker 更名为 Container Manager，所以配置文件路径不一样</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###docker改名前</span></span><br><span class="line">sudo vi /var/packages/Docker/etc/dockerd.json</span><br><span class="line"><span class="comment">###docker改名Container Manager后</span></span><br><span class="line">sudo vi  /var/packages/ContainerManager/etc/dockerd.json</span><br></pre></td></tr></table></figure><h4 id="重启服务-2"><a href="#重启服务-2" class="headerlink" title="重启服务"></a>重启服务</h4><p>完成后到套件中心停用 - 启用 docker 套件。</p><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul><li><a href="https://blog.csdn.net/qq_36154886/article/details/106798246">Docker 如何开启远程访问，实现 api 远程管理？其实只需要改一个地方即可_怎么开启远程 api 接口-CSDN 博客</a></li></ul><p>-EOF</p><p>查看最新版，请访问本文链接：<a href="https://blog.onehat.cn/p/2c94.html">https://blog.onehat.cn/p/2c94.html</a></p><p>原创作品，转载请保留出处。</p></div>]]></content>
      
      
      <categories>
          
          <category> 工作坊 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技术 </tag>
            
            <tag> Linux </tag>
            
            <tag> Unraid </tag>
            
            <tag> Docker </tag>
            
            <tag> 群晖 </tag>
            
            <tag> NAS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>我的 HomeLab 入坑之路：实现篇</title>
      <link href="/p/c1d8.html"/>
      <url>/p/c1d8.html</url>
      
        <content type="html"><![CDATA[<p>记录家庭网络拓扑、Homelab 的服务。</p><span id="more"></span><p>系列文章：</p><p><a href="https://blog.onehat.cn/p/a169.html">我的 HomeLab 入坑之路：概述篇</a></p><p><a href="https://blog.onehat.cn/p/c1d8.html">我的 HomeLab 入坑之路：实现篇</a></p><h3 id="网络拓扑"><a href="#网络拓扑" class="headerlink" title="网络拓扑"></a>网络拓扑</h3><p>光猫改桥接，主路由拨号，Homelab 连 2.5G 交换机。</p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-11-15_20-34-42.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-11-15_20-34-42.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2024-11-15_20-34-42" style="zoom:50%;" /><h3 id="家庭设备"><a href="#家庭设备" class="headerlink" title="家庭设备"></a>家庭设备</h3><table><thead><tr><th>设备</th><th>型号、配置</th><th>联网方式</th><th>用途、备注</th></tr></thead><tbody><tr><td>光猫</td><td>联通千兆光猫</td><td>千兆有线</td><td></td></tr><tr><td>主路由</td><td>红米 AC2100 千兆路由器</td><td>千兆有线</td><td>拨号、WIFI</td></tr><tr><td>2.5G 交换机</td><td>爱快 IK-S3009MT 8 口 2.5G</td><td>千兆有线</td><td>拓展 2.5G 网络</td></tr><tr><td>AurStation</td><td>12100 + 64G RAM</td><td>2.5G 有线</td><td>Homelab 本体</td></tr><tr><td>MacMini</td><td>黑苹果，华擎 Deskmini H310 准系统 + i5 9400 + 32G RAM</td><td>千兆有线</td><td>台式机；macOS x64 日用</td></tr><tr><td>NT-GG</td><td>12400F + 32G RAM + RTX 2060S</td><td>2.5G 有线</td><td>台式机；游戏 + 主力开发机</td></tr><tr><td>NT-MC</td><td>6800H + 64G RAM</td><td>无线</td><td>笔记本；主力开发机</td></tr><tr><td>Macbook Air</td><td>m1 + 16G RAM</td><td>无线</td><td>笔记本；macOS 日用</td></tr></tbody></table><h3 id="常用服务"><a href="#常用服务" class="headerlink" title="常用服务"></a>常用服务</h3><table><thead><tr><th>虚拟机</th><th>操作系统</th><th>用途</th><th>服务</th><th>重要级别</th></tr></thead><tbody><tr><td>221 (istoreos)</td><td>istoreos</td><td>旁路由</td><td>openclash、adguardhome、kms</td><td>s1</td></tr><tr><td>220 (unraid)</td><td>unraid</td><td>主 NAS，提供基础存储服务（SMB、NFS），运行一些存储密集型的服务</td><td><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-11-15_21-04-16.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-11-15_21-04-16.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2024-11-15_21-04-16"></td><td>s2</td></tr><tr><td>250 (dc-server)</td><td>Windows Server 2022</td><td>域控服务器、DNS 服务器、RDP 授权服务器</td><td>管理内网 AD 域、DNS、RDP 会话主机激活</td><td>s3</td></tr><tr><td>200 (proxy)</td><td>Rocky Linux 9</td><td>代理服务器，核心为 NPM，负责在使用 tailscale 时，代理内网的数据库服务；另外部署了 zabbix 和 harbor</td><td><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-11-15_21-11-17.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-11-15_21-11-17.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2024-11-15_21-11-17"></td><td>s3</td></tr><tr><td>246 (app)</td><td>Rocky Linux 9</td><td>应用服务器，各种 docker 应用</td><td><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-11-15_21-18-08.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-11-15_21-18-08.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2024-11-15_21-18-08"></td><td>s4</td></tr><tr><td>244 (console)</td><td>Windows Server 2022</td><td>控制台，负责提供一个临时的 Windows 环境：当使用 macOS 需要临时使用 Windows 程序、外网使用 tailscale 连进来需要使 Windows 时就派上用场</td><td>已加入 AD 域，运行各种 Windows 桌面程序</td><td>s4</td></tr><tr><td>249 (db-server)</td><td>Windows Server 2022</td><td>数据库服务器</td><td>已加入 AD 域，运行 3 大关系数据库：SQL Server 2012、Oracle 11g、MySQL 5.7</td><td>s4</td></tr><tr><td>223 (haos)</td><td>homeassistant os</td><td>智能家居中枢</td><td></td><td>s4</td></tr><tr><td>222 (dsm)</td><td>dsm 7.1</td><td>黑群晖系统，无直通硬盘，备用</td><td></td><td>s4</td></tr><tr><td>218 (media)</td><td>debian 12</td><td>穿透核显的 lxc 容器，作为媒体服务器</td><td><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-11-15_21-26-18.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-11-15_21-26-18.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2024-11-15_21-26-18"></td><td>s5</td></tr><tr><td>254 (w11-dev)</td><td>windows 11</td><td>直通独显的 windows 虚拟机，可以插上显示器作为临时终端使用</td><td></td><td></td></tr></tbody></table><h3 id="虚拟机管理"><a href="#虚拟机管理" class="headerlink" title="虚拟机管理"></a>虚拟机管理</h3><p>PVE 8 在虚拟机管理方面体验已经挺好了，向旁路由、NAS 虚拟机直通了 PCIE 网口、向虚拟机、LXC 直通了独显和核显。</p><p>将 NAS 的存储挂载到 PVE 里，设置定时的备份任务：每周一次整机备份到 NFS；每日增量备份到 PBS。</p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-11-15_21-07-07.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-11-15_21-07-07.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2024-11-15_21-07-07" style="zoom:50%;" /><h3 id="应用管理（Docker）"><a href="#应用管理（Docker）" class="headerlink" title="应用管理（Docker）"></a>应用管理（Docker）</h3><p>绝大多数服务使用 docker-compose 部署，在内网 Gitea 建立存储库管理 compose 文件，使用 Portainer-EE 进行 stack 管理，其 GitOps update 功能，可以定时的检查 Git 存储库，有更新则直接拉取对应文件并更新 stack，这属于简单的容器流水线实现。</p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-11-15_21-41-28.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-11-15_21-41-28.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2024-11-15_21-41-28" style="zoom:50%;" /><h3 id="音乐管理"><a href="#音乐管理" class="headerlink" title="音乐管理"></a>音乐管理</h3><h4 id="资源来源"><a href="#资源来源" class="headerlink" title="资源来源"></a>资源来源</h4><p><a href="https://wusunk.com/">wusunk.com</a></p><h4 id="管理与播放"><a href="#管理与播放" class="headerlink" title="管理与播放"></a>管理与播放</h4><p>下载完成后，在 MusicTag&#x2F;MusicTag Web 刮削元数据。然后拷贝到 Navidrom 目录下，终端（手机、PC、MAC）使用音流 APP 听歌。</p><p>音流 PC 端：</p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-11-15_21-36-49.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-11-15_21-36-49.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2024-11-15_21-36-49" style="zoom: 50%;" /><h3 id="影视管理"><a href="#影视管理" class="headerlink" title="影视管理"></a>影视管理</h3><p>电影、电视剧：从网络下载，在 TMM 刮削元数据，拷贝到 Jellyfin 媒体库目录，终端（手机、PC、MAC）使用 Jellyfin Media Player 观看。</p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-11-15_21-35-13.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-11-15_21-35-13.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2024-11-15_21-35-13" style="zoom:50%;" /><h3 id="电子书管理"><a href="#电子书管理" class="headerlink" title="电子书管理"></a>电子书管理</h3><h4 id="资源来源-1"><a href="#资源来源-1" class="headerlink" title="资源来源"></a>资源来源</h4><p><a href="https://zh.annas-archive.org/">安娜的档案</a>、<a href="https://z-lib.gs/">Zlibrary</a></p><h4 id="管理与阅读"><a href="#管理与阅读" class="headerlink" title="管理与阅读"></a>管理与阅读</h4><p>我的图书资源分为文学类和技术类两大类。</p><img src="https://gcore.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-12-01_15-18-40.png" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-12-01_15-18-40.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2024-12-01_15-18-40" style="zoom: 67%;" /><h5 id="文学类"><a href="#文学类" class="headerlink" title="文学类"></a>文学类</h5><p>从网络下载 epub、PDF 电子书，导入 Calibre-Web 进行管理、刮削。</p><p>桌面端（PC、MAC）安装 Calibre 链接 Calibre-Web 数据库，直接阅读。</p><p>移动端浏览器访问 Calibre-Web，下载到本地，使用 APP 阅读（APP 推荐 kybook3） 。</p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-11-15_21-34-02.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-11-15_21-34-02.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2024-11-15_21-34-02" style="zoom: 50%;" /><h5 id="技术类"><a href="#技术类" class="headerlink" title="技术类"></a>技术类</h5><p>技术类书籍使用 Zotero 进行纳管，Zotero 安装配置茉莉花插件后，支持与 Zotero Connector 浏览器插件联动进行豆瓣书籍刮削。</p><img src="https://gcore.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-12-01_15-28-16.png" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-12-01_15-28-16.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2024-12-01_15-28-16" style="zoom: 25%;" /><p>茉莉花插件：<a href="https://zotero-chinese.com/user-guide/plugins/jasminum">安装</a></p><img src="https://gcore.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-12-01_14-01-30.png" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-12-01_14-01-30.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2024-12-01_14-01-30" style="zoom:33%;" /><p>Zotero Connector 浏览器插件（豆瓣读书）: <a href="https://www.zotero.org/download/connectors">安装</a></p><img src="https://gcore.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-12-01_14-03-11.png" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-12-01_14-03-11.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2024-12-01_14-03-11" style="zoom:33%;" /><p>虽然 Zotero 软件内已经支持阅读 PDF、EPUB 等格式书籍，但是我觉得体验不佳，好在可以在设置中添加自己喜欢的阅读器，用来阅读书籍。</p><img src="https://gcore.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-12-01_15-29-15.png" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-12-01_15-29-15.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2024-12-01_15-29-15" style="zoom:33%;" /><h3 id="UPS-管理"><a href="#UPS-管理" class="headerlink" title="UPS 管理"></a>UPS 管理</h3><p>光猫、主路由、交换机、Aurstation、MacMini 等设备电源接入 UPS，在未开启 MacMini 的情况下，内网设备功耗约为 70-90w。</p><p>UPS 数据管理连接到 PVE 的 host，其安装了 NUT-Server，向局域网提供 NUT 服务，在断电时会先通知各个 NUT Client 关机，PVE 最后关机。</p><h4 id="Unriad-NUT"><a href="#Unriad-NUT" class="headerlink" title="Unriad NUT"></a>Unriad NUT</h4><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-11-15_21-52-37.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-11-15_21-52-37.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2024-11-15_21-52-37" style="zoom: 50%;" /><h4 id="PeaNut"><a href="#PeaNut" class="headerlink" title="PeaNut"></a>PeaNut</h4><p>Docker 的 PeaNut 服务提供简单的 WebUI 以查看 UPS 信息：</p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-11-15_22-00-10.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-11-15_22-00-10.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2024-11-15_22-00-10" style="zoom: 33%;" /><p>-EOF</p><p>查看最新版，请访问本文链接：<a href="https://blog.onehat.cn/p/c1d8.html">https://blog.onehat.cn/p/c1d8.html</a></p><p>原创作品，转载请保留出处。</p>]]></content>
      
      
      <categories>
          
          <category> 工作坊 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技术 </tag>
            
            <tag> PVE </tag>
            
            <tag> 群晖 </tag>
            
            <tag> NAS </tag>
            
            <tag> HomeLab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>我的 HomeLab 入坑之路：概述篇</title>
      <link href="/p/a169.html"/>
      <url>/p/a169.html</url>
      
        <content type="html"><![CDATA[<p>记录自己的 HomeLab 入坑之路。</p><span id="more"></span><p>系列文章：</p><p><a href="https://blog.onehat.cn/p/a169.html">我的 HomeLab 入坑之路：概述篇</a></p><p><a href="https://blog.onehat.cn/p/c1d8.html">我的 HomeLab 入坑之路：实现篇</a></p><div class="story post-story"><h2 id="设备历程"><a href="#设备历程" class="headerlink" title="设备历程"></a>设备历程</h2><p>自从 2020 年玩矿渣开始，陆续在网络附加存储（NAS）和家庭实验室（HomeLab）领域花了不少的时间和金钱，本文仅做记录使用，也可以作为参考自建的依据。</p><p><del>目前我保留的设备为两台，一台物理黑群晖（以下简称 WSQ），一台基于 PVE 虚拟化的 AIO 设备（以下简称 AurLab）。</del></p><p><del>WSQ 的配置为 J1900+4G RAM，AurLab 的配置较为复杂，看下文描述。</del></p><p>目前我保留的设备只有一台基于 PVE 虚拟化的 AIO 设备（以下简称 AurStation）。</p></div><div class="story post-story"><h2 id="硬件概述"><a href="#硬件概述" class="headerlink" title="硬件概述"></a>硬件概述</h2><p>因在两三年内存在硬件更换设备使用，本节列出的硬件以目前设备上机使用的为准。</p><p><del>WSQ 为某多购入的矿渣设备整机。</del>（2024.03 已将 WSQ 出二手，净 290 元，回血率 60.29%）</p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/202410251004159.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/202410251004159.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="WSQ_CasePic"></p><table><thead><tr><th>硬件</th><th>规格</th><th>数量</th><th>平台</th><th>价格</th><th>日期</th></tr></thead><tbody><tr><td>整机</td><td>J1900+4G RAM 绿牌 WSQ-1</td><td>1</td><td>多</td><td>481</td><td>2020.11.07</td></tr><tr><td>风扇</td><td>超频三 F85 8cm 机箱风扇</td><td>1</td><td>东</td><td>18.49</td><td>2020.11.11</td></tr><tr><td>硬盘</td><td>西数蓝盘 2TB 2.5 英寸 7mm SATA3</td><td>1</td><td>东</td><td>374.99</td><td>2022.09.03</td></tr><tr><td></td><td></td><td></td><td></td><td>合计 874.48</td><td></td></tr></tbody></table><p>AurStation 的硬件以目前上机的为主，几乎所有硬件都是全新的（某鱼购入的默认二手），价格为当时购入的花费。</p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/CasePic0.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/CasePic0.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="CasePic0"></p><table><thead><tr><th>硬件</th><th>规格</th><th>数量</th><th>平台</th><th>价格</th><th>日期</th></tr></thead><tbody><tr><td>主板</td><td>铭瑄 B660M 终结者</td><td>1</td><td>鱼</td><td>600</td><td>2023.04.12</td></tr><tr><td>CPU</td><td><del>酷睿 i9 12900 ES</del>（已更换为 i3 12100）</td><td>1</td><td>鱼</td><td>670</td><td>2023.04.12</td></tr><tr><td>CPU</td><td>酷睿 i3 12100</td><td>1</td><td>宝</td><td>630</td><td>2022.11.11</td></tr><tr><td>内存</td><td>光威天策马甲条 D4 3200 32G</td><td>2</td><td>东</td><td>737.99</td><td>2023.04.13</td></tr><tr><td>机箱</td><td>御夫座套餐（盘位规格 2 个 2.5+6 个 3,5）</td><td>1</td><td>宝</td><td>778</td><td>2023.04.12</td></tr><tr><td>风扇</td><td>御夫座套餐</td><td>-</td><td>-</td><td>-</td><td>-</td></tr><tr><td>散热器</td><td>御夫座套餐（五热管，解热 150w）</td><td>-</td><td>-</td><td>-</td><td>-</td></tr><tr><td>定制 SATA 线</td><td>御夫座套餐</td><td>-</td><td>-</td><td>-</td><td>-</td></tr><tr><td>电源</td><td>鑫谷 AM650 全模组 650w 白牌电源</td><td>1</td><td>多</td><td>287.79</td><td>2023.04.12</td></tr><tr><td>转接卡</td><td>JMicron 585 芯片 m2 转 5 SATA</td><td>1</td><td>多</td><td>100.83</td><td>2023.04.14</td></tr><tr><td>交换机</td><td>爱快 IK-S3009MT 8 口 2.5G</td><td>1</td><td>东</td><td>370.07</td><td>2023.06.16</td></tr><tr><td>网卡</td><td>DIEWU 4 口 2.5G PCIE 网卡</td><td>1</td><td>宝</td><td>295</td><td>2023.07.12</td></tr><tr><td>网卡</td><td>Realtek R8125BG PCIE 网卡（给与 NAS 连接的主机使用）</td><td>1</td><td>宝</td><td>42.68</td><td>2023.07.15</td></tr><tr><td>网卡</td><td>Intel i226-v PCIE 网卡（给与 NAS 连接的主机使用）</td><td>1</td><td>多</td><td>78</td><td>2023.09.20</td></tr><tr><td>固态</td><td>闪迪至尊 3D 1T SATA 固态（全国联保 5 年）</td><td>1</td><td>东</td><td>829</td><td>2020.10.01</td></tr><tr><td>固态</td><td>梵想 S790 2T m2 固态（全国联保 5 年）</td><td>1</td><td>东</td><td>438.12</td><td>2023.05.31</td></tr><tr><td>机械硬盘</td><td>西数企业盘 HC320 8T（全国联保 5 年）</td><td>1</td><td>宝</td><td>958</td><td>2020.11.07</td></tr><tr><td>机械硬盘</td><td>西数企业盘 HC320 8T（全国联保 5 年）</td><td>1</td><td>多</td><td>836.51</td><td>2022.10.22</td></tr><tr><td>机械硬盘</td><td>希捷监控盘酷鹰 ST4000VX015 4T（海康联保 3 年）</td><td>1</td><td>宝</td><td>428</td><td>2023.08.05</td></tr><tr><td>机械硬盘</td><td>日立企业盘 HUS726040ALE611 4T（二手，店保一年）</td><td>1</td><td>多</td><td>189.99</td><td>2023.08.05</td></tr><tr><td>UPS</td><td>施耐德 APC BK650M2-CH</td><td>1</td><td>东</td><td>472.5</td><td>2022.09.03</td></tr><tr><td></td><td></td><td></td><td></td><td>合计 8073.48</td><td></td></tr></tbody></table></div><div class="story post-story"><h2 id="软件一览"><a href="#软件一览" class="headerlink" title="软件一览"></a>软件一览</h2><p>一般来说，想在单一的系统下<del>自由的飞翔</del>实现丰富的功能并不容易，所以我选择虚拟化平台，将各个不同的系统以虚拟机的形式组合起来，以供发挥每个系统的优势，相对而言，比起单一的系统，会产生更大的资源消耗。</p><h3 id="底层系统：Promox-VE"><a href="#底层系统：Promox-VE" class="headerlink" title="底层系统：Promox VE"></a>底层系统：Promox VE</h3><p>底层使用 PVE 系统，仅做基本的直通配置，服务和功能都交给虚拟机来实现。</p><h4 id="2023-10-以前使用-12900ES"><a href="#2023-10-以前使用-12900ES" class="headerlink" title="2023.10 以前使用 12900ES"></a>2023.10 以前使用 12900ES<img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-09-28_22-06-00.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-09-28_22-06-00.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2023-09-28_22-06-00.png"></h4><h4 id="2023-10-使用-12100"><a href="#2023-10-使用-12100" class="headerlink" title="2023.10 使用 12100"></a>2023.10 使用 12100</h4><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-01-04_14-55-17.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-01-04_14-55-17.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2024-01-04_14-55-17"></p><h3 id="NAS-系统-1：黑群晖"><a href="#NAS-系统-1：黑群晖" class="headerlink" title="NAS 系统 1：黑群晖"></a>NAS 系统 1：黑群晖</h3><p><del>业务负载为备份，除 PBS 外不跑任何的 docker 服务，用于备份 PVE 的虚拟机、macOS 的时间机器。</del></p><p>2024.10 黑群晖不再承载任何业务，仅作为实验环境使用。</p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-09-26_09-34-54.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-09-26_09-34-54.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2023-09-26_09-34-54.png"></p><h3 id="NAS-系统-2：Unraid"><a href="#NAS-系统-2：Unraid" class="headerlink" title="NAS 系统 2：Unraid"></a>NAS 系统 2：Unraid</h3><p>业务负载为磁盘管理、影音服务器、家用服务器，上面运行了各种 dockr 服务，特别是数据库之类的 IO 密集容器，直接装在 NAS 里使用可以减少资源损耗。</p><h4 id="2023-09-使用-6-11-5"><a href="#2023-09-使用-6-11-5" class="headerlink" title="2023.09 使用 6.11.5"></a>2023.09 使用 6.11.5</h4><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-09-26_09-36-01.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-09-26_09-36-01.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2023-09-26_09-36-01.png"></p><h4 id="2024-01-使用-6-12-6"><a href="#2024-01-使用-6-12-6" class="headerlink" title="2024.01 使用 6.12.6"></a>2024.01 使用 6.12.6</h4><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-01-04_14-44-44.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-01-04_14-44-44.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2024-01-04_14-44-44"></p><h3 id="堡垒机-跳板机：JumpServer"><a href="#堡垒机-跳板机：JumpServer" class="headerlink" title="堡垒机&#x2F;跳板机：JumpServer"></a>堡垒机&#x2F;跳板机：JumpServer</h3><p>使用 JumpServer，将内网环境集中到浏览器中，一个浏览器，可以做到远程桌面、SSH 连接、数据库连接、调用桌面原生程序。通过 Cloudflare-Tunnel 内网穿透，将 JumpServer 映射到外网，便于外网快速访问 HomeLab 上的资源（不使用下载密集场景，因为穿透网速感人）。</p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-10-10_07-23-20.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-10-10_07-23-20.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2023-10-10_07-23-20"></p><h3 id="服务一览"><a href="#服务一览" class="headerlink" title="服务一览"></a>服务一览</h3><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-10-22_17-55-57.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2024-10-22_17-55-57.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>-EOF</p><p>查看最新版，请访问本文链接：<a href="https://blog.onehat.cn/p/a169.html">https://blog.onehat.cn/p/a169.html</a></p><p>原创作品，转载请保留出处。</p></div>]]></content>
      
      
      <categories>
          
          <category> 工作坊 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技术 </tag>
            
            <tag> PVE </tag>
            
            <tag> 群晖 </tag>
            
            <tag> NAS </tag>
            
            <tag> HomeLab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PVE8 虚拟机迁移到 ESXi</title>
      <link href="/p/adb8.html"/>
      <url>/p/adb8.html</url>
      
        <content type="html"><![CDATA[<p>本文迁移对象为虚拟机磁盘，而非虚拟机整机。即借助 PVE 命令行工具 <code>qemu-img</code>、ESXi 命令行工具 <code>vmkfstools</code>做磁盘格式转换。</p><p><code>qemu-img</code>不局限 PVE 环境，在大多数基于 kvm 的虚拟化平台都可用。</p><span id="more"></span><h3 id="先决条件"><a href="#先决条件" class="headerlink" title="先决条件"></a>先决条件</h3><p>具备实验环境<br>Proxmox VE 8.0</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">proxmox-ve: 8.0.2 (running kernel: 6.2.16-14-pve)</span><br><span class="line">qemu-server: 8.0.7</span><br></pre></td></tr></table></figure><p>ESXi 8.0</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ESXi-8.0U1c-22088125-standard</span><br></pre></td></tr></table></figure><h3 id="qcow2-转换为-vmdk"><a href="#qcow2-转换为-vmdk" class="headerlink" title="qcow2 转换为 vmdk"></a>qcow2 转换为 vmdk</h3><p>操作对象为 PVE 环境。PVE 虚拟机存储目录为 <code>/var/lib/vz/images</code>，其下为各个 VMID 对应的子文件夹。进入子文件夹，则可以看到 qcow2 格式的虚拟机磁盘文件。</p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-09-23_11-39-54.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-09-23_11-39-54.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2023-09-23_11-39-54"></p><p>将 kvm 虚拟机由 qcow2 转换成 vmdk 格式。为了防止镜像被拆分为 2GB 的小块，需要增加 compat6 的选项。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qemu-img convert -f qcow2 虚拟磁盘名.qcow2 -O vmdk 虚拟磁盘名.vmdk -o compat6</span><br></pre></td></tr></table></figure><p>大约等个几分钟（随着文件大小而定），文件格式转换完成。</p><h3 id="vmdx-二次转换"><a href="#vmdx-二次转换" class="headerlink" title="vmdx 二次转换"></a>vmdx 二次转换</h3><p>操作对象为 ESXi 环境。开启 ssh 访问，将上述转换得到的 vmdk 文件上传到 ESXi 的存储中。</p><p>使用命令行转换 vmdk 为 ESXi 能使用的磁盘格式。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vmkfstools -i 虚拟磁盘名.vmdk -d thin 虚拟磁盘名_new.vmdk</span><br></pre></td></tr></table></figure><p>其中-d 参数 <code>thin</code>为<strong>精简置备</strong>，生产环境按需调整为<strong>厚置备置零</strong> <code>eagerzeroedthick</code>、<strong>厚置备延迟置零</strong> <code>zeroedthick</code>。</p><p>命令执行后出现百分比，等待转换完成会有 100% 输出。</p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-09-23_11-40-12.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-09-23_11-40-12.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2023-09-23_11-40-12"></p><p>ESXi 新建虚拟机，挂载转换后的磁盘即可。</p><h3 id="相关问题"><a href="#相关问题" class="headerlink" title="相关问题"></a>相关问题</h3><h4 id="Windows-sid-变更"><a href="#Windows-sid-变更" class="headerlink" title="Windows sid 变更"></a>Windows sid 变更</h4><p>sid 作为 windows 系统唯一的标识，对某些集群业务有依赖关系，如果重复可能导致集群部署异常。如：域控 AD 就依赖 sid 功能。</p><p>硬盘转换前后两个系统的唯一标识符 sid 是一样的，最好对后者进行变更。</p><p>查看 sid 命令行 <code>whoami /all</code></p><p>修改 sid 命令行 <code>C:\Windows\System32\Sysprep\sysprep.exe</code>，弹出系统准备工具，勾选通用，确定后自动重启进入 OOBE 创建用户界面，建议保留原有用户账号、密码。</p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-09-23_11-31-08.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-09-23_11-31-08.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2023-09-23_11-31-08"></p><h4 id="windows-网卡变更"><a href="#windows-网卡变更" class="headerlink" title="windows 网卡变更"></a>windows 网卡变更</h4><p>虚拟机网卡变更将会导致原有网卡设备由于未接入而隐藏，这就像 USB 拔出将无法查看到设备信息。</p><p>如不变更 IP，重新设置相同的静态 IPV4，操作系统会自动提示删除，点是。</p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-09-23_19-38-43.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-09-23_19-38-43.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2023-09-23_19-38-43"></p><p>如有变更 IP 的需要，需要手动处理。</p><p>CMD 控制台：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> devmgr_show_nonpresent_devices=<span class="number">1</span></span><br><span class="line"><span class="built_in">start</span> devmgmt.msc</span><br></pre></td></tr></table></figure><p>设备管理器删除旧设备释放网卡配置：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Services\Tcpip\Parameters\Interfaces</span><br></pre></td></tr></table></figure><p>找到之前的网络信息，并且删除重启。</p><h4 id="Linux-机器号"><a href="#Linux-机器号" class="headerlink" title="Linux 机器号"></a>Linux 机器号</h4><p>如果需要重置机器 id</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo rm -f /etc/machine-id</span><br><span class="line">sudo rm -f /var/lib/dbus/machine-id</span><br></pre></td></tr></table></figure><p>然后关机，下次启动会生成新的机器 id，如果没有生成，可以运行以下命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemd-machine-id-setup</span><br></pre></td></tr></table></figure><h4 id="Linux-系统其他问题"><a href="#Linux-系统其他问题" class="headerlink" title="Linux 系统其他问题"></a>Linux 系统其他问题</h4><p>可能会存在 GRUB 引导失败、网卡变更问题，需要修复引导、重设上网网卡和静态 IP。</p><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul><li><a href="https://zhuanlan.zhihu.com/p/619757953">KVM 虚拟机迁移到 ESXi（3） - 知乎 (zhihu.com)</a></li><li><a href="https://docs.vmware.com/cn/VMware-vSphere/7.0/com.vmware.vsphere.storage.doc/GUID-9CC98802-82D9-44B0-9735-97675258FAAE.html">支持的磁盘格式 (vmware.com)</a></li></ul><p>-EOF</p><p>查看最新版，请访问本文链接：<a href="https://blog.onehat.cn/p/adb8.html">https://blog.onehat.cn/p/adb8.html</a></p><p>原创作品，转载请保留出处。</p>]]></content>
      
      
      <categories>
          
          <category> 工作坊 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技术 </tag>
            
            <tag> PVE </tag>
            
            <tag> ESXi </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu22.04 开启 RDP 远程桌面</title>
      <link href="/p/f62e.html"/>
      <url>/p/f62e.html</url>
      
        <content type="html"><![CDATA[<p>记录如何使用默认设置开启 Ubuntu 的远程桌面连接（RDP）。</p><span id="more"></span><h3 id="先决条件"><a href="#先决条件" class="headerlink" title="先决条件"></a>先决条件</h3><p>本次实验环境为 Ubuntu22.04 桌面版，默认 DE 为 Gnome42。</p><p>系统已设置静态 IPv4。</p><h3 id="开启共享"><a href="#开启共享" class="headerlink" title="开启共享"></a>开启共享</h3><p>在设置 - 共享 - 远程桌面，打开按钮 <code>远程桌面</code>和 <code>远程控制</code>，并在下方的认证维护好远程登录使用的用户名和密码，推荐与本机登录密码一致。完成后即可使用 mstsc 进行登录。</p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-09-24_18-35-56.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-09-24_18-35-56.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2023-09-24_18-35-56"></p><h3 id="设置无人值守"><a href="#设置无人值守" class="headerlink" title="设置无人值守"></a>设置无人值守</h3><h4 id="开启用户自动登录"><a href="#开启用户自动登录" class="headerlink" title="开启用户自动登录"></a>开启用户自动登录</h4><p>在设置 - 用户，先点击右上角解锁按钮认证，以解锁此页的设置权限。</p><p>完成认证后开启自动登录按钮。</p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-09-24_18-40-16.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-09-24_18-40-16.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2023-09-24_18-40-16"></p><h4 id="关闭屏幕超时锁屏"><a href="#关闭屏幕超时锁屏" class="headerlink" title="关闭屏幕超时锁屏"></a>关闭屏幕超时锁屏</h4><p>在设置 - 隐私 - 屏幕，<code>息屏延时</code>设置为从不，<code>自动锁屏</code>关闭。</p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-09-24_18-41-48.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-09-24_18-41-48.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2023-09-24_18-41-48"></p><h4 id="登录密钥环密码清空"><a href="#登录密钥环密码清空" class="headerlink" title="登录密钥环密码清空"></a>登录密钥环密码清空</h4><p>如不清空，每次自动登录后都需要手动解锁，才能使用远程桌面，达不到无人值守的目的。</p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-09-24_18-22-52.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-09-24_18-22-52.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2023-09-24_18-22-52"></p><p>在终端输入 <code>seahorse</code>，打开 <code>密码和密钥</code>，选中 <code>登录</code>，右键更改密码，设置空即可。</p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-09-24_18-45-36.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-09-24_18-45-36.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2023-09-24_18-45-36"></p><p>至此，已完成全部设置，重启验证是否有效。</p><p>推荐同时开启 ssh 登录，以备不时之需。</p><p>-EOF</p><p>查看最新版，请访问本文链接：<a href="https://blog.onehat.cn/p/f62e.html">https://blog.onehat.cn/p/f62e.html</a></p><p>原创作品，转载请保留出处。</p>]]></content>
      
      
      <categories>
          
          <category> 工作坊 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技术 </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu22.04 使用 SSSD 加入 AD 域</title>
      <link href="/p/97b7.html"/>
      <url>/p/97b7.html</url>
      
        <content type="html"><![CDATA[<p>记录 Ubuntu 如何接入 AD 域，linux 系统加入 AD 域的方式有很多种，SSSD 是其中的一种。</p><span id="more"></span><h3 id="先决条件"><a href="#先决条件" class="headerlink" title="先决条件"></a>先决条件</h3><p>具备已配置好的 AD 域服务器、AD 域用户组、AD 域用户</p><p>本次域控实验环境如下：</p><table><thead><tr><th>AD 域名</th><th>AD 域服务器 IP</th><th>域用户</th><th>所属用户组</th></tr></thead><tbody><tr><td>onehat.cn</td><td>192.168.31.250</td><td>Administrator</td><td>admin</td></tr></tbody></table><p>Ubuntu22.04 实验环境如下：</p><table><thead><tr><th>主机名</th><th>IP</th><th>本地用户名</th></tr></thead><tbody><tr><td>ub22-227</td><td>192.168.31.227</td><td>dsf</td></tr></tbody></table><p>网络已设置为静态 IP，主 DNS 指向域控服务器。</p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub//imgs/Snipaste_2023-09-18_15-35-10.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub//imgs/Snipaste_2023-09-18_15-35-10.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2023-09-18_15-35-10"></p><h3 id="安装依赖包"><a href="#安装依赖包" class="headerlink" title="安装依赖包"></a>安装依赖包</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install sssd-ad sssd-tools realmd adcli</span><br></pre></td></tr></table></figure><h3 id="加入域"><a href="#加入域" class="headerlink" title="加入域"></a>加入域</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo realm join -v onehat.cn</span><br></pre></td></tr></table></figure><p>默认要求验证域控管理员账户，输入密码完成验证则可加入成功。</p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub//imgs/Snipaste_2023-09-18_15-49-03.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub//imgs/Snipaste_2023-09-18_15-49-03.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2023-09-18_15-49-03"></p><h3 id="验证域用户可登录性"><a href="#验证域用户可登录性" class="headerlink" title="验证域用户可登录性"></a>验证域用户可登录性</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo login</span><br></pre></td></tr></table></figure><p>使用域用户登录，格式为 <a href="mailto:&#x75;&#x73;&#x65;&#x72;&#64;&#120;&#x78;&#x78;&#120;&#x2e;&#120;&#120;">user@xxxx.xx</a></p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub//imgs/Snipaste_2023-09-18_15-52-20.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub//imgs/Snipaste_2023-09-18_15-52-20.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2023-09-18_15-52-20"></p><p>回车后按提示录入密码，则登录成功。</p><h3 id="添加域控组到-sudoer"><a href="#添加域控组到-sudoer" class="headerlink" title="添加域控组到 sudoer"></a>添加域控组到 sudoer</h3><p>sudo 是 linux 发行版常用的提权组件，使用域控用户登录后，发现是无法获取 sudo 权限的，返回以下提示信息：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">administrator@onehat.cn@ub22-227:/$ sudo apt update</span><br><span class="line">administrator@onehat.cn 不在 sudoers 文件中。此事将被报告。</span><br></pre></td></tr></table></figure><p>新开一个终端窗口，新建域控使用的 sudoer 文件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vi /etc/sudoers.d/domain_admins</span><br></pre></td></tr></table></figure><p>在 vim 窗口输入，然后保存并退出。无需重启，原有的已登录域用户的终端窗口，已经可以使用 sudo 命令了。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">%</span><span class="language-bash">admin@onehat.cn ALL=(ALL)       ALL <span class="comment">#作用是将域控用户组admin添加到sudoer用户列表，允许组内用户使用sudo提权。</span></span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub//imgs/Snipaste_2023-09-18_16-03-34.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub//imgs/Snipaste_2023-09-18_16-03-34.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2023-09-18_16-03-34"></p><p>至此，域控用户已经可以在 Ubuntu 本机完成登录、提权的操作了。</p><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul><li><a href="https://ubuntu.com/server/docs/how-to-set-up-sssd-with-active-directory">How to set up SSSD with Active Directory | Ubuntu</a></li></ul><p>-EOF</p><p>查看最新版，请访问本文链接：<a href="https://blog.onehat.cn/p/97b7.html">https://blog.onehat.cn/p/97b7.html</a></p><p>原创作品，转载请保留出处。</p>]]></content>
      
      
      <categories>
          
          <category> 工作坊 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技术 </tag>
            
            <tag> Linux </tag>
            
            <tag> Ubuntu </tag>
            
            <tag> AD 域 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu22.04 安装 RTL8125B 驱动</title>
      <link href="/p/59dc.html"/>
      <url>/p/59dc.html</url>
      
        <content type="html"><![CDATA[<p>购入了一块 RTL8125BG 的 4 口 2.5G 网卡（PCIE x4 接口），记录一下在 Uuntu 下安装官方驱动程序。</p><span id="more"></span><h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><p>从 Realtek 瑞昱下载驱动压缩包。<a href="https://www.realtek.com/zh/component/zoo/advanced-search/73?Itemid=355">瑞昱半导体 (realtek.com)</a></p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-09-24_17-27-04.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-09-24_17-27-04.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2023-09-24_17-27-04"></p><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>先在 Ubuntu 安装编译环境</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install build-essential</span><br></pre></td></tr></table></figure><p>解压缩驱动包，进入驱动目录，执行：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ./autorun.sh</span><br></pre></td></tr></table></figure><p>等待终端输出 Completed，即安装完成。</p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-09-24_17-27-33.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-09-24_17-27-33.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2023-09-24_17-27-33"></p><p>使用内网测速，则上传&#x2F;下载基本可以跑满 2.5G。</p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-09-24_17-32-53.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-09-24_17-32-53.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2023-09-24_17-32-53"></p><p>-EOF</p><p>查看最新版，请访问本文链接：<a href="https://blog.onehat.cn/p/59dc.html">https://blog.onehat.cn/p/59dc.html</a></p><p>原创作品，转载请保留出处。</p>]]></content>
      
      
      <categories>
          
          <category> 工作坊 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技术 </tag>
            
            <tag> Linux </tag>
            
            <tag> Ubuntu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PVE8 添加 PCIE 网卡后导致网卡编号变化</title>
      <link href="/p/54f9.html"/>
      <url>/p/54f9.html</url>
      
        <content type="html"><![CDATA[<p>记录 PVE8.0 装好系统后添加网卡导致的网卡变化。</p><span id="more"></span><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">╭─root@pve /sys/class/net</span><br><span class="line">╰─<span class="comment"># cd /sys/class/net</span></span><br><span class="line">╭─root@pve /sys/class/net</span><br><span class="line">╰─<span class="comment"># ls</span></span><br><span class="line">bonding_masters  enp10s0  enp6s0  enp7s0  enp8s0  enp9s0  lo  vmbr0</span><br><span class="line">╭─root@pve /sys/class/net</span><br><span class="line">╰─<span class="comment"># cat /sys/class/net/enp10s0/address</span></span><br><span class="line">00:e2:69:61:2d:81</span><br><span class="line">╭─root@pve /sys/class/net</span><br><span class="line">╰─<span class="comment"># cat /sys/class/net/enp6s0/address</span></span><br><span class="line">1c:86:0b:21:28:af</span><br><span class="line">╭─root@pve /sys/class/net</span><br><span class="line">╰─<span class="comment"># cat /sys/class/net/enp7s0/address</span></span><br><span class="line">1c:86:0b:21:28:b0</span><br><span class="line">╭─root@pve /sys/class/net</span><br><span class="line">╰─<span class="comment"># cat /sys/class/net/enp8s0/address</span></span><br><span class="line">1c:86:0b:21:28:b1</span><br><span class="line">╭─root@pve /sys/class/net</span><br><span class="line">╰─<span class="comment"># cat /sys/class/net/enp9s0/address</span></span><br><span class="line">1c:86:0b:21:28:b2</span><br><span class="line">╭─root@pve /sys/class/net</span><br><span class="line">╰─<span class="comment"># cat /etc/network/interfaces</span></span><br><span class="line">auto lo</span><br><span class="line">iface lo inet loopback</span><br><span class="line"></span><br><span class="line">iface enp10s0 inet manual</span><br><span class="line"></span><br><span class="line">auto vmbr0</span><br><span class="line">iface vmbr0 inet static</span><br><span class="line">        address 192.168.31.240/24</span><br><span class="line">        gateway 192.168.31.1</span><br><span class="line">        bridge-ports enp10s0</span><br><span class="line">        bridge-stp off</span><br><span class="line">        bridge-fd 0</span><br><span class="line">╭─root@pve /sys/class/net</span><br><span class="line">╰─<span class="comment"># systemctl restart networking.service</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-10-25_20-48-14.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-10-25_20-48-14.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2023-10-25_20-48-14"></p><p>-EOF</p><p>查看最新版，请访问本文链接：<a href="https://blog.onehat.cn/p/54f9.html">https://blog.onehat.cn/p/54f9.html</a></p><p>原创作品，转载请保留出处。</p>]]></content>
      
      
      <categories>
          
          <category> 工作坊 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技术 </tag>
            
            <tag> PVE </tag>
            
            <tag> Linux </tag>
            
            <tag> Debian </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PVE8 修改软件仓库源和 LXC 源为国内源</title>
      <link href="/p/7422.html"/>
      <url>/p/7422.html</url>
      
        <content type="html"><![CDATA[<p>记录 PVE8 换源。</p><span id="more"></span><div class="story post-story"><h2 id="apt-软件源"><a href="#apt-软件源" class="headerlink" title="apt 软件源"></a>apt 软件源</h2><p>替换前建议先更新下证书，否则可能由于证书不可用导致 https 无法使用，进而无法下载所有软件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install apt-transport-https ca-certificates</span><br></pre></td></tr></table></figure><p>首先替换通用软件源，Debian 的软件源配置文件是 &#x2F;etc&#x2F;apt&#x2F;sources.list</p><p>备份后输入以下命令直接填充</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">mirrors.utsc.edu.cn</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Downlaod and Install debian 12 sourcelist</span></span><br><span class="line">curl -fsSL https://mirrors.ustc.edu.cn/repogen/conf/debian-https-4-bookworm -o  /etc/apt/sources.list</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="pve-软件源"><a href="#pve-软件源" class="headerlink" title="pve 软件源"></a>pve 软件源</h2><p>pve 镜像默认的 pve 软件源配置文件是 &#x2F;etc&#x2F;apt&#x2F;sources.list.d&#x2F;pve-no-subscription.list</p><p>备份后将其中内容替换为以下即可：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nano /etc/apt/sources.list.d/pve-no-subscription.list</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">修改成以下内容</span></span><br><span class="line">deb https://mirrors.ustc.edu.cn/proxmox/debian/pve bookworm pve-no-subscription</span><br></pre></td></tr></table></figure><p>完成之后运行以下指令把软件源的密钥安装一下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Downlaod and install gpg key</span></span><br><span class="line">wget https://mirrors.ustc.edu.cn/proxmox/debian/proxmox-release-bookworm.gpg -O /etc/apt/trusted.gpg.d/proxmox-release-bookworm.gpg</span><br></pre></td></tr></table></figure><p>编辑 PVE ceph 源 配置文件是 &#x2F;etc&#x2F;apt&#x2F;sources.list.d&#x2F;ceph.list</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nano /etc/apt/sources.list.d/ceph.list</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">改成如下内容</span></span><br><span class="line">deb https://mirrors.ustc.edu.cn/proxmox/debian/ceph-quincy bookworm no-subscription</span><br></pre></td></tr></table></figure><p>然后就可以愉快的更新软件源了</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt update</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="CT-Templates-LXC-容器-源"><a href="#CT-Templates-LXC-容器-源" class="headerlink" title="CT Templates (LXC 容器) 源"></a>CT Templates (LXC 容器) 源</h2><p>将 &#x2F;usr&#x2F;share&#x2F;perl5&#x2F;PVE&#x2F;APLInfo.pm 文件中默认的源地址 <a href="http://download.proxmox.com/">http://download.proxmox.com</a></p><p>替换为 <a href="https://mirrors.tuna.tsinghua.edu.cn/proxmox">https://mirrors.tuna.tsinghua.edu.cn/proxmox</a> 即可</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/share/perl5/PVE/APLInfo.pm /usr/share/perl5/PVE/APLInfo.pm_back</span><br><span class="line">sed -i &#x27;s|http://download.proxmox.com|https://mirrors.ustc.edu.cn/proxmox|g&#x27; /usr/share/perl5/PVE/APLInfo.pm</span><br></pre></td></tr></table></figure><p>针对 &#x2F;usr&#x2F;share&#x2F;perl5&#x2F;PVE&#x2F;APLInfo.pm 文件的修改，重启后生效</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart pvedaemon.service</span><br></pre></td></tr></table></figure><p>之后在 pve 网页端下载 CT Templates 速度就很快了。</p><p>-EOF</p><p>查看最新版，请访问本文链接：<a href="https://blog.onehat.cn/p/7422.html">https://blog.onehat.cn/p/7422.html</a></p><p>原创作品，转载请保留出处。</p></div>]]></content>
      
      
      <categories>
          
          <category> 工作坊 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技术 </tag>
            
            <tag> PVE </tag>
            
            <tag> Linux </tag>
            
            <tag> Debian </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>个人建站数据备忘</title>
      <link href="/p/d8f8.html"/>
      <url>/p/d8f8.html</url>
      
        <content type="html"><![CDATA[<p>记录建站相关使用的一些数据和备忘事项。</p><span id="more"></span><div class="story post-story"><h2 id="数据标准"><a href="#数据标准" class="headerlink" title="数据标准"></a>数据标准</h2><table><thead><tr><th>站点</th><th>事项</th><th>数值</th><th>备忘</th></tr></thead><tbody><tr><td>博客</td><td>headimg 头图大小</td><td>840x280 像素</td><td></td></tr><tr><td>博客</td><td>书籍封面图片大小 - 单页</td><td>340x423 像素</td><td>表格内</td></tr><tr><td>博客、笔记</td><td>书籍封面图片大小 - 双页</td><td>680x423 像素</td><td>表格内</td></tr><tr><td>笔记</td><td>首行 icon</td><td>256x256 像素</td><td></td></tr></tbody></table></div><div class="story post-story"><h2 id="favicon-网站小图标设置"><a href="#favicon-网站小图标设置" class="headerlink" title="favicon 网站小图标设置"></a>favicon 网站小图标设置</h2><table><thead><tr><th>网站</th><th>设置方法</th></tr></thead><tbody><tr><td>mkdocs</td><td><a href="https://www.mkdocs.org/getting-started/#changing-the-favicon-icon">mkdocs 官方文档</a><br />create an <code>img</code> subdirectory in the <code>docs</code> directory and copy your custom <code>favicon.ico</code> file to that directory. MkDocs will automatically detect and use that file as your favicon icon.</td></tr><tr><td>hexo</td><td><code>favicon.ico</code>放在 <code>source</code>文件夹</td></tr><tr><td>homepage</td><td><code>settings.yaml</code>里添加配置项 <code>favicon</code>，如：<strong>favicon</strong>: <strong>favicon</strong>.ico</td></tr></tbody></table><p>-EOF</p><p>查看最新版，请访问本文链接：<a href="https://blog.onehat.cn/p/d8f8.html">https://blog.onehat.cn/p/d8f8.html</a></p><p>原创作品，转载请保留出处。</p></div>]]></content>
      
      
      <categories>
          
          <category> 工作坊 </category>
          
          <category> 备忘录 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技术 </tag>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>转载--VisualSVN 破解（VS2019）</title>
      <link href="/p/8180.html"/>
      <url>/p/8180.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>使用反编译工具来破解 VisualSVN。</p><p>原文地址：<a href="https://blog.csdn.net/lilixiaojun/article/details/119421212">https://blog.csdn.net/lilixiaojun/article/details/119421212</a></p></blockquote><span id="more"></span><h3 id="第一步"><a href="#第一步" class="headerlink" title="第一步"></a>第一步</h3><p>准备工具 dnSpy（下载地址：<a href="http://www.pc6.com/softview/SoftView_481260.html%EF%BC%89">http://www.pc6.com/softview/SoftView_481260.html）</a></p><h3 id="第二步"><a href="#第二步" class="headerlink" title="第二步"></a>第二步</h3><p>查找 VisualSun 安装目录，以下地址为我的安装目录，供参考</p><p>说明：我记得以前的 VisualSvn 安装文件是单独的一个目录，如：Program Files 文件夹下某目录<del>，现在的目录应该是 vs2017 的缘故。另外 AppData 是隐藏文件夹，所以要打开</del></p><p>总之 找到如下 红框中的 dll 就行了</p><p><img src="https://raw.githubusercontent.com/dsf1995cn/PicHub/main/imgs/2021080516272921.png" class="lazyload" data-srcset="https://raw.githubusercontent.com/dsf1995cn/PicHub/main/imgs/2021080516272921.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><h3 id="第三步"><a href="#第三步" class="headerlink" title="第三步"></a>第三步</h3><p>用 dnSpy 打开该 dll（一定要在该目录下直接打开，不要复制出去修改，否则反编译修改编译不通过，依赖的 dll 都在该目录下；怕改错就把该 dll 备份一下）</p><p><img src="https://raw.githubusercontent.com/dsf1995cn/PicHub/main/imgs/20210805162739815.png" class="lazyload" data-srcset="https://raw.githubusercontent.com/dsf1995cn/PicHub/main/imgs/20210805162739815.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>找到如下方法；把 30 天改为 3650 天，当然你也可以为 8888,9999,6666 总之想要多少天就改为多少天~（但是不能太大，否则会失效）</p><p><img src="https://raw.githubusercontent.com/dsf1995cn/PicHub/main/imgs/20210805162750412.png" class="lazyload" data-srcset="https://raw.githubusercontent.com/dsf1995cn/PicHub/main/imgs/20210805162750412.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>右键“编辑类”</p><p><img src="https://raw.githubusercontent.com/dsf1995cn/PicHub/main/imgs/20210805162818416.png" class="lazyload" data-srcset="https://raw.githubusercontent.com/dsf1995cn/PicHub/main/imgs/20210805162818416.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>改完之后点 右下角 编译</p><p><img src="https://raw.githubusercontent.com/dsf1995cn/PicHub/main/imgs/20210805162830195.png" class="lazyload" data-srcset="https://raw.githubusercontent.com/dsf1995cn/PicHub/main/imgs/20210805162830195.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>再点保存</p><p><img src="https://raw.githubusercontent.com/dsf1995cn/PicHub/main/imgs/20210805162838428.png" class="lazyload" data-srcset="https://raw.githubusercontent.com/dsf1995cn/PicHub/main/imgs/20210805162838428.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p>]]></content>
      
      
      <categories>
          
          <category> 工作坊 </category>
          
          <category> 获取信息源 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技术 </tag>
            
            <tag> Windows </tag>
            
            <tag> 转载 </tag>
            
            <tag> 破解 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>转载--群晖 Docker 安装 Clash</title>
      <link href="/p/f0da.html"/>
      <url>/p/f0da.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>群晖 Docker 安装 Clash。</p><p>原文地址：<a href="https://roov.org/2020/07/docker-clash-ui/">群晖 docker 安装并运行 Clash+UI | reizhi (roov.org)</a></p></blockquote><span id="more"></span><p>前一篇文章中我们提到了在群晖的 docker 中安装 RcloneBrowser，而为了更好的为其提供网络环境，这篇文章我们将介绍如何在群晖 docker 中安装并运行 Clash 以及 UI 界面。有关下载镜像和创建容器的步骤可以参考<a href="https://roov.org/2020/06/synology-docker-rclonebrowser/">前文</a>，这里便不再重复说明了。</p><div class="story post-story"><h2 id="1-准备-Clash-配置文件"><a href="#1-准备-Clash-配置文件" class="headerlink" title="1.准备 Clash 配置文件"></a>1.准备 Clash 配置文件</h2><p>本篇文章并不会涉及如何获取适当的 Clash 配置文件，这部分请自行想办法解决。</p><p>在准备好 Clash 配置文件后，使用任意文本编辑器打开，查找并确认以下设置：（不要带上#及后面的部分）</p><ul><li>port: 7890 #http&#x2F;https 监听端口</li><li>socks-port: 7891 #socks5 监听端口</li><li>allow-lan: true #允许外部连接</li><li>external-controller: 9090 #UI 监听端口</li></ul><p>如果配置文件中不存在对应的项目，请在文件头部进行添加。其中第一，第二及第四项的端口号可以在 1024-65535 之间任意设置但不得重复，第三项必须设置为 <code>true</code>。</p><p>示例配置文件如下：</p><p><a href="https://roov.org/wp-content/uploads/2020/07/2020-07-05_225857.png"><img src="https://raw.githubusercontent.com/dsf1995cn/PicHub/main/imgs/2020-07-05_225857.png" class="lazyload" data-srcset="https://raw.githubusercontent.com/dsf1995cn/PicHub/main/imgs/2020-07-05_225857.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></a></p><p>保存后将该文件复制到群晖的共享文件夹中，如 &#x2F;docker&#x2F;clash&#x2F;sub.yaml。</p></div><div class="story post-story"><h2 id="2-创建-Clash-容器"><a href="#2-创建-Clash-容器" class="headerlink" title="2.创建 Clash 容器"></a>2.创建 Clash 容器</h2><p>进入 docker 套件并下载映像 <code>dreamacro/clash</code>，随后双击映像创建容器，并点击高级设置。在卷页面中，为 <code>/ui</code> 创建文件夹挂载点，为 <code>/root/.config/clash/config.yaml</code> 创建文件挂载，指向前一步中的配置文件。</p><p><a href="https://roov.org/wp-content/uploads/2020/07/2020-07-05_231440.png"><img src="https://raw.githubusercontent.com/dsf1995cn/PicHub/main/imgs/2020-07-05_231440.png" class="lazyload" data-srcset="https://raw.githubusercontent.com/dsf1995cn/PicHub/main/imgs/2020-07-05_231440.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></a></p><p>在端口设置页面中，为前一步中的 <code>port</code>, <code>socks-port</code>, <code>external-controller</code> 三个端口创建对应的映射端口。如有需要类型可以选择 TCP 和 UDP。</p><p><a href="https://roov.org/wp-content/uploads/2020/07/2020-07-05_231717.png"><img src="https://raw.githubusercontent.com/dsf1995cn/PicHub/main/imgs/2020-07-05_231717.png" class="lazyload" data-srcset="https://raw.githubusercontent.com/dsf1995cn/PicHub/main/imgs/2020-07-05_231717.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></a></p></div><div class="story post-story"><h2 id="3-创建-UI-容器"><a href="#3-创建-UI-容器" class="headerlink" title="3.创建 UI 容器"></a>3.创建 UI 容器</h2><p>在 docker 中下载映像 <code>haishanh/yacd</code> 并创建容器，这里只需要为 80 端口创建映射端口即可。</p><p><a href="https://roov.org/wp-content/uploads/2020/07/2020-07-05_232539.png"><img src="https://raw.githubusercontent.com/dsf1995cn/PicHub/main/imgs/2020-07-05_232539.png" class="lazyload" data-srcset="https://raw.githubusercontent.com/dsf1995cn/PicHub/main/imgs/2020-07-05_232539.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></a></p></div><div class="story post-story"><h2 id="4-登录使用"><a href="#4-登录使用" class="headerlink" title="4.登录使用"></a>4.登录使用</h2><p>在确保以上两个容器都启动运行后，在浏览器中打开 http:&#x2F;&#x2F;群晖的 ip 地址：步骤 3 中的本地端口（本例中是 <code>http://reizhix:5080</code>），便可以看到如下的登陆界面。</p><p><a href="https://roov.org/wp-content/uploads/2020/07/2020-07-05_232913.png"><img src="https://raw.githubusercontent.com/dsf1995cn/PicHub/main/imgs/2020-07-05_232913.png" class="lazyload" data-srcset="https://raw.githubusercontent.com/dsf1995cn/PicHub/main/imgs/2020-07-05_232913.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></a></p><p>其中，Hostname 填写群晖的 ip 地址（切勿使用默认的 127.0.0.1），Port 填写步骤 2 中 9090 所对应的映射端口（本例中是 5090），点击 Confirm 即可进入 Clash UI 的主界面。</p><p><a href="https://roov.org/wp-content/uploads/2020/07/2020-07-05_233220.png"><img src="https://raw.githubusercontent.com/dsf1995cn/PicHub/main/imgs/2020-07-05_233220-1024x424.png" class="lazyload" data-srcset="https://raw.githubusercontent.com/dsf1995cn/PicHub/main/imgs/2020-07-05_233220-1024x424.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></a></p><p>此时 Clash 会监听步骤 2 中的 5890 和 5891 端口并向局域网提供服务。由于本教程中没有配置认证，请勿将相关端口映射到外网。</p></div>]]></content>
      
      
      <categories>
          
          <category> 工作坊 </category>
          
          <category> 获取信息源 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技术 </tag>
            
            <tag> 群晖 </tag>
            
            <tag> NAS </tag>
            
            <tag> 转载 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>个人 Linux 基础配置</title>
      <link href="/p/291a.html"/>
      <url>/p/291a.html</url>
      
        <content type="html"><![CDATA[<p>记录个人使用 Linux 的配置。</p><span id="more"></span><h3 id="梗图：linux-阵营图"><a href="#梗图：linux-阵营图" class="headerlink" title="梗图：linux 阵营图"></a>梗图：linux 阵营图</h3><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-10-25_19-59-57.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-10-25_19-59-57.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2023-10-25_19-59-57"></p><h3 id="修改主机名"><a href="#修改主机名" class="headerlink" title="修改主机名"></a>修改主机名</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl set-hostname hostname</span><br></pre></td></tr></table></figure><h3 id="git、github"><a href="#git、github" class="headerlink" title="git、github"></a>git、github</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###安装git</span></span><br><span class="line">apt install git</span><br><span class="line"><span class="comment">###设置用户信息</span></span><br><span class="line">git config --global user.name <span class="string">&quot;123&quot;</span></span><br><span class="line">git config --global user.email <span class="string">&quot;123@gmail.com&quot;</span></span><br><span class="line"><span class="comment">###生成ssh密钥（生成的id_rsa.pub添加的Github）</span></span><br><span class="line">ssh-keygen -t rsa -C <span class="string">&quot;123@gmail.com&quot;</span></span><br><span class="line"><span class="comment">#git设置代理</span></span><br><span class="line">git config --global http.proxy <span class="string">&#x27;http://127.0.0.1:7890&#x27;</span></span><br><span class="line">git config --global https.proxy <span class="string">&#x27;http://127.0.0.1:7890&#x27;</span></span><br><span class="line"><span class="comment">#git查看代理</span></span><br><span class="line">git config --global --get http.proxy</span><br><span class="line">git config --global --get https.proxy</span><br><span class="line"><span class="comment">#git取消代理</span></span><br><span class="line">git config --global --<span class="built_in">unset</span> http.proxy</span><br><span class="line">git config --global --<span class="built_in">unset</span> https.proxy</span><br><span class="line"><span class="comment">#Github连通性测试</span></span><br><span class="line">ssh -T git@github.com</span><br><span class="line"><span class="comment">#git修改443端口</span></span><br><span class="line">$ vim ~/.ssh/config</span><br><span class="line">```</span><br><span class="line"><span class="comment"># Add section below to it</span></span><br><span class="line">Host github.com</span><br><span class="line">  Hostname ssh.github.com</span><br><span class="line">  Port 443</span><br><span class="line">```</span><br></pre></td></tr></table></figure><h3 id="zsh、ohmyzsh"><a href="#zsh、ohmyzsh" class="headerlink" title="zsh、ohmyzsh"></a>zsh、ohmyzsh</h3><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###安装zsh</span></span><br><span class="line">apt install zsh curl</span><br><span class="line"><span class="comment">###替换bash为zsh</span></span><br><span class="line">chsh -s /bin/zsh</span><br><span class="line"><span class="comment">###安装ohmyzsh</span></span><br><span class="line">sh -c <span class="string">&quot;<span class="subst">$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)</span>&quot;</span></span><br><span class="line"><span class="comment">###安装插件</span></span><br><span class="line"><span class="comment">###1.语法高亮显示</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/zsh-users/zsh-syntax-highlighting.git <span class="variable">$&#123;ZSH_CUSTOM:-~/.oh-my-zsh/custom&#125;</span>/plugins/zsh-syntax-highlighting </span><br><span class="line"><span class="comment">###2.自动补全</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/zsh-users/zsh-autosuggestions <span class="variable">$&#123;ZSH_CUSTOM:-~/.oh-my-zsh/custom&#125;</span>/plugins/zsh-autosuggestions</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="开启插件"><a href="#开启插件" class="headerlink" title="开启插件"></a>开启插件</h4><p>下载完了以后打开 .zshrc 文件 放入 plugins 里面就可以。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">###每个插件注意空格分隔 或者换行</span><br><span class="line">plugins=(git zsh-syntax-highlighting)</span><br><span class="line"></span><br><span class="line">//或者这样</span><br><span class="line">plugins=(</span><br><span class="line">    git</span><br><span class="line">    zsh-syntax-highlighting</span><br><span class="line">    zsh-autosuggestions</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p> 更新配置文件 <code>source ~/.zshrc</code></p><h4 id="CPU-省电模式"><a href="#CPU-省电模式" class="headerlink" title="CPU 省电模式"></a>CPU 省电模式</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">可用的模式</span></span><br><span class="line">cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_governors</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">设置到性能模式</span></span><br><span class="line">cpupower -c all frequency-set -g performance</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看当前所处模式</span></span><br><span class="line">cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">设置到省电模式</span></span><br><span class="line">cpupower -c all frequency-set -g powersave</span><br></pre></td></tr></table></figure><p>-EOF</p><p>查看最新版，请访问本文链接：<a href="https://blog.onehat.cn/p/291a.html">https://blog.onehat.cn/p/291a.html</a></p><p>原创作品，转载请保留出处。</p>]]></content>
      
      
      <categories>
          
          <category> 工作坊 </category>
          
          <category> 备忘录 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技术 </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Xamarin.Android 的 Debug 记录</title>
      <link href="/p/2fc4.html"/>
      <url>/p/2fc4.html</url>
      
        <content type="html"><![CDATA[<p>记录 Xamarin.Android 的 Debug 错误。</p><span id="more"></span><div class="story post-story"><h2 id="1-Resources目录下-styles-xml报错"><a href="#1-Resources目录下-styles-xml报错" class="headerlink" title="1.Resources目录下 styles.xml报错"></a>1.<code>Resources</code>目录下 <code>styles.xml</code>报错</h2><h3 id="错误"><a href="#错误" class="headerlink" title="错误"></a>错误</h3><p><code>No resource found that matches the given name: attr &#39;windowActionModeOverlay&#39;.</code></p><h3 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h3><p>删除以下缓存文件夹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\&lt;my user&gt;\AppData\Local\Xamarin</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="2-“java-exe”已退出，代码为-1"><a href="#2-“java-exe”已退出，代码为-1" class="headerlink" title="2.“java.exe”已退出，代码为 1"></a>2.<code>“java.exe”已退出，代码为 1</code></h2><h3 id="错误-1"><a href="#错误-1" class="headerlink" title="错误"></a>错误</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1&gt;MSB6006: “java.exe”已退出，代码为 1。</span><br><span class="line">1&gt;已完成生成项目“xxxxx.xxxx.Android.csproj”的操作 - 失败。</span><br><span class="line">1&gt;生成失败。</span><br><span class="line">1&gt;Deployment failed to Xiaomi MI 4LTE.</span><br></pre></td></tr></table></figure><h3 id="解决-1"><a href="#解决-1" class="headerlink" title="解决"></a>解决</h3><p>几乎把 stackoverflow 的帖子翻遍了，排查了各种环境配置，都没有用。<br>过了一个多礼拜，就是今天，忽然想起去年升级 win10 1909 后手动开启了一项 Beta 性功能：开启系统级 utf8 支持<br>关闭此功能，重启，打开 VS，清空解决方案，生成，然后就 OK 了！！！<br>所以说，<strong>开发机器还是稳一手，别手痒，启用新功能的代价可能是指数级增加 Debug 难度</strong><br>附图：</p><p><img src="https://i.loli.net/2020/03/28/35U1zp7oCAqiaZG.png" class="lazyload" data-srcset="https://i.loli.net/2020/03/28/35U1zp7oCAqiaZG.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="windows 开启 utf8"></p><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul><li><a href="https://stackoverflow.com/questions/21900853/no-resource-found-theme-appcompat-light-darkactionbar">android - No resource found - Theme.AppCompat.Light.DarkActionBar - Stack Overflow </a></li></ul><p>-EOF</p><p>查看最新版，请访问本文链接：<a href="https://blog.onehat.cn/p/2fc4.html">https://blog.onehat.cn/p/2fc4.html</a></p><p>原创作品，转载请保留出处。</p></div>]]></content>
      
      
      <categories>
          
          <category> 工作坊 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技术 </tag>
            
            <tag> Android </tag>
            
            <tag> Xamarin </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Deepin 跳过硬盘安装限制</title>
      <link href="/p/13ad.html"/>
      <url>/p/13ad.html</url>
      
        <content type="html"><![CDATA[<p>前几天把闲置的  <a href="https://www.cnblogs.com/amoxidu/p/7285541.html">cb2</a>  从 <a href="https://galliumos.org/">GalliumOS</a> 换到了 <a href="https://deepin.org/">deepin</a>。</p><span id="more"></span><p>但是 deepin15.7 安装时对硬盘有限制，最小大小为 16G。<br>修改其安装器的配置文件 <code>/etc/deepin-installer.conf</code>配置项 <code>partition_minimum_disk_space_required = 16</code>中的数字为适合大小即可。</p><p>-EOF</p><p>查看最新版，请访问本文链接：<a href="https://blog.onehat.cn/p/13ad.html">https://blog.onehat.cn/p/13ad.html</a></p><p>原创作品，转载请保留出处。</p>]]></content>
      
      
      <categories>
          
          <category> 工作坊 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技术 </tag>
            
            <tag> Linux </tag>
            
            <tag> Chromebook </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>常见数据库的默认端口</title>
      <link href="/p/2bb5.html"/>
      <url>/p/2bb5.html</url>
      
        <content type="html"><![CDATA[<p>常见数据库端口，来自 jetbrains。</p><span id="more"></span><p><img src="https://i.loli.net/2019/06/23/5d0f948fa4c2a38733.png" class="lazyload" data-srcset="https://i.loli.net/2019/06/23/5d0f948fa4c2a38733.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Database Default Port"></p><p>-EOF</p><p>查看最新版，请访问本文链接：<a href="https://blog.onehat.cn/p/2bb5.html">https://blog.onehat.cn/p/2bb5.html</a></p><p>原创作品，转载请保留出处。</p>]]></content>
      
      
      <categories>
          
          <category> 工作坊 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技术 </tag>
            
            <tag> Database </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>学习摘要：设计模式</title>
      <link href="/p/5d0c.html"/>
      <url>/p/5d0c.html</url>
      
        <content type="html"><![CDATA[<p>记录设计模式学习摘要。</p><span id="more"></span><div class="story post-story"><h2 id="一、创建型模式"><a href="#一、创建型模式" class="headerlink" title="一、创建型模式"></a>一、创建型模式</h2><blockquote><p>创建型模式将对象的创建和使用分离，在使用对象时无需关心对象的创建细节，从而降低系统的耦合度，让设计方案更易于修改和扩展。每一个创建型模式都在视图回答 3 个问题：<code>3W</code>-&gt; 创建什么（<code>What</code>）、由谁创建（<code>Who</code>）和何时创建（<code>When</code>）。</p></blockquote><h3 id="1-单例模式-singleton"><a href="#1-单例模式-singleton" class="headerlink" title="1.单例模式 singleton"></a>1.单例模式 <code>singleton</code></h3><h4 id="1-1-要点"><a href="#1-1-要点" class="headerlink" title="1.1 要点"></a>1.1 要点</h4><blockquote><p>确保某一个类只有一个实例，而且自行实例化并向整个系统提供这个实例，这个类称为单例类，它提供全局访问的方法。单例模式是一种对象创建模式。</p></blockquote><p>单例模式有 3 个要点：</p><ul><li>某个类只能有一个实例</li><li>它必须自行创建这个实例</li><li>它必须自行向整个系统提供这个实例</li></ul><h4 id="1-2-结构图"><a href="#1-2-结构图" class="headerlink" title="1.2 结构图"></a>1.2 结构图</h4><p><img src="https://i.loli.net/2019/06/16/5d052dba9ff2f36744.png" class="lazyload" data-srcset="https://i.loli.net/2019/06/16/5d052dba9ff2f36744.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>Singleton（单例）：</p><ul><li>在单例类的内部实现只生成一个实例，同时它提供一个静态的 <code>GetInstance()</code>方法，让客户可以访问它的唯一实例；</li><li>为了防止在外部对单例类实例化，它的构造函数被设为 <code>private</code>；</li><li>在单例类的内部定义了一个 <code>Singleton</code>类型的静态对象，作为提供外部共享的唯一实例。</li></ul><p>情景模拟</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">假设M公司成都分公司的IT开发部门承接了一个服务器负载均衡器（Load Balance）软件的开发，该软件运行在一台负载均衡服务器上面，可以将并发访问和数据流量分发到服务器集群中的多台设备上进行并发处理，提高系统的整体处理能力，缩短响应时间。由于集群中的服务器需要动态增减，且客户端请求需要统一分发，因此需要确保负载均衡器的唯一性，即只能有一个负载均衡器实例来管理服务器和分发请求，否则会带来服务器状态的不一致以及请求的分配冲突等问题。如何确保负载均衡器的唯一性成为了这个软件成功地关键。</span><br></pre></td></tr></table></figure><h4 id="1-3-饥汉式与懒汉式单例"><a href="#1-3-饥汉式与懒汉式单例" class="headerlink" title="1.3 饥汉式与懒汉式单例"></a>1.3 饥汉式与懒汉式单例</h4><h5 id="饥汉式单例"><a href="#饥汉式单例" class="headerlink" title="饥汉式单例"></a>饥汉式单例</h5><p>在 C#中，我们可以利用静态构造函数来实现。</p><blockquote><p>C#的语法中有一个函数能够确保只调用一次，那就是<strong>静态构造函数</strong>。由于 C#是在调用静态构造函数时初始化静态变量，.NET 运行时（CLR）能够确保只调用一次静态构造函数，这样我们就能够保证只初始化一次 instance。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public class LoadBalancer</span><br><span class="line">   &#123;</span><br><span class="line">       // 私有静态变量，存储唯一实例</span><br><span class="line">       private static readonly LoadBalancer instance = new LoadBalancer();</span><br><span class="line"></span><br><span class="line">       ......</span><br><span class="line"></span><br><span class="line">       // 公共静态成员方法，返回唯一实例</span><br><span class="line">       public static LoadBalancer GetLoadBalancer()</span><br><span class="line">       &#123;</span><br><span class="line">           return instance;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>饿汉式是在 .NET 中实现 Singleton 的首选方法。但是，由于在 C#中调用静态构造函数的时机不是由程序员掌控的，而是<strong>当.NET 运行时发现第一次使用该类型的时候自动调用该类型的静态构造函数</strong>（也就是说在用到 <code>LoadBalancer</code>时就会被创建，而不是用到 <code>LoadBalancer.GetLoadBalancer()</code>时），这样会<strong>过早地创建实例，从而降低内存的使用效率</strong>。此外，静态构造函数由 .NET Framework 负责执行初始化，我们对对实例化机制的控制权也相对较少。</p><h5 id="懒汉式单例"><a href="#懒汉式单例" class="headerlink" title="懒汉式单例"></a>懒汉式单例</h5><p>除了饿汉式之外，还有一种懒汉式。最开始我们实现的方式就是一种懒汉式单例，也就是说，在第一个调用 <code>LoadBalancer.GetLoadBalancer()</code>时才会实例化对象，这种技术又被称之为<strong>延迟加载</strong>（<code>Lazy Load</code>）。同样，我们的目标还是为了避免多个线程同时调用 <code>GetLoadBalancer</code>方法，在 C#中，我们可以使用关键字 <code>lock/Moniter.Enter+Exit</code>等来实现，这里采用关键字语法糖 <code>lock</code>来改写代码段：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">public class LoadBalancer</span><br><span class="line">    &#123;</span><br><span class="line">        // 私有静态变量，存储唯一实例</span><br><span class="line">        private static LoadBalancer instance = null;</span><br><span class="line">        private static readonly object syncLocker = new object();</span><br><span class="line"></span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">        // 公共静态成员方法，返回唯一实例</span><br><span class="line">        public static LoadBalancer GetLoadBalancer()</span><br><span class="line">        &#123;</span><br><span class="line">            if (instance == null)</span><br><span class="line">            &#123;</span><br><span class="line">                lock (syncLocker)</span><br><span class="line">                &#123;</span><br><span class="line">                    instance = new LoadBalancer();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            return instance;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>问题貌似得以解决，但事实并非如此。如果使用以上代码来创建单例对象，还是会存在单例对象不一致。假设线程 A 先进入 lock 代码块内，执行实例化代码。此时线程 B 排队吃瓜等待，必须等待线程 A 执行完毕后才能进入 lock 代码块。但当 A 执行完毕时，线程 B 并不知道实例已经被创建，将继续创建新的实例，从而导致多个单例对象。因此，开发人员需要进一步改进，于是就有了双重检查锁定 <code>（Double-Check Locking）</code>，其改写代码如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">public class LoadBalancer</span><br><span class="line">    &#123;</span><br><span class="line">        // 私有静态变量，存储唯一实例</span><br><span class="line">        private static LoadBalancer instance = null;</span><br><span class="line">        private static readonly object syncLocker = new object();</span><br><span class="line"></span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">        // 公共静态成员方法，返回唯一实例</span><br><span class="line">        public static LoadBalancer GetLoadBalancer()</span><br><span class="line">        &#123;</span><br><span class="line">            // 第一重判断</span><br><span class="line">            if (instance == null)</span><br><span class="line">            &#123;</span><br><span class="line">                // 锁定代码块</span><br><span class="line">                lock (syncLocker)</span><br><span class="line">                &#123;</span><br><span class="line">                    // 第二重判断</span><br><span class="line">                    if (instance == null)</span><br><span class="line">                    &#123;</span><br><span class="line">                        instance = new LoadBalancer();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            return instance;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h5 id="一种更好的单例实现"><a href="#一种更好的单例实现" class="headerlink" title="一种更好的单例实现"></a>一种更好的单例实现</h5><p>饿汉式单例不能延迟加载，懒汉式单例安全控制繁琐，而且性能受影响。静态内部类单例则将这两者 有点合二为一。使用这种方式，我们需要在单例类中增加一个静态内部类，在该内部类中创建单例对象，再将该单例对象通过 <code>GetInstance()</code>方法返回给外部使用，于是开发人员又改写了代码：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">public class LoadBalancer</span><br><span class="line">    &#123;</span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">        // 公共静态成员方法，返回唯一实例</span><br><span class="line">        public static LoadBalancer GetLoadBalancer()</span><br><span class="line">        &#123;</span><br><span class="line">            return Nested.instance;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 使用内部类+静态构造函数实现延迟初始化</span><br><span class="line">        class Nested</span><br><span class="line">        &#123;</span><br><span class="line">            static Nested() &#123; &#125;</span><br><span class="line">            internal static readonly LoadBalancer instance = new LoadBalancer();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ......</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>该实现方法在内部定义了一个私有类型 <code>Nested</code>。当<strong>第一次用到这个嵌套类型的时候，会调用静态构造函数创建 <code>LoadBalancer</code>的实例 <code>instance</code></strong>。如果我们不调用属性 <code>LoadBalancer.GetLoadBalancer()</code>，那么就不会触发.NET 运行时 <code>（CLR）</code>调用 <code>Nested</code>，也就不会创建实例，因此也就保证了按需创建实例（或延迟初始化）。可见，此方法既可以实现延迟加载，又可以保证线程安全，不影响系统性能。但其缺点是与具体编程语言本身的特性相关，有一些面向对象的编程语言并不支持此种方式。</p><h4 id="1-4-单例模式总结"><a href="#1-4-单例模式总结" class="headerlink" title="1.4 单例模式总结"></a>1.4 单例模式总结</h4><h5 id="主要优点"><a href="#主要优点" class="headerlink" title="主要优点"></a>主要优点</h5><ul><li>提供了对唯一实例的<strong>受控访问</strong>。单例类封装了它的唯一实例，所以它可以严格控制客户怎样以及何时访问它。</li><li>由于在系统内存中只存在一个对象，因此可以节约系统资源，对于一些需要频繁创建和销毁的对象，单例模式无疑可以提高系统的性能。</li><li>允许可变数目的示例。基于单例模式，开发人员可以进行扩展，使用与控制单例对象相似的方法来获得指定个数的实例对象，既节省系统资源，又解决了单例对象共享过多有损性能的问题。（Note：自行提供指定书目的实例对象的类可称之为多例类）例如，数据库连接池，线程池，各种池。</li></ul><h5 id="主要缺点"><a href="#主要缺点" class="headerlink" title="主要缺点"></a>主要缺点</h5><ul><li>单例模式中没有抽象层，因此单例类的扩展有很大的困难。</li><li>单例类的职责过重，在一定程度上违背了单一职责的原则。因为单例类既提供了业务方法，又提供了创建对象的方法（工厂方法），将对象的创建和对象本身的功能耦合在一起。不够，很多时候我们都需要取得平衡。</li><li>很多高级面向对象编程语言如 C#和 Java 等都提供了垃圾回收机制，如果实例化的共享对象长时间不被利用，系统则会认为它是垃圾，于是会自动销毁并回收资源，下次利用时又得重新实例化，这将导致共享的单例对象状态的丢失。</li></ul><h5 id="适用场景"><a href="#适用场景" class="headerlink" title="适用场景"></a>适用场景</h5><ul><li>系统只需要一个实例对象。例如：系统要求提供一个唯一的序列号生成器或者资源管理器，又或者需要考虑资源消耗太大而只允许创建一个对象。</li><li>客户调用类的单个实例只允许使用一个公共访问点，除了该公共访问点，不能通过其他途径访问该实例。比如，在 <code>Flappy Bird</code>游戏中，小鸟这个游戏对象在整个游戏中应该只存在一个实例，所有对于这个小鸟的操作（向上飞、向下掉等）都应该只会针对唯一的一个实例进行。</li></ul><h3 id="2-简单工厂模式-Simple-Factory"><a href="#2-简单工厂模式-Simple-Factory" class="headerlink" title="2.简单工厂模式 Simple Factory"></a>2.简单工厂模式 <code>Simple Factory</code></h3><blockquote><p>工厂模式是最常用的一种创建型模式，通常所说的工厂模式一般是指工厂方法模式。本篇是是工厂方法模式的“小弟”，我们可以将其理解为工厂方法模式的预备知识，它不属于 <code>GoF 23</code>种设计模式，但在软件开发中却也应用地比较频繁。此外，工厂方法模式还有一位“大哥”—抽象工厂模式，会在后面进行介绍。</p></blockquote><blockquote><p><strong>简单工厂（Simple Factory）模式</strong>：定义一个工厂类，它可以根据参数的不同返回不同类的实例，被创建的实例通常都具有共同的父类。因为在简单工厂模式中用于创建实例的方法是静态（<code>static</code>）方法，因此简单工厂模式又被称为静态工厂方法模式，它属于创建型模式。</p></blockquote><h4 id="2-1-要点"><a href="#2-1-要点" class="headerlink" title="2.1 要点"></a>2.1 要点</h4><p>简单工厂模式的要点在于：<strong>当你需要什么，只需要传入一个正确的参数，就可以获取你所需的对象，而无须知道其创建细节</strong>。</p><h4 id="2-2-结构图"><a href="#2-2-结构图" class="headerlink" title="2.2 结构图"></a>2.2 结构图</h4><p><img src="https://i.loli.net/2019/06/16/5d052e35ddb9c42243.png" class="lazyload" data-srcset="https://i.loli.net/2019/06/16/5d052e35ddb9c42243.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>简单工厂模式包含 3 个角色：</p><ul><li><p>Factory - 工厂角色：该模式的核心，负责实现创建所有产品实例的内部逻辑，提供一个静态的工厂方法 GetProduct()，返回抽象产品类型 Product 的实例。</p></li><li><p>Product - 抽象产品角色：所有产品类的父类，封装了各种产品对象的共有方法，它的引入将提高系统的灵活性，使得在工厂类中只需要定义一个通用的工厂方法，因为所有创建的具体产品对象都是其子类对象。</p></li><li><p>ConcreteProduct - 具体产品角色：简单工厂模式的创建目标，所有被创建的对象都充当这个角色的某个具体类的实例。</p><p>在简单工厂模式中，客户端通过工厂类来创建一个产品类的实例，而无须直接使用 new 关键字来创建对象。（可以看出，它是工厂模式家族中最简单的一员）</p></li></ul><h5 id="情景模拟"><a href="#情景模拟" class="headerlink" title="情景模拟"></a>情景模拟</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">M公司想要基于C#语言开发一套图表库，该图表库可以为应用系统提供各种不同外观的图标，例如柱状图、饼状图或折线图等。M公司图表库设计开发人员希望为应用系统开发人员提供一套灵活易用的图表库，而且可以较为方便地对图表库进行扩展，以便于在将来增加一些新类型的图表。</span><br></pre></td></tr></table></figure><h4 id="2-3-重构图表库的实现"><a href="#2-3-重构图表库的实现" class="headerlink" title="2.3 重构图表库的实现"></a>2.3 重构图表库的实现</h4><p>为了将 Chart 类的职责分离，同时将 Chart 对象的创建和使用分离，M 公司开发人员决定使用简单工厂模式对图表库进行重构，重构后的结构图如下所示：</p><p><img src="https://i.loli.net/2019/06/16/5d052e7e268ce72434.png" class="lazyload" data-srcset="https://i.loli.net/2019/06/16/5d052e7e268ce72434.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><h5 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h5><p>（1）抽象产品角色：<code>IChartable</code>接口</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public interface IChartable</span><br><span class="line">&#123;</span><br><span class="line">    void Display();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>（2）具体产品角色：各种图表类型</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">public class HistogramChart : IChartable</span><br><span class="line">&#123;</span><br><span class="line">    public HistogramChart()</span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(&quot;创建柱状图...&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void Display()</span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(&quot;显示柱状图...&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class LineChart : IChartable</span><br><span class="line">&#123;</span><br><span class="line">    public LineChart()</span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(&quot;创建折线图...&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void Display()</span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(&quot;显示折线图...&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class PieChart : IChartable</span><br><span class="line">&#123;</span><br><span class="line">    public PieChart()</span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(&quot;创建饼状图...&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void Display()</span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(&quot;显示饼状图...&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>（3）工厂角色：<code>ChartFactory</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">public class ChartFactory</span><br><span class="line">&#123;</span><br><span class="line">    public static IChartable GetChart(string type)</span><br><span class="line">    &#123;</span><br><span class="line">        IChartable chart = null;</span><br><span class="line"></span><br><span class="line">        if (type.Equals(&quot;histogram&quot;, StringComparison.OrdinalIgnoreCase))</span><br><span class="line">        &#123;</span><br><span class="line">            chart = new HistogramChart();</span><br><span class="line">            Console.WriteLine(&quot;初始化设置柱状图...&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        else if (type.Equals(&quot;pie&quot;, StringComparison.OrdinalIgnoreCase))</span><br><span class="line">        &#123;</span><br><span class="line">            chart = new PieChart();</span><br><span class="line">            Console.WriteLine(&quot;初始化设置饼状图...&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        else if (type.Equals(&quot;line&quot;, StringComparison.OrdinalIgnoreCase))</span><br><span class="line">        &#123;</span><br><span class="line">            chart = new PieChart();</span><br><span class="line">            Console.WriteLine(&quot;初始化设置折线图...&quot;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return chart;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>（4）客户端调用：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public static void Main()</span><br><span class="line">&#123;</span><br><span class="line">    IChartable chart = ChartFactory.GetChart(&quot;histogram&quot;);</span><br><span class="line">    if (chart != null)</span><br><span class="line">    &#123;</span><br><span class="line">        chart.Display();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    chart = ChartFactory.GetChart(&quot;pie&quot;);</span><br><span class="line">    if (chart != null)</span><br><span class="line">    &#123;</span><br><span class="line">        chart.Display();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在客户端代码中，使用工厂类的静态方法来创建具体产品对象，如果需要更换产品，只需要修改静态工厂方法中的参数即可。例如：将柱状图改为饼状图，只需要将代码：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IChartable chart = ChartFactory.GetChart(&quot;histogram&quot;);</span><br></pre></td></tr></table></figure><p>改为：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IChartable chart = ChartFactory.GetChart(&quot;pie&quot;);</span><br></pre></td></tr></table></figure><h5 id="改进的方案"><a href="#改进的方案" class="headerlink" title="改进的方案"></a>改进的方案</h5><p>M 公司开发人员发现在创建具体 <code>Chart</code>对象时，每次更换一个 <code>Chart</code>对象都需要修改客户端中静态工厂方法的参数，客户端代码需要重新编译，这对于客户端而言，是违反了开闭原则的。于是，开发人员希望有一种方法能够在不修改客户端代码地前提下更换具体产品对象。</p><p>因此，他们考虑使用配置文件（XML）来实现：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">  &lt;appSettings&gt;</span><br><span class="line">    &lt;add key=&quot;charttype&quot; value=&quot;histogram&quot;/&gt;</span><br><span class="line">  &lt;/appSettings&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure><p>客户端因此改为：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public static void Main()</span><br><span class="line">    &#123;</span><br><span class="line">        string type = AppConfigHelper.GetChartType(); // 读取配置文件中的charttype</span><br><span class="line">        if (string.IsNullOrEmpty(type))</span><br><span class="line">        &#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        IChartable chart = ChartFactory.GetChart(type);</span><br><span class="line">        if (chart != null)</span><br><span class="line">        &#123;</span><br><span class="line">            chart.Display();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="2-4-简单工厂模式总结"><a href="#2-4-简单工厂模式总结" class="headerlink" title="2.4 简单工厂模式总结"></a>2.4 简单工厂模式总结</h4><h5 id="主要优点-1"><a href="#主要优点-1" class="headerlink" title="主要优点"></a>主要优点</h5><ul><li>实现了对象创建和使用的分离：客户端可以免除直接创建产品对象的职责，而仅仅“消费”产品。</li><li>客户端无须知道所创建的具体产品类的类名，只需要知道具体产品类所对应的的参数即可。</li><li>通过引入配置文件，可以在不修改任何客户端代码地情况下更换和增加新的具体产品类，在一定程度上提高了系统的灵活性。</li></ul><p>主要缺点</p><ul><li>由于工厂类集中了所有产品的创建逻辑，职责过重，一旦不能正常工作，整个系统都要受影响。</li><li>使用简单工厂模式势必会增加系统中类的个数（引入新的工厂类），增加了系统的复杂度和理解难度。</li><li>系统扩展困难，一旦添加新产品就不得不修改工厂逻辑，在产品类型较多时，有可能会造成工厂逻辑过于复杂，不利于系统的扩展和维护。</li><li>简单工厂模式由于使用了静态工厂方法，造成工厂角色无法形成基于继承的等级结构。</li></ul><h5 id="适用场景-1"><a href="#适用场景-1" class="headerlink" title="适用场景"></a>适用场景</h5><ul><li>工厂类负责创建的对象比较少，由于创建的对象较少，不会造成工厂方法中的业务逻辑太过复杂。</li><li>客户端只需要知道传入工厂类的参数，对于如何创建对象并不关心。</li></ul><h3 id="3-工厂模式-Factory-Method"><a href="#3-工厂模式-Factory-Method" class="headerlink" title="3.工厂模式 Factory Method"></a>3.工厂模式 <code>Factory Method</code></h3><blockquote><p>在简单工厂模式中只提供一个工厂类，该工厂类需要知道每一个产品对象的创建细节，并决定合适实例化哪一个产品类。其最大的缺点就是当有新产品加入时，必须修改工厂类，需要在其中加入必要的业务逻辑，这违背了开闭原则。此外，在简单工厂模式中，所有的产品都由同一个工厂创建，工厂类职责较重，业务逻辑较为复杂，具体产品与工厂类之间的耦合度较高，严重影响了系统的灵活性和扩展性。</p><p>在工厂方法模式中，不再提供一个统一的工厂类来创建所有的产品对象，而是<strong>针对不同的产品提供不同的工厂，系统提供一个与产品等级结构对应的工厂等级结构</strong>。</p></blockquote><blockquote><p><strong>工厂方法（Factory Method）模式</strong>：定义一个用于创建对象的接口，让子类决定将哪一个类实例化。工厂方法模式让一个类的实例化延迟到其子类。工厂方法模式又简称为工厂模式，也可称为多态工厂模式，它是一种创建型模式。</p></blockquote><h4 id="3-1-结构图"><a href="#3-1-结构图" class="headerlink" title="3.1 结构图"></a>3.1 结构图</h4><p>工厂方法模式提供一个抽象工厂接口来声明抽象工厂方法，而由其子类来具体实现工厂方法并创建具体的产品对象。</p><p><img src="https://i.loli.net/2019/06/16/5d052eb707bb712031.png" class="lazyload" data-srcset="https://i.loli.net/2019/06/16/5d052eb707bb712031.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>从图中可以看出，在工厂方法模式结构图中包含以下 4 个角色：</p><ul><li><code>Product</code>（抽象产品）：定义产品的接口，是工厂方法模式所创建的对象的超类，也就是产品对象的公共父类。</li><li><code>ConcreteProduct</code>（具体产品）：它实现了抽象产品接口，某种类型的具体产品由专门的具体工厂创建，具体工厂和具体产品之间一一对应。</li><li><code>Factory</code>（抽象工厂）：抽象工厂类，声明了工厂方法，用于返回一个产品。</li><li><code>ConcreteFactory</code>（具体工厂）：抽象工厂的子类，实现了抽象工厂中定义的工厂方法，并可由客户端调用，返回一个具体产品类的实例。</li></ul><h5 id="情景模拟-1"><a href="#情景模拟-1" class="headerlink" title="情景模拟"></a>情景模拟</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">M公司欲开发一个系统运行日志记录器（Logger），该记录器可以通过多种途径保存系统的运行日志，例如通过文件记录或数据库记录，用户可以通过修改配置文件灵活地更换日志记录方式。在设计各类日志记录器时，M公司的开发人员发现需要对日志记录器进行一些初始化工作，初始化参数的摄制过程比较复杂，而且某些参数的设置有严格的先后次序，否则可能会发生记录失败。如何封装记录器的初始化过程并保证多种记录器切换的灵活性是M公司开发人员面临的一个难题。</span><br></pre></td></tr></table></figure><h4 id="3-2-工厂方法的实现"><a href="#3-2-工厂方法的实现" class="headerlink" title="3.2 工厂方法的实现"></a>3.2 工厂方法的实现</h4><h6 id="基本结构图"><a href="#基本结构图" class="headerlink" title="基本结构图"></a>基本结构图</h6><p><img src="https://i.loli.net/2019/06/16/5d052eeaca78b80478.png" class="lazyload" data-srcset="https://i.loli.net/2019/06/16/5d052eeaca78b80478.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>其中，<code>Logger</code>接口充当抽象产品角色，而 <code>FileLogger</code>和 <code>DatabaseLogger</code>则充当具体产品角色。<code>LoggerFactory</code>接口充当抽象工厂角色，而 <code>FileLoggerFactory</code>和 <code>DatabaseLoggerFactory</code>则充当具体工厂角色。</p><h5 id="重构代码"><a href="#重构代码" class="headerlink" title="重构代码"></a>重构代码</h5><p>抽象产品：<code>ILogger</code>接口</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public interface ILogger</span><br><span class="line">   &#123;</span><br><span class="line">       void WriteLog();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>具体产品：<code>FileLogger</code>和 <code>DatabaseLogger</code>类</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public class FileLogger : ILogger</span><br><span class="line">   &#123;</span><br><span class="line">       public void WriteLog()</span><br><span class="line">       &#123;</span><br><span class="line">           Console.WriteLine(&quot;文件日志记录...&quot;);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   public class DatabaseLogger : ILogger</span><br><span class="line">   &#123;</span><br><span class="line">       public void WriteLog()</span><br><span class="line">       &#123;</span><br><span class="line">           Console.WriteLine(&quot;数据库日志记录...&quot;);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>抽象工厂：<code>ILoggerFactory</code>接口</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public interface ILoggerFactory</span><br><span class="line">   &#123;</span><br><span class="line">       ILogger CreateLogger();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>具体工厂：<code>FileLoggerFactory</code>和 <code>DatabaseLoggerFactory</code>类</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">public class FileLoggerFactory : ILoggerFactory</span><br><span class="line">    &#123;</span><br><span class="line">        public ILogger CreateLogger()</span><br><span class="line">        &#123;</span><br><span class="line">            // 创建文件日志记录器</span><br><span class="line">            ILogger logger = new FileLogger();</span><br><span class="line">            // 创建文件，代码省略</span><br><span class="line">            return logger;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public class DatabaseLoggerFactory : ILoggerFactory</span><br><span class="line">    &#123;</span><br><span class="line">        public ILogger CreateLogger()</span><br><span class="line">        &#123;</span><br><span class="line">            // 连接数据库，代码省略</span><br><span class="line">            // 创建数据库日志记录器对象</span><br><span class="line">            ILogger logger = new DatabaseLogger();</span><br><span class="line">            // 初始化数据库日志记录器，代码省略</span><br><span class="line">            return logger;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>客户端调用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public static void Main()</span><br><span class="line">    &#123;</span><br><span class="line">        ILoggerFactory factory = new FileLoggerFactory(); // 可通过引入配置文件实现</span><br><span class="line">        if (factory == null)</span><br><span class="line">        &#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ILogger logger = factory.CreateLogger();</span><br><span class="line">        logger.WriteLog();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="3-3-借助反射的重构版本"><a href="#3-3-借助反射的重构版本" class="headerlink" title="3.3 借助反射的重构版本"></a>3.3 借助反射的重构版本</h4><p>逃离修改客户端的折磨</p><blockquote><p>为了让系统具有更好的灵活性和可扩展性，M 公司程序猿决定对日志记录器客户端代码进行重构，使得可以在不修改任何客户端代码的基础之上更换或是增加新的日志记录方式。</p><p>在客户端代码中将不再使用 new 关键字来创建工厂对象，而是将具体工厂类的类名存在配置文件（例如 XML 文件）中，通过读取配置文件来获取类名，再借助.NET 反射机制来动态地创建对象实例。</p></blockquote><p>撸起袖子开始重构</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">  &lt;appSettings&gt;</span><br><span class="line">    &lt;add key=&quot;LoggerFactory&quot; value=&quot;Manulife.ChengDu.DesignPattern.FactoryMethod.v2.DatabaseLoggerFactory, Manulife.ChengDu.DesignPattern.FactoryMethod&quot; /&gt;</span><br><span class="line">  &lt;/appSettings&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure><p>封装一个简单的 <code>AppConfigHelper</code>类</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">public class AppConfigHelper</span><br><span class="line">    &#123;</span><br><span class="line">        public static string GetLoggerFactoryName()</span><br><span class="line">        &#123;</span><br><span class="line">            string factoryName = null;</span><br><span class="line">            try</span><br><span class="line">            &#123;</span><br><span class="line">                factoryName = System.Configuration.ConfigurationManager.AppSettings[&quot;LoggerFactory&quot;];</span><br><span class="line">            &#125;</span><br><span class="line">            catch (Exception ex)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(ex.Message);</span><br><span class="line">            &#125;</span><br><span class="line">            return factoryName;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public static object GetLoggerFactoryInstance()</span><br><span class="line">        &#123;</span><br><span class="line">            string assemblyName = AppConfigHelper.GetLoggerFactoryName();</span><br><span class="line">            Type type = Type.GetType(assemblyName);</span><br><span class="line"></span><br><span class="line">            var instance = Activator.CreateInstance(type);</span><br><span class="line">            return instance;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>重构客户端代码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public static void Main()</span><br><span class="line">    &#123;</span><br><span class="line">        ILoggerFactory factory = (ILoggerFactory)AppConfigHelper.GetLoggerFactoryInstance();</span><br><span class="line">        if (factory == null)</span><br><span class="line">        &#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ILogger logger = factory.CreateLogger();</span><br><span class="line">        logger.WriteLog();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="3-4-工厂方法的隐藏"><a href="#3-4-工厂方法的隐藏" class="headerlink" title="3.4 工厂方法的隐藏"></a>3.4 工厂方法的隐藏</h4><p>有时候，为了进一步简化客户端的使用，还可以对客户端隐藏工厂方法，此时，在工厂类中将直接调用产品类的业务方法，客户端无须调用工厂方法创建产品，直接通过工厂即可使用所创建的对象中的业务方法。</p><p>修改抽象工厂</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public abstract class LoggerFactory</span><br><span class="line">    &#123;</span><br><span class="line">        // 在工厂类中直接调用日志记录器的业务方法WriteLog()</span><br><span class="line">        public void WriteLog()</span><br><span class="line">        &#123;</span><br><span class="line">            ILogger logger = this.CreateLogger();</span><br><span class="line">            logger.WriteLog();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public abstract ILogger CreateLogger();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>修改具体工厂</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public class DatabaseLoggerFactory : LoggerFactory</span><br><span class="line">    &#123;</span><br><span class="line">        public override ILogger CreateLogger()</span><br><span class="line">        &#123;</span><br><span class="line">            // 连接数据库，代码省略</span><br><span class="line">            // 创建数据库日志记录器对象</span><br><span class="line">            ILogger logger = new DatabaseLogger();</span><br><span class="line">            // 初始化数据库日志记录器，代码省略</span><br><span class="line">            return logger;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>简化的客户端调用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public static void Main()</span><br><span class="line">    &#123;</span><br><span class="line">        LoggerFactory factory = (LoggerFactory)AppConfigHelper.GetLoggerFactoryInstance();</span><br><span class="line">        if (factory == null)</span><br><span class="line">        &#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        factory.WriteLog();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="3-5-工厂方法模式总结"><a href="#3-5-工厂方法模式总结" class="headerlink" title="3.5 工厂方法模式总结"></a>3.5 工厂方法模式总结</h4><h5 id="主要优点-2"><a href="#主要优点-2" class="headerlink" title="主要优点"></a>主要优点</h5><ul><li>工厂方法用于创建客户所需要的产品，还向客户隐藏了哪种具体产品类将被实例化这一细节。因此，<strong>用户只需要关心所需产品对应的工厂，无须关心创建细节</strong>。</li><li>在系统中加入新产品时，无需修改抽象工厂和抽象产品提供的接口，也无须修改客户端，还无须修改其他的具体工厂和具体产品，而只要加入一个具体工厂和具体产品就可以了。因此，<strong>系统的可扩展性得到了保证，符合开闭原则</strong>。</li></ul><h5 id="主要缺点-1"><a href="#主要缺点-1" class="headerlink" title="主要缺点"></a>主要缺点</h5><ul><li>在添加新产品时，需要编写新的具体产品类，还要提供与之对应的具体工厂类，<strong>系统中类的个数将成对增加，一定程度上增加了系统的复杂度</strong>。</li><li>由于考虑到系统的可扩展性，需要引入抽象层，且在实现时可能需要用到反射等技术，增加了系统的实现难度。</li></ul><h5 id="适用场景-2"><a href="#适用场景-2" class="headerlink" title="适用场景"></a>适用场景</h5><ul><li>客户端不知道其所需要的对象的类。在工厂方法模式中，客户端不需要知道具体产品类的类名，只需要知道所对应的的工厂即可，具体的产品对象由具体工厂创建，可将具体工厂的类名存储到配置文件或数据库中。</li><li>抽象工厂类通过其子类来指定创建哪个对象。在工厂方法模式中，抽象工厂类只需要提供一个创建产品的接口，而由其子类来确定具体要创建的对象，利用面向对象的多态性和里氏替换原则，在程序运行时，子类对象将覆盖父类对象，从而使得系统易于扩展。</li></ul><p>-EOF</p><p>查看最新版，请访问本文链接：<a href="https://blog.onehat.cn/p/5d0c.html">https://blog.onehat.cn/p/5d0c.html</a></p><p>原创作品，转载请保留出处。</p></div>]]></content>
      
      
      <categories>
          
          <category> 学院 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技术 </tag>
            
            <tag> 学习摘要 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>个人数码数据备忘</title>
      <link href="/p/3997.html"/>
      <url>/p/3997.html</url>
      
        <content type="html"><![CDATA[<p>本文记录个人使用 NAS、PC、Homelab 等数码产品的一些碎片化主观体验、数据测试记录、备忘事项等。</p><span id="more"></span><h3 id="Docker-迅雷下载测速"><a href="#Docker-迅雷下载测速" class="headerlink" title="Docker 迅雷下载测速"></a>Docker 迅雷下载测速</h3><p>千兆带宽基本可以跑慢</p><p>磁力：<code>magnet:?xt=urn:btih:CBDB39122FCFC2F7ACFBAFBC590A58AED8DFDDED</code></p><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-10-25_20-31-35.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-10-25_20-31-35.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2023-10-25_20-31-35"></p><h3 id="ESXi-虚拟磁盘测速"><a href="#ESXi-虚拟磁盘测速" class="headerlink" title="ESXi 虚拟磁盘测速"></a>ESXi 虚拟磁盘测速</h3><p>实验环境</p><p>主机：ESXi 8.0</p><p>存储磁盘：HC320</p><p>存储协议：ISCSI</p><h4 id="1G-网络"><a href="#1G-网络" class="headerlink" title="1G 网络"></a>1G 网络</h4><h5 id="精简置备"><a href="#精简置备" class="headerlink" title="精简置备"></a>精简置备</h5><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-10-26_12-06-51.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-10-26_12-06-51.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2023-10-26_12-06-51"></p><h5 id="厚置备置零"><a href="#厚置备置零" class="headerlink" title="厚置备置零"></a>厚置备置零</h5><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-10-26_12-05-53.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-10-26_12-05-53.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2023-10-26_12-05-53"></p><h4 id="2-5G-网络"><a href="#2-5G-网络" class="headerlink" title="2.5G 网络"></a>2.5G 网络</h4><h4 id="厚置备置零-1"><a href="#厚置备置零-1" class="headerlink" title="厚置备置零"></a>厚置备置零</h4><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-10-26_12-07-37.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/Snipaste_2023-10-26_12-07-37.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Snipaste_2023-10-26_12-07-37"></p><h3 id="PVE-虚拟磁盘测速"><a href="#PVE-虚拟磁盘测速" class="headerlink" title="PVE 虚拟磁盘测速"></a>PVE 虚拟磁盘测速</h3><h4 id="scsi-虚拟磁盘"><a href="#scsi-虚拟磁盘" class="headerlink" title="scsi 虚拟磁盘"></a>scsi 虚拟磁盘</h4><blockquote><p>物理硬盘为梵想 S790 PCIE4.0 2TB</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/PVE%E7%A1%AC%E7%9B%98%E6%80%A7%E8%83%BD.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/PVE%E7%A1%AC%E7%9B%98%E6%80%A7%E8%83%BD.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="PVE 硬盘性能"></p><h3 id="PVE-虚拟-CPU-跑分"><a href="#PVE-虚拟-CPU-跑分" class="headerlink" title="PVE 虚拟 CPU 跑分"></a>PVE 虚拟 CPU 跑分</h3><h4 id="12100-CPU-跑分"><a href="#12100-CPU-跑分" class="headerlink" title="12100 CPU 跑分"></a>12100 CPU 跑分</h4><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/12100_CPUZ%E8%B7%91%E5%88%86.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/12100_CPUZ%E8%B7%91%E5%88%86.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="12100_CPUZ 跑分"></p><h4 id="12900ES-4-虚拟核心跑分"><a href="#12900ES-4-虚拟核心跑分" class="headerlink" title="12900ES 4 虚拟核心跑分"></a>12900ES 4 虚拟核心跑分</h4><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/PVE4%E6%A0%B8%E5%BF%83CPUZ-%E5%88%86%E6%95%B0.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/PVE4%E6%A0%B8%E5%BF%83CPUZ-%E5%88%86%E6%95%B0.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="PVE4 核心 CPUZ-分数"></p><h4 id="12900ES-6-虚拟核心跑分"><a href="#12900ES-6-虚拟核心跑分" class="headerlink" title="12900ES 6 虚拟核心跑分"></a>12900ES 6 虚拟核心跑分</h4><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/PVE6%E6%A0%B8%E5%BF%83CPUZ-%E5%88%86%E6%95%B0.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/PVE6%E6%A0%B8%E5%BF%83CPUZ-%E5%88%86%E6%95%B0.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="PVE6 核心 CPUZ-分数"></p><h3 id="主板-BIOS-微码对比"><a href="#主板-BIOS-微码对比" class="headerlink" title="主板 BIOS 微码对比"></a>主板 BIOS 微码对比</h3><h4 id="铭瑄终结者-B660M"><a href="#铭瑄终结者-B660M" class="headerlink" title="铭瑄终结者 B660M"></a>铭瑄终结者 B660M</h4><h5 id="v3-7"><a href="#v3-7" class="headerlink" title="v3.7"></a>v3.7</h5><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/%E9%93%AD%E7%91%84B660M-3.7.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/%E9%93%AD%E7%91%84B660M-3.7.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="铭瑄 B660M-3.7"></p><h5 id="v4-2"><a href="#v4-2" class="headerlink" title="v4.2"></a>v4.2</h5><p><img src="C:\Users\dsf\Desktop\BIOS\铭瑄B660M-4.2.png" class="lazyload" data-srcset="C:\Users\dsf\Desktop\BIOS\铭瑄B660M-4.2.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="铭瑄 B660M-4.2"></p><h4 id="微星-H610M"><a href="#微星-H610M" class="headerlink" title="微星 H610M"></a>微星 H610M</h4><p><img src="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/%E5%BE%AE%E6%98%9FH610m.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/dsf1995cn/PicHub@main/imgs/%E5%BE%AE%E6%98%9FH610m.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="微星 H610m"></p><p>-EOF</p><p>查看最新版，请访问本文链接：<a href="https://blog.onehat.cn/p/3997.html">https://blog.onehat.cn/p/3997.html</a></p><p>原创作品，转载请保留出处。</p>]]></content>
      
      
      <categories>
          
          <category> 工作坊 </category>
          
          <category> 备忘录 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技术 </tag>
            
            <tag> Linux </tag>
            
            <tag> NAS </tag>
            
            <tag> HomeLab </tag>
            
            <tag> ESXi </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>安装 Linux 的 cb2 配置</title>
      <link href="/p/107.html"/>
      <url>/p/107.html</url>
      
        <content type="html"><![CDATA[<p>闲鱼上收来一台东芝 Chromebook2，尝试安装配置了 GalliumOS。</p><span id="more"></span><h3 id="系统信息"><a href="#系统信息" class="headerlink" title="系统信息"></a>系统信息</h3><ul><li><p>OS：GalliumOS2.1【基于 Ubuntu16.04】</p></li><li><p>Theme:</p><ul><li>GTK 主题 macbuntu-os-ithemes-lts-v7</li><li>Icon 主题 papirus-icon-theme</li></ul><p><img src="https://i.loli.net/2019/01/02/5c2c47534b387.png" class="lazyload" data-srcset="https://i.loli.net/2019/01/02/5c2c47534b387.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p></li></ul><h3 id="常用软件"><a href="#常用软件" class="headerlink" title="常用软件"></a>常用软件</h3><table><thead><tr><th>名称</th><th>说明</th></tr></thead><tbody><tr><td>Ibus-rime</td><td>输入法</td></tr><tr><td>Wps-office</td><td>办公三件套</td></tr><tr><td>Libreoffice-draw</td><td>全平台办公软件，主要用于打开 visio 文件</td></tr><tr><td>Evince；Master PDF editor</td><td>全平台 PDF 的查看和编辑，后者远比 foxit reader for linux 强大</td></tr><tr><td>Nixnote2</td><td>印象笔记的第三方客户端</td></tr><tr><td>Telegram</td><td>全平台 IM</td></tr><tr><td>Chrome&#x2F;Chromium；Firefox</td><td>全平台浏览器</td></tr><tr><td>网易云音乐 for linux</td><td>音乐软件</td></tr><tr><td>SMPlayer</td><td>名字有爱的全平台播放器</td></tr><tr><td>Spotify</td><td>全平台在线音乐客户端</td></tr><tr><td>Gpick</td><td>取色器</td></tr><tr><td>GIMP</td><td>全平台图片编辑器</td></tr><tr><td>Ristretto</td><td>图片查看器</td></tr><tr><td>Geary</td><td>邮件客户端</td></tr><tr><td>Zeal</td><td>全平台 api 文档管理</td></tr><tr><td>Vscode</td><td>全平台文本编辑器</td></tr><tr><td>GVIM</td><td>编辑器之神</td></tr><tr><td>Rescuetime</td><td>全平台时间管理工具</td></tr><tr><td>thunar-gtkhash</td><td>xfce 下文件管理器 thunar 的 hash 值校验插件</td></tr><tr><td>DockBarX[xfce-dockbarx-plugin]</td><td>任务栏增强工具</td></tr><tr><td>Caffeine</td><td>开启激活后暂时停用锁屏，适用于看视频时</td></tr><tr><td>Zsh[omz]</td><td>终极 shell</td></tr><tr><td>Tmux</td><td>打造最强终端：xfce4-terminal+zsh+ohmyzsh+tmux</td></tr><tr><td>Acpi</td><td>终端查看电池信息</td></tr><tr><td>Sdcv</td><td>终端查单词</td></tr><tr><td>Pandoc</td><td>配合 typora 将 md 文档转为富文本</td></tr><tr><td>Conky</td><td>桌面小插件</td></tr><tr><td>Neofetch</td><td>终端输出系统信息</td></tr><tr><td>Unar</td><td>全能命令行解压，支持任意编码文件名</td></tr><tr><td>Git</td><td>版本控制</td></tr><tr><td>Wget,Axel</td><td>命令行下载工具</td></tr></tbody></table><h3 id="不可或缺的-chrome-应用"><a href="#不可或缺的-chrome-应用" class="headerlink" title="不可或缺的 chrome 应用"></a>不可或缺的 chrome 应用</h3><ul><li>奇妙清单（to-list，记事，定时提醒）</li><li>小番茄（效率工具——番茄工作法）</li><li>Google keep 记事（便签，便于和手机同步）</li></ul><p>-EOF</p><p>查看最新版，请访问本文链接：<a href="https://blog.onehat.cn/p/107.html">https://blog.onehat.cn/p/107.html</a></p><p>原创作品，转载请保留出处。</p>]]></content>
      
      
      <categories>
          
          <category> 工作坊 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技术 </tag>
            
            <tag> Linux </tag>
            
            <tag> Chromebook </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/p/3eeb.html"/>
      <url>/p/3eeb.html</url>
      
        <content type="html"><![CDATA[<p>Hello，我的<a href="https://blog.onehat.cn/">博客</a>建立了，新的起点，从今天开始！</p><span id="more"></span><p>-EOF</p><p>查看最新版，请访问本文链接：<a href="https://blog.onehat.cn/p/3eeb.html">https://blog.onehat.cn/p/3eeb.html</a></p><p>原创作品，转载请保留出处。</p>]]></content>
      
      
      <categories>
          
          <category> 里甲 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 随笔 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
